<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>✨✨✨ WLB! WLB! WLB! ✨✨✨😶‍🌫️</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="✨✨✨ WLB! WLB! WLB! ✨✨✨😶‍🌫️">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="✨✨✨ WLB! WLB! WLB! ✨✨✨😶‍🌫️">
<meta property="og:locale">
<meta property="article:author" content="EvelynUU">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="✨✨✨ WLB! WLB! WLB! ✨✨✨😶‍🌫️" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">✨✨✨ WLB! WLB! WLB! ✨✨✨😶‍🌫️</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">重要的事情说三遍</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-javascript_doc/004-函数式编程-FP-深度解析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/004-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-FP-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:45:40.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/004-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-FP-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/">004-函数式编程[FP]深度解析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 函数式编程（FP）深度解析</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 函数式编程核心理解</span></span><br><span class="line">函数式编程是一种<span class="strong">**声明式编程范式**</span>，核心思想是&quot;通过纯函数组合构建程序&quot;，主要特点：</span><br><span class="line"></span><br><span class="line">| <span class="strong">**特性**</span>         | <span class="strong">**说明**</span>                                                                 | <span class="strong">**示例**</span>                                  |</span><br><span class="line">|------------------|-------------------------------------------------------------------------|------------------------------------------|</span><br><span class="line">| 纯函数           | 相同输入永远返回相同输出，无副作用（不改变外部状态）                    | <span class="code">`const add = (a,b) =&gt; a + b;`</span>            |</span><br><span class="line">| 不可变性         | 数据创建后不可修改，通过生成新数据实现变更                              | 使用<span class="code">`map`</span>代替<span class="code">`for循环+push`</span>              |</span><br><span class="line">| 函数一等公民     | 函数可作为参数/返回值/变量                                              | <span class="code">`const logger = fn =&gt; (...args) =&gt; &#123; console.log(...args); return fn(...args); &#125;`</span> |</span><br><span class="line">| 引用透明         | 函数调用可直接替换为其返回值                                            | <span class="code">`add(2,3)`</span> 可替换为 <span class="code">`5`</span>                  |</span><br><span class="line">| 高阶函数         | 接收或返回函数的函数                                                    | <span class="code">`map`</span>, <span class="code">`filter`</span>, <span class="code">`reduce`</span>                |</span><br><span class="line">| 函数组合         | 将多个函数组合成新函数（<span class="code">`f(g(x))`</span>）                                     | <span class="code">`const process = compose(validate, format, save);`</span> |</span><br><span class="line"></span><br><span class="line"><span class="section">### 函数柯里化（Currying）详解</span></span><br><span class="line"><span class="strong">**概念**</span>：将多参数函数转换为一系列单参数函数的过程  </span><br><span class="line"><span class="code">`f(a, b, c)`</span> → <span class="code">`f(a)(b)(c)`</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### 实现原理</span></span><br><span class="line"><span class="code">```javascript</span></span><br><span class="line"><span class="code">// 基础柯里化实现</span></span><br><span class="line"><span class="code">function curry(fn) &#123;</span></span><br><span class="line"><span class="code">  return function curried(...args) &#123;</span></span><br><span class="line"><span class="code">    if (args.length &gt;= fn.length) &#123;</span></span><br><span class="line"><span class="code">      return fn.apply(this, args);</span></span><br><span class="line"><span class="code">    &#125; else &#123;</span></span><br><span class="line"><span class="code">      return (...nextArgs) =&gt; curried.apply(this, [...args, ...nextArgs]);</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">  &#125;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">// 使用示例</span></span><br><span class="line"><span class="code">const sum = (a, b, c) =&gt; a + b + c;</span></span><br><span class="line"><span class="code">const curriedSum = curry(sum);</span></span><br><span class="line"><span class="code">console.log(curriedSum(1)(2)(3)); // 6</span></span><br></pre></td></tr></table></figure>

<h4 id="柯里化特点"><a href="#柯里化特点" class="headerlink" title="柯里化特点"></a>柯里化特点</h4><ol>
<li><strong>参数延迟传递</strong>：分步传入参数</li>
<li><strong>函数复用性</strong>：基于部分参数创建新函数</li>
<li><strong>动态函数生成</strong>：按需组合函数逻辑</li>
</ol>
<h3 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h3><h4 id="场景1：参数复用"><a href="#场景1：参数复用" class="headerlink" title="场景1：参数复用"></a>场景1：参数复用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用URL构建器</span></span><br><span class="line"><span class="keyword">const</span> buildUrl = <span class="title function_">curry</span>(<span class="function">(<span class="params">protocol, domain, path</span>) =&gt;</span> </span><br><span class="line">  <span class="string">`<span class="subst">$&#123;protocol&#125;</span>://<span class="subst">$&#123;domain&#125;</span>/<span class="subst">$&#123;path&#125;</span>`</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建特定环境URL生成器</span></span><br><span class="line"><span class="keyword">const</span> createHttpsUrl = <span class="title function_">buildUrl</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> githubUrl = <span class="title function_">createHttpsUrl</span>(<span class="string">&#x27;github.com&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> apiUrl = <span class="title function_">createHttpsUrl</span>(<span class="string">&#x27;api.example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">githubUrl</span>(<span class="string">&#x27;user/repo&#x27;</span>)); <span class="comment">// https://github.com/user/repo</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">apiUrl</span>(<span class="string">&#x27;v1/data&#x27;</span>));     <span class="comment">// https://api.example.com/v1/data</span></span><br></pre></td></tr></table></figure>

<h4 id="场景2：事件处理"><a href="#场景2：事件处理" class="headerlink" title="场景2：事件处理"></a>场景2：事件处理</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用事件监听器</span></span><br><span class="line"><span class="keyword">const</span> addListener = <span class="title function_">curry</span>(<span class="function">(<span class="params">eventType, element, handler</span>) =&gt;</span> </span><br><span class="line">  element.<span class="title function_">addEventListener</span>(eventType, handler)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建特定元素监听器</span></span><br><span class="line"><span class="keyword">const</span> addButtonListener = <span class="title function_">addListener</span>(<span class="string">&#x27;click&#x27;</span>)(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;button&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加不同按钮处理逻辑</span></span><br><span class="line"><span class="title function_">addButtonListener</span>(handleLogin);</span><br><span class="line"><span class="title function_">addButtonListener</span>(handleLogout);</span><br></pre></td></tr></table></figure>

<h4 id="场景3：数据校验"><a href="#场景3：数据校验" class="headerlink" title="场景3：数据校验"></a>场景3：数据校验</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验规则组合</span></span><br><span class="line"><span class="keyword">const</span> validate = <span class="title function_">curry</span>(<span class="function">(<span class="params">rules, value</span>) =&gt;</span> </span><br><span class="line">  rules.<span class="title function_">every</span>(<span class="function"><span class="params">rule</span> =&gt;</span> <span class="title function_">rule</span>(value))</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建特定校验器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isString</span> = v =&gt; <span class="keyword">typeof</span> v === <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">minLength</span> = len =&gt; <span class="function"><span class="params">v</span> =&gt;</span> v.<span class="property">length</span> &gt;= len;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hasNumber</span> = v =&gt; <span class="regexp">/\d/</span>.<span class="title function_">test</span>(v);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 密码校验器</span></span><br><span class="line"><span class="keyword">const</span> isValidPassword = <span class="title function_">validate</span>([</span><br><span class="line">  isString,</span><br><span class="line">  <span class="title function_">minLength</span>(<span class="number">8</span>),</span><br><span class="line">  hasNumber</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isValidPassword</span>(<span class="string">&#x27;abc123&#x27;</span>));   <span class="comment">// false (长度不足)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isValidPassword</span>(<span class="string">&#x27;securePwd1&#x27;</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="场景4：React高阶组件"><a href="#场景4：React高阶组件" class="headerlink" title="场景4：React高阶组件"></a>场景4：React高阶组件</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 柯里化HOC</span></span><br><span class="line"><span class="keyword">const</span> withFeatures = <span class="title function_">curry</span>(<span class="function">(<span class="params">features, Component</span>) =&gt;</span> </span><br><span class="line">  <span class="function"><span class="params">props</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">features</span>=<span class="string">&#123;features&#125;</span> /&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建特性注入器</span></span><br><span class="line"><span class="keyword">const</span> withAnalytics = <span class="title function_">withFeatures</span>([<span class="string">&#x27;analytics&#x27;</span>]);</span><br><span class="line"><span class="keyword">const</span> withLogger = <span class="title function_">withFeatures</span>([<span class="string">&#x27;logger&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用特性</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DashboardWithAnalytics</span> = <span class="title function_">withAnalytics</span>(<span class="title class_">Dashboard</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppWithLogger</span> = <span class="title function_">withLogger</span>(<span class="title class_">App</span>);</span><br></pre></td></tr></table></figure>

<h3 id="函数式编程实践价值"><a href="#函数式编程实践价值" class="headerlink" title="函数式编程实践价值"></a>函数式编程实践价值</h3><ol>
<li><strong>可维护性</strong>：纯函数+不可变性使代码更可预测</li>
<li><strong>可测试性</strong>：无副作用函数易于单元测试</li>
<li><strong>并发安全</strong>：避免共享状态带来的竞态条件</li>
<li><strong>模块化</strong>：函数组合实现高度复用</li>
<li><strong>调试友好</strong>：引用透明性简化问题追踪</li>
</ol>
<h3 id="使用注意事项"><a href="#使用注意事项" class="headerlink" title="使用注意事项"></a>使用注意事项</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 避免过度柯里化</span></span><br><span class="line"><span class="comment">// 反模式：curried(1)(2)(3)(4)(5)...</span></span><br><span class="line"><span class="comment">// 解决方案：合理设计参数分组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 性能考量：深度柯里化可能创建大量闭包</span></span><br><span class="line"><span class="comment">// 优化方案：限制柯里化深度，关键路径避免使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 团队协作：在非FP团队中适度使用，避免认知负担</span></span><br></pre></td></tr></table></figure>

<h3 id="现代JS中的FP支持"><a href="#现代JS中的FP支持" class="headerlink" title="现代JS中的FP支持"></a>现代JS中的FP支持</h3><table>
<thead>
<tr>
<th><strong>工具</strong></th>
<th><strong>用途</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Lodash&#x2F;fp</td>
<td>函数式工具库</td>
<td><code>_.map(_.trim, strings)</code></td>
</tr>
<tr>
<td>Ramda</td>
<td>纯函数式工具库</td>
<td><code>R.compose(R.filter(f), R.map(g))</code></td>
</tr>
<tr>
<td>React Hooks</td>
<td>函数组件+状态管理</td>
<td><code>useMemo</code>, <code>useCallback</code></td>
</tr>
<tr>
<td>Redux</td>
<td>不可变状态管理</td>
<td><code>reducer(state, action) =&gt; newState</code></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/004-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B-FP-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" data-id="cmbs36xuy000iywsd5tnge0mk" data-title="004-函数式编程[FP]深度解析" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/005-防抖与节流概念-场景-实现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/005-%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81%E6%A6%82%E5%BF%B5-%E5%9C%BA%E6%99%AF-%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:45:58.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/005-%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81%E6%A6%82%E5%BF%B5-%E5%9C%BA%E6%99%AF-%E5%AE%9E%E7%8E%B0/">005-防抖与节流概念-场景-实现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="防抖与节流：原理、实现与应用场景"><a href="#防抖与节流：原理、实现与应用场景" class="headerlink" title="防抖与节流：原理、实现与应用场景"></a>防抖与节流：原理、实现与应用场景</h1><h2 id="防抖（Debounce）"><a href="#防抖（Debounce）" class="headerlink" title="防抖（Debounce）"></a>防抖（Debounce）</h2><h3 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h3><p><strong>在事件被触发 n 秒后再执行回调，若在 n 秒内事件再次被触发，则重新计时</strong><br>确保函数只在最后一次触发后执行一次</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>搜索框输入</td>
<td>用户停止输入后再发送请求，避免频繁请求</td>
</tr>
<tr>
<td>窗口大小调整</td>
<td>窗口调整结束后再计算布局，避免重复渲染</td>
</tr>
<tr>
<td>表单验证</td>
<td>用户输入完成后再进行验证，减少实时验证开销</td>
</tr>
<tr>
<td>按钮防重</td>
<td>防止用户快速重复点击导致多次提交</td>
</tr>
<tr>
<td>实时保存</td>
<td>文档编辑时，停止输入一段时间后自动保存</td>
</tr>
</tbody></table>
<h3 id="基础实现"><a href="#基础实现" class="headerlink" title="基础实现"></a>基础实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="增强版（支持立即执行）"><a href="#增强版（支持立即执行）" class="headerlink" title="增强版（支持立即执行）"></a>增强版（支持立即执行）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay, immediate = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 立即执行模式</span></span><br><span class="line">    <span class="keyword">if</span> (immediate &amp;&amp; !timer) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 非立即执行模式</span></span><br><span class="line">      <span class="keyword">if</span> (!immediate) &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      &#125;</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用示例"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 搜索框防抖</span></span><br><span class="line"><span class="keyword">const</span> searchInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;search&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> handleSearch = <span class="title function_">debounce</span>(<span class="function"><span class="params">query</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`搜索: <span class="subst">$&#123;query&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// 实际发送搜索请求...</span></span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">searchInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">handleSearch</span>(e.<span class="property">target</span>.<span class="property">value</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 窗口调整防抖</span></span><br><span class="line"><span class="keyword">const</span> handleResize = <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;窗口调整完成&#x27;</span>);</span><br><span class="line">  <span class="comment">// 重新计算布局...</span></span><br><span class="line">&#125;, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br></pre></td></tr></table></figure>

<h2 id="节流（Throttle）"><a href="#节流（Throttle）" class="headerlink" title="节流（Throttle）"></a>节流（Throttle）</h2><h3 id="核心原理-1"><a href="#核心原理-1" class="headerlink" title="核心原理"></a>核心原理</h3><p><strong>在单位时间内，无论事件触发多少次，只执行一次回调函数</strong><br>确保函数以固定频率执行</p>
<h3 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>滚动事件</td>
<td>滚动页面时触发加载更多内容，避免高频执行</td>
</tr>
<tr>
<td>鼠标移动</td>
<td>跟踪鼠标位置，限制触发频率</td>
</tr>
<tr>
<td>游戏操作</td>
<td>限制角色移动或攻击频率</td>
</tr>
<tr>
<td>高频点击</td>
<td>限制按钮点击频率，防止误操作</td>
</tr>
<tr>
<td>动画渲染</td>
<td>保证动画帧率稳定，避免过度渲染</td>
</tr>
</tbody></table>
<h3 id="时间戳实现"><a href="#时间戳实现" class="headerlink" title="时间戳实现"></a>时间戳实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">if</span> (now - lastTime &gt;= interval) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      lastTime = now;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时器实现（支持尾执行）"><a href="#定时器实现（支持尾执行）" class="headerlink" title="定时器实现（支持尾执行）"></a>定时器实现（支持尾执行）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">const</span> remaining = interval - (now - lastTime);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 达到执行间隔</span></span><br><span class="line">    <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">      lastTime = now;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 设置尾执行</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        lastTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">      &#125;, remaining);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用示例-1"><a href="#应用示例-1" class="headerlink" title="应用示例"></a>应用示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动加载节流</span></span><br><span class="line"><span class="keyword">let</span> page = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> loadMore = <span class="title function_">throttle</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> scrollBottom = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span> - </span><br><span class="line">                      <span class="variable language_">window</span>.<span class="property">innerHeight</span> - </span><br><span class="line">                      <span class="variable language_">window</span>.<span class="property">scrollY</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (scrollBottom &lt; <span class="number">500</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`加载第 <span class="subst">$&#123;page&#125;</span> 页数据`</span>);</span><br><span class="line">    <span class="comment">// 实际加载数据...</span></span><br><span class="line">    page++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, loadMore);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 游戏攻击节流</span></span><br><span class="line"><span class="keyword">const</span> playerAttack = <span class="title function_">throttle</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;玩家发动攻击&#x27;</span>);</span><br><span class="line">  <span class="comment">// 实际攻击逻辑...</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">attackButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, playerAttack);</span><br></pre></td></tr></table></figure>

<h2 id="对比总结"><a href="#对比总结" class="headerlink" title="对比总结"></a>对比总结</h2><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>防抖</strong></th>
<th><strong>节流</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>核心思想</strong></td>
<td>延迟执行，只执行最后一次</td>
<td>固定频率执行</td>
</tr>
<tr>
<td><strong>执行时机</strong></td>
<td>停止触发后执行</td>
<td>间隔时间内执行</td>
</tr>
<tr>
<td><strong>执行次数</strong></td>
<td>多次触发只执行一次</td>
<td>多次触发按固定频率执行</td>
</tr>
<tr>
<td><strong>实现关键</strong></td>
<td><code>setTimeout</code> + <code>clearTimeout</code></td>
<td>时间戳或定时器</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>输入类事件</td>
<td>高频触发事件</td>
</tr>
<tr>
<td><strong>用户感知</strong></td>
<td>响应最后操作结果</td>
<td>保持操作流畅性</td>
</tr>
</tbody></table>
<h2 id="可视化对比"><a href="#可视化对比" class="headerlink" title="可视化对比"></a>可视化对比</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[事件触发] --&gt; B&#123;防抖模式&#125;</span><br><span class="line">  A --&gt; C&#123;节流模式&#125;</span><br><span class="line">  </span><br><span class="line">  B --&gt; D[触发1]</span><br><span class="line">  D --&gt; E[重置计时]</span><br><span class="line">  E --&gt; F[触发2]</span><br><span class="line">  F --&gt; G[重置计时]</span><br><span class="line">  G --&gt; H[触发3]</span><br><span class="line">  H --&gt; I[执行回调]</span><br><span class="line">  </span><br><span class="line">  C --&gt; J[触发1-立即执行]</span><br><span class="line">  J --&gt; K[冷却期]</span><br><span class="line">  K --&gt; L[触发2-忽略]</span><br><span class="line">  L --&gt; M[冷却结束]</span><br><span class="line">  M --&gt; N[触发3-执行]</span><br></pre></td></tr></table></figure>

<h2 id="现代开发实践"><a href="#现代开发实践" class="headerlink" title="现代开发实践"></a>现代开发实践</h2><h3 id="使用-Lodash-实现"><a href="#使用-Lodash-实现" class="headerlink" title="使用 Lodash 实现"></a>使用 Lodash 实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, throttle &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 防抖</span></span><br><span class="line"><span class="keyword">const</span> searchHandler = <span class="title function_">debounce</span>(<span class="function"><span class="params">query</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 搜索逻辑</span></span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流</span></span><br><span class="line"><span class="keyword">const</span> scrollHandler = <span class="title function_">throttle</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 滚动处理</span></span><br><span class="line">&#125;, <span class="number">300</span>);</span><br></pre></td></tr></table></figure>

<h3 id="React-Hooks-封装"><a href="#React-Hooks-封装" class="headerlink" title="React Hooks 封装"></a>React Hooks 封装</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 防抖Hook</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> callbackRef = <span class="title function_">useRef</span>(callback);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callbackRef.<span class="property">current</span> = callback;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(handler.<span class="property">timeout</span>);</span><br><span class="line">      handler.<span class="property">timeout</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        callbackRef.<span class="title function_">current</span>(...args);</span><br><span class="line">      &#125;, delay);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">  &#125;, [delay]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流Hook</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useThrottle</span>(<span class="params">callback, interval</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> callbackRef = <span class="title function_">useRef</span>(callback);</span><br><span class="line">  <span class="keyword">const</span> lastTimeRef = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    callbackRef.<span class="property">current</span> = callback;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useCallback</span>(<span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">if</span> (now - lastTimeRef.<span class="property">current</span> &gt;= interval) &#123;</span><br><span class="line">      callbackRef.<span class="title function_">current</span>(...args);</span><br><span class="line">      lastTimeRef.<span class="property">current</span> = now;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [interval]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="性能优化建议"><a href="#性能优化建议" class="headerlink" title="性能优化建议"></a>性能优化建议</h2><ol>
<li><strong>合理设置延迟时间</strong>：防抖250-500ms，节流100-300ms</li>
<li><strong>避免过度使用</strong>：只在必要时应用</li>
<li><strong>及时清理</strong>：组件卸载时清除定时器</li>
<li><strong>结合RAF</strong>：动画场景使用<code>requestAnimationFrame</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">rafThrottle</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ticking = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!ticking) &#123;</span><br><span class="line">      <span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        ticking = <span class="literal">false</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      ticking = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/005-%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81%E6%A6%82%E5%BF%B5-%E5%9C%BA%E6%99%AF-%E5%AE%9E%E7%8E%B0/" data-id="cmbs36xuz000lywsd3trd8ssx" data-title="005-防抖与节流概念-场景-实现" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/006-call-apply-bind详解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/006-call-apply-bind%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:46:49.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/006-call-apply-bind%E8%AF%A6%E8%A7%A3/">006-call-apply-bind详解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="call、apply、bind-深度解析"><a href="#call、apply、bind-深度解析" class="headerlink" title="call、apply、bind 深度解析"></a>call、apply、bind 深度解析</h1><h2 id="核心区别总结"><a href="#核心区别总结" class="headerlink" title="核心区别总结"></a>核心区别总结</h2><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><code>call</code></th>
<th><code>apply</code></th>
<th><code>bind</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>执行方式</strong></td>
<td>立即执行</td>
<td>立即执行</td>
<td>返回绑定函数</td>
</tr>
<tr>
<td><strong>参数格式</strong></td>
<td>参数列表 (arg1, arg2)</td>
<td>参数数组 [arg1, arg2]</td>
<td>参数列表 + 后续参数</td>
</tr>
<tr>
<td><strong>返回值</strong></td>
<td>函数执行结果</td>
<td>函数执行结果</td>
<td>绑定this的新函数</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>明确参数个数时</td>
<td>动态参数个数时</td>
<td>需要延迟执行时</td>
</tr>
</tbody></table>
<h2 id="详细对比与示例"><a href="#详细对比与示例" class="headerlink" title="详细对比与示例"></a>详细对比与示例</h2><h3 id="1-call-方法"><a href="#1-call-方法" class="headerlink" title="1. call 方法"></a>1. <code>call</code> 方法</h3><p><strong>语法</strong>：<code>func.call(thisArg, arg1, arg2, ...)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params">message</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;message&#125;</span>, <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>!`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用call立即调用，绑定user作为this</span></span><br><span class="line">greet.<span class="title function_">call</span>(user, <span class="string">&#x27;Hello&#x27;</span>); <span class="comment">// &quot;Hello, Alice!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-apply-方法"><a href="#2-apply-方法" class="headerlink" title="2. apply 方法"></a>2. <code>apply</code> 方法</h3><p><strong>语法</strong>：<code>func.apply(thisArg, [argsArray])</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">introduce</span>(<span class="params">job, hobby</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`我是<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>, 职业<span class="subst">$&#123;job&#125;</span>, 爱好<span class="subst">$&#123;hobby&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用apply立即调用，参数通过数组传递</span></span><br><span class="line">introduce.<span class="title function_">apply</span>(user, [<span class="string">&#x27;工程师&#x27;</span>, <span class="string">&#x27;登山&#x27;</span>]); <span class="comment">// &quot;我是Bob, 职业工程师, 爱好登山&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组最大值（经典应用）</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>]); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<h3 id="3-bind-方法"><a href="#3-bind-方法" class="headerlink" title="3. bind 方法"></a>3. <code>bind</code> 方法</h3><p><strong>语法</strong>：<code>const boundFunc = func.bind(thisArg, arg1, arg2, ...)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showScore</span>(<span class="params">subject</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>的<span class="subst">$&#123;subject&#125;</span>成绩：<span class="subst">$&#123;<span class="variable language_">this</span>.score&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> student = &#123; <span class="attr">name</span>: <span class="string">&#x27;Carol&#x27;</span>, <span class="attr">score</span>: <span class="number">95</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建绑定函数</span></span><br><span class="line"><span class="keyword">const</span> showMathScore = showScore.<span class="title function_">bind</span>(student, <span class="string">&#x27;数学&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 延迟执行</span></span><br><span class="line"><span class="built_in">setTimeout</span>(showMathScore, <span class="number">1000</span>); <span class="comment">// &quot;Carol的数学成绩：95&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="bind-实现原理"><a href="#bind-实现原理" class="headerlink" title="bind 实现原理"></a>bind 实现原理</h2><h3 id="基础版-bind-实现"><a href="#基础版-bind-实现" class="headerlink" title="基础版 bind 实现"></a>基础版 bind 实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span>(<span class="params">context, ...bindArgs</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span>; <span class="comment">// 保存原函数</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...callArgs</span>) &#123;</span><br><span class="line">    <span class="comment">// 合并预置参数和调用时参数</span></span><br><span class="line">    <span class="keyword">const</span> allArgs = bindArgs.<span class="title function_">concat</span>(callArgs);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行原函数并返回结果</span></span><br><span class="line">    <span class="keyword">return</span> self.<span class="title function_">apply</span>(context, allArgs);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">const</span> boundFunc = greet.<span class="title function_">myBind</span>(user, <span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="title function_">boundFunc</span>(); <span class="comment">// &quot;Hello, Alice!&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="增强版（支持-new-操作）"><a href="#增强版（支持-new-操作）" class="headerlink" title="增强版（支持 new 操作）"></a>增强版（支持 new 操作）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span>(<span class="params">context, ...bindArgs</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> boundFunc = <span class="keyword">function</span>(<span class="params">...callArgs</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> allArgs = bindArgs.<span class="title function_">concat</span>(callArgs);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否通过new调用</span></span><br><span class="line">    <span class="keyword">const</span> isNewCall = <span class="variable language_">this</span> <span class="keyword">instanceof</span> boundFunc;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> self.<span class="title function_">apply</span>(</span><br><span class="line">      isNewCall ? <span class="variable language_">this</span> : context,</span><br><span class="line">      allArgs</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 继承原型链（保持instanceof关系）</span></span><br><span class="line">  boundFunc.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(self.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> boundFunc;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试构造函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BoundPerson</span> = <span class="title class_">Person</span>.<span class="title function_">myBind</span>(<span class="literal">null</span>, <span class="string">&#x27;Dave&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">BoundPerson</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p <span class="keyword">instanceof</span> <span class="title class_">Person</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="bind-后的-this-能否修改？"><a href="#bind-后的-this-能否修改？" class="headerlink" title="bind 后的 this 能否修改？"></a>bind 后的 this 能否修改？</h2><h3 id="关键结论"><a href="#关键结论" class="headerlink" title="关键结论"></a>关键结论</h3><p><strong>bind 创建的函数无法通过 call&#x2F;apply 再次修改 this 绑定</strong><br>原因：bind 返回的是绑定函数（Bound Function），其内部已固定 this 指向</p>
<h3 id="验证实验"><a href="#验证实验" class="headerlink" title="验证实验"></a>验证实验</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;对象1&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">&#x27;对象2&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showName</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定到obj1</span></span><br><span class="line"><span class="keyword">const</span> boundFunc = showName.<span class="title function_">bind</span>(obj1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试用call修改this</span></span><br><span class="line">boundFunc.<span class="title function_">call</span>(obj2); <span class="comment">// 输出：&quot;对象1&quot;（未被修改）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试用apply修改this</span></span><br><span class="line">boundFunc.<span class="title function_">apply</span>(obj2); <span class="comment">// 输出：&quot;对象1&quot;（未被修改）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 尝试二次bind</span></span><br><span class="line"><span class="keyword">const</span> reboundFunc = boundFunc.<span class="title function_">bind</span>(obj2);</span><br><span class="line"><span class="title function_">reboundFunc</span>(); <span class="comment">// 输出：&quot;对象1&quot;（仍未被修改）</span></span><br></pre></td></tr></table></figure>

<h3 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h3><ol>
<li><p><strong>绑定函数特性</strong><br>ECMAScript 规范规定：绑定函数在调用时会忽略传入的 this 值，始终使用创建时绑定的 this</p>
</li>
<li><p>**内部属性 [[BoundThis]]**<br>绑定函数内部维护一个 [[BoundThis]] 属性，存储原始绑定值</p>
</li>
<li><p><strong>调用优先级</strong><br>绑定函数的执行优先级：[[BoundThis]] &gt; call&#x2F;apply 参数 &gt; 默认绑定</p>
</li>
</ol>
<h3 id="特殊情况：new-操作符"><a href="#特殊情况：new-操作符" class="headerlink" title="特殊情况：new 操作符"></a>特殊情况：new 操作符</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Admin</span> = <span class="title class_">User</span>.<span class="title function_">bind</span>(&#123; <span class="attr">role</span>: <span class="string">&#x27;admin&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过new调用</span></span><br><span class="line"><span class="keyword">const</span> admin = <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="string">&#x27;SuperUser&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(admin.<span class="property">name</span>); <span class="comment">// &quot;SuperUser&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(admin.<span class="property">role</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p><strong>原理</strong>：<br>当使用 new 操作符调用绑定函数时：</p>
<ol>
<li>创建新对象（忽略 [[BoundThis]]）</li>
<li>执行构造函数初始化</li>
<li>新对象的原型指向绑定函数的 prototype</li>
</ol>
<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><h3 id="场景1：事件处理（React）"><a href="#场景1：事件处理（React）" class="headerlink" title="场景1：事件处理（React）"></a>场景1：事件处理（React）</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="comment">// 提前绑定避免每次渲染创建新函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleClick</span> = <span class="variable language_">this</span>.<span class="property">handleClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="场景2：部分参数应用"><a href="#场景2：部分参数应用" class="headerlink" title="场景2：部分参数应用"></a>场景2：部分参数应用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建通用日志函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">level, message</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[<span class="subst">$&#123;level&#125;</span>] <span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定第一个参数</span></span><br><span class="line"><span class="keyword">const</span> logError = log.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;ERROR&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> logInfo = log.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="string">&#x27;INFO&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用</span></span><br><span class="line"><span class="title function_">logError</span>(<span class="string">&#x27;数据库连接失败&#x27;</span>); <span class="comment">// [ERROR] 数据库连接失败</span></span><br><span class="line"><span class="title function_">logInfo</span>(<span class="string">&#x27;用户登录成功&#x27;</span>);   <span class="comment">// [INFO] 用户登录成功</span></span><br></pre></td></tr></table></figure>

<h3 id="场景3：定时器回调"><a href="#场景3：定时器回调" class="headerlink" title="场景3：定时器回调"></a>场景3：定时器回调</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">seconds</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 绑定保证回调中的this正确</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tick</span> = <span class="variable language_">this</span>.<span class="property">tick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="variable language_">this</span>.<span class="property">tick</span>, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">tick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">seconds</span>++;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`已运行：<span class="subst">$&#123;<span class="variable language_">this</span>.seconds&#125;</span>秒`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="原型链关系图"><a href="#原型链关系图" class="headerlink" title="原型链关系图"></a>原型链关系图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[原生函数] --&gt; B[bind创建]</span><br><span class="line">  B --&gt; C[绑定函数]</span><br><span class="line">  C --&gt; D[[内部属性]]</span><br><span class="line">  D --&gt; E[[BoundThis]]</span><br><span class="line">  D --&gt; F[[BoundArguments]]</span><br><span class="line">  D --&gt; G[[BoundTargetFunction]]</span><br><span class="line">  H[new操作] --&gt; I[创建新对象]</span><br><span class="line">  I --&gt; J[忽略BoundThis]</span><br><span class="line">  J --&gt; K[执行构造函数]</span><br></pre></td></tr></table></figure>

<h2 id="面试要点总结"><a href="#面试要点总结" class="headerlink" title="面试要点总结"></a>面试要点总结</h2><ol>
<li><p><strong>bind 后的函数特性</strong></p>
<ul>
<li>无法通过 call&#x2F;apply 修改 this 绑定</li>
<li>参数可以部分应用（柯里化）</li>
<li>使用 new 调用时忽略绑定的 this</li>
</ul>
</li>
<li><p><strong>设计原理</strong></p>
<ul>
<li>绑定函数内部维护 [[BoundThis]] 属性</li>
<li>执行时优先使用 [[BoundThis]]</li>
<li>规范定义的绑定函数行为不可变</li>
</ul>
</li>
<li><p><strong>最佳实践</strong></p>
<ul>
<li>类组件中在构造函数提前绑定</li>
<li>避免在渲染中创建绑定函数（性能优化）</li>
<li>利用参数绑定简化函数调用</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/006-call-apply-bind%E8%AF%A6%E8%A7%A3/" data-id="cmbs36xuz000nywsd4wux3vnm" data-title="006-call-apply-bind详解" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/007-闭包的概念和使用场景" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/007-%E9%97%AD%E5%8C%85%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:47:04.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/007-%E9%97%AD%E5%8C%85%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/">007-闭包的概念和使用场景</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="闭包：概念解析与应用场景全解"><a href="#闭包：概念解析与应用场景全解" class="headerlink" title="闭包：概念解析与应用场景全解"></a>闭包：概念解析与应用场景全解</h1><h2 id="闭包核心概念"><a href="#闭包核心概念" class="headerlink" title="闭包核心概念"></a>闭包核心概念</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p><strong>闭包（Closure）</strong> 是指<strong>能够访问其外部函数作用域中变量的函数</strong>，即使外部函数已经执行结束。闭包由两部分组成：</p>
<ol>
<li>函数</li>
<li>创建该函数时所在的作用域环境</li>
</ol>
<h3 id="关键特性"><a href="#关键特性" class="headerlink" title="关键特性"></a>关键特性</h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>作用域保留</td>
<td>闭包会保留其外部函数的作用域链，即使外部函数已执行完毕</td>
</tr>
<tr>
<td>变量持久化</td>
<td>外部函数的变量不会被垃圾回收，而是被闭包长期引用</td>
</tr>
<tr>
<td>状态封装</td>
<td>通过闭包可以创建私有变量，实现数据封装</td>
</tr>
</tbody></table>
<h2 id="闭包经典应用场景"><a href="#闭包经典应用场景" class="headerlink" title="闭包经典应用场景"></a>闭包经典应用场景</h2><h3 id="场景1：模块化开发（私有变量封装）"><a href="#场景1：模块化开发（私有变量封装）" class="headerlink" title="场景1：模块化开发（私有变量封装）"></a>场景1：模块化开发（私有变量封装）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计数器模块</span></span><br><span class="line"><span class="keyword">const</span> counter = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 私有变量</span></span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 公共接口</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ++count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> --count;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getValue</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getValue</span>()); <span class="comment">// 0</span></span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line">counter.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getValue</span>()); <span class="comment">// 2</span></span><br><span class="line">counter.<span class="title function_">decrement</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter.<span class="title function_">getValue</span>()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h3 id="场景2：函数工厂（动态函数创建）"><a href="#场景2：函数工厂（动态函数创建）" class="headerlink" title="场景2：函数工厂（动态函数创建）"></a>场景2：函数工厂（动态函数创建）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建幂函数工厂</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">powerFactory</span>(<span class="params">exponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">base</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">pow</span>(base, exponent);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建特定幂函数</span></span><br><span class="line"><span class="keyword">const</span> square = <span class="title function_">powerFactory</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> cube = <span class="title function_">powerFactory</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">square</span>(<span class="number">4</span>)); <span class="comment">// 16 (4^2)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">cube</span>(<span class="number">3</span>));   <span class="comment">// 27 (3^3)</span></span><br></pre></td></tr></table></figure>

<h3 id="场景3：事件处理（保留上下文）"><a href="#场景3：事件处理（保留上下文）" class="headerlink" title="场景3：事件处理（保留上下文）"></a>场景3：事件处理（保留上下文）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按钮列表事件处理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupButtons</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> buttons = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.btn&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; buttons.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 使用闭包保留每个按钮的索引</span></span><br><span class="line">    (<span class="keyword">function</span>(<span class="params">index</span>) &#123;</span><br><span class="line">      buttons[index].<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`按钮 <span class="subst">$&#123;index + <span class="number">1</span>&#125;</span> 被点击`</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 替代方案（使用let块级作用域）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupButtonsModern</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> buttons = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.btn&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; buttons.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    buttons[i].<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`按钮 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span> 被点击`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="场景4：函数柯里化"><a href="#场景4：函数柯里化" class="headerlink" title="场景4：函数柯里化"></a>场景4：函数柯里化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 柯里化函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">curried</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &gt;= fn.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">...nextArgs</span>) =&gt;</span> curried.<span class="title function_">apply</span>(<span class="variable language_">this</span>, [...args, ...nextArgs]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用柯里化</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="title function_">curry</span>(<span class="function">(<span class="params">a, b, c</span>) =&gt;</span> a + b + c);</span><br><span class="line"><span class="keyword">const</span> addFive = <span class="title function_">add</span>(<span class="number">2</span>)(<span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">addFive</span>(<span class="number">5</span>)); <span class="comment">// 10 (2+3+5)</span></span><br></pre></td></tr></table></figure>

<h3 id="场景5：状态管理"><a href="#场景5：状态管理" class="headerlink" title="场景5：状态管理"></a>场景5：状态管理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 状态管理器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createState</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> state = initialValue;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">      state = newValue;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 高级功能：状态变更订阅</span></span><br><span class="line">    <span class="title function_">subscribe</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">listener</span> = (<span class="params"></span>) =&gt; <span class="title function_">callback</span>(state);</span><br><span class="line">      <span class="comment">// 模拟订阅机制</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;stateChange&#x27;</span>, listener);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 返回取消订阅函数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;stateChange&#x27;</span>, listener);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用状态管理器</span></span><br><span class="line"><span class="keyword">const</span> userState = <span class="title function_">createState</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(userState.<span class="title function_">get</span>()); <span class="comment">// &#123;name: &#x27;Alice&#x27;, age: 30&#125;</span></span><br><span class="line">userState.<span class="title function_">set</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(userState.<span class="title function_">get</span>()); <span class="comment">// &#123;name: &#x27;Bob&#x27;, age: 25&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="场景6：性能优化（记忆化）"><a href="#场景6：性能优化（记忆化）" class="headerlink" title="场景6：性能优化（记忆化）"></a>场景6：性能优化（记忆化）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记忆化函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">memoize</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// 创建缓存键</span></span><br><span class="line">    <span class="keyword">const</span> key = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(args);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查缓存</span></span><br><span class="line">    <span class="keyword">if</span> (cache.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache.<span class="title function_">get</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算并缓存结果</span></span><br><span class="line">    <span class="keyword">const</span> result = fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    cache.<span class="title function_">set</span>(key, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用记忆化</span></span><br><span class="line"><span class="keyword">const</span> fibonacci = <span class="title function_">memoize</span>(<span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fibonacci</span>(<span class="number">10</span>)); <span class="comment">// 55（首次计算）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fibonacci</span>(<span class="number">10</span>)); <span class="comment">// 55（从缓存读取）</span></span><br></pre></td></tr></table></figure>

<h2 id="React-Vue-中的闭包应用"><a href="#React-Vue-中的闭包应用" class="headerlink" title="React&#x2F;Vue 中的闭包应用"></a>React&#x2F;Vue 中的闭包应用</h2><h3 id="React-Hooks-示例"><a href="#React-Hooks-示例" class="headerlink" title="React Hooks 示例"></a>React Hooks 示例</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// useState 内部使用闭包保存状态</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// useEffect 使用闭包保留回调函数</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 闭包保留最新count值</span></span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">  &#125;, []); <span class="comment">// 依赖数组为空，只运行一次</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>计数: &#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Vue-Composition-API-示例"><a href="#Vue-Composition-API-示例" class="headerlink" title="Vue Composition API 示例"></a>Vue Composition API 示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted, onUnmounted &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// ref 使用闭包保存响应式状态</span><br><span class="line">const count = ref(0);</span><br><span class="line"></span><br><span class="line">// 定时器使用闭包访问最新值</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  const timer = setInterval(() =&gt; &#123;</span><br><span class="line">    count.value++;</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">  </span><br><span class="line">  // 清理函数使用闭包</span><br><span class="line">  onUnmounted(() =&gt; &#123;</span><br><span class="line">    clearInterval(timer);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;计数: &#123;&#123; count &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="闭包常见问题与解决方案"><a href="#闭包常见问题与解决方案" class="headerlink" title="闭包常见问题与解决方案"></a>闭包常见问题与解决方案</h2><h3 id="问题1：循环中的闭包陷阱"><a href="#问题1：循环中的闭包陷阱" class="headerlink" title="问题1：循环中的闭包陷阱"></a>问题1：循环中的闭包陷阱</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// 全部输出5</span></span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案1：IIFE创建闭包</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  (<span class="keyword">function</span>(<span class="params">j</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(j); <span class="comment">// 0,1,2,3,4</span></span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案2：使用let块级作用域</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// 0,1,2,3,4</span></span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="问题2：内存泄漏"><a href="#问题2：内存泄漏" class="headerlink" title="问题2：内存泄漏"></a>问题2：内存泄漏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大型对象保留在闭包中</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createHeavyObjectHolder</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> largeObject = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> largeObject[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案：不再需要时解除引用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSafeHolder</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> largeObject = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>).<span class="title function_">fill</span>(<span class="string">&#x27;data&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> api = &#123;</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> largeObject[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 提供清理方法</span></span><br><span class="line">  api.<span class="property">cleanup</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    largeObject = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> api;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> holder = <span class="title function_">createSafeHolder</span>();</span><br><span class="line"><span class="comment">// 使用完成后清理</span></span><br><span class="line">holder.<span class="title function_">cleanup</span>();</span><br></pre></td></tr></table></figure>

<h2 id="闭包性能优化技巧"><a href="#闭包性能优化技巧" class="headerlink" title="闭包性能优化技巧"></a>闭包性能优化技巧</h2><ol>
<li><strong>避免不必要的闭包</strong>：只在需要封装状态时使用</li>
<li><strong>最小化闭包范围</strong>：减少闭包中引用的变量数量</li>
<li><strong>及时解除引用</strong>：不再需要的闭包手动设置为null</li>
<li><strong>使用模块模式</strong>：替代多个小型闭包</li>
<li><strong>避免循环中创建闭包</strong>：改用块级作用域变量</li>
</ol>
<h2 id="闭包与垃圾回收"><a href="#闭包与垃圾回收" class="headerlink" title="闭包与垃圾回收"></a>闭包与垃圾回收</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[函数执行完毕] --&gt; B&#123;内部变量是否被引用&#125;</span><br><span class="line">  B --&gt;|被闭包引用| C[保留在内存中]</span><br><span class="line">  B --&gt;|未被引用| D[标记为可回收]</span><br><span class="line">  C --&gt; E[闭包不再被引用]</span><br><span class="line">  E --&gt; D</span><br></pre></td></tr></table></figure>

<h2 id="经典面试题解析"><a href="#经典面试题解析" class="headerlink" title="经典面试题解析"></a>经典面试题解析</h2><h3 id="题目1：闭包输出问题"><a href="#题目1：闭包输出问题" class="headerlink" title="题目1：闭包输出问题"></a>题目1：闭包输出问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createFunctions</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = [];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    result[i] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> funcs = <span class="title function_">createFunctions</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(funcs[<span class="number">0</span>]()); <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(funcs[<span class="number">1</span>]()); <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(funcs[<span class="number">2</span>]()); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p><strong>解析</strong>：所有闭包共享同一个变量i，循环结束时i&#x3D;3</p>
<h3 id="题目2：闭包计数器"><a href="#题目2：闭包计数器" class="headerlink" title="题目2：闭包计数器"></a>题目2：闭包计数器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">increment</span>: <span class="function">() =&gt;</span> count++,</span><br><span class="line">    <span class="attr">get</span>: <span class="function">() =&gt;</span> count,</span><br><span class="line">    <span class="attr">reset</span>: <span class="function">() =&gt;</span> &#123; count = <span class="number">0</span>; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="title function_">createCounter</span>();</span><br><span class="line">c.<span class="title function_">increment</span>();</span><br><span class="line">c.<span class="title function_">increment</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="title function_">get</span>()); <span class="comment">// 2</span></span><br><span class="line">c.<span class="title function_">reset</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="title function_">get</span>()); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<p><strong>解析</strong>：通过闭包实现私有变量count的封装</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="闭包核心价值"><a href="#闭包核心价值" class="headerlink" title="闭包核心价值"></a>闭包核心价值</h3><table>
<thead>
<tr>
<th><strong>应用方向</strong></th>
<th><strong>价值体现</strong></th>
</tr>
</thead>
<tbody><tr>
<td>数据封装</td>
<td>创建私有变量，实现信息隐藏</td>
</tr>
<tr>
<td>状态保持</td>
<td>长期保存数据，不受外部函数执行结束影响</td>
</tr>
<tr>
<td>函数工厂</td>
<td>动态生成特定配置的函数</td>
</tr>
<tr>
<td>模块化</td>
<td>构建独立作用域，避免全局污染</td>
</tr>
<tr>
<td>高阶函数</td>
<td>实现函数组合、柯里化等高级功能</td>
</tr>
<tr>
<td>异步编程</td>
<td>在回调中保持上下文一致性</td>
</tr>
</tbody></table>
<h3 id="使用原则"><a href="#使用原则" class="headerlink" title="使用原则"></a>使用原则</h3><ol>
<li><strong>必要性原则</strong>：只在需要封装状态时使用闭包</li>
<li><strong>最小化原则</strong>：保持闭包作用域尽可能小</li>
<li><strong>可控性原则</strong>：提供清理机制避免内存泄漏</li>
<li><strong>可维护性原则</strong>：避免过度嵌套的闭包结构</li>
</ol>
<p>闭包是JavaScript最强大的特性之一，合理使用闭包可以：</p>
<ul>
<li>✅ 创建优雅的模块化代码</li>
<li>✅ 实现高效的状态管理</li>
<li>✅ 封装复杂的业务逻辑</li>
<li>✅ 构建可复用的函数工厂</li>
</ul>
<p>但同时要注意：</p>
<ul>
<li>❌ 避免不必要的内存占用</li>
<li>❌ 防止意外的变量共享</li>
<li>❌ 警惕循环引用导致的内存泄漏</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/007-%E9%97%AD%E5%8C%85%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/" data-id="cmbs36xv0000rywsd2jxtcqby" data-title="007-闭包的概念和使用场景" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/008-ES5-实现-ES6-类继承：深度解析与完整实现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/008-ES5-%E5%AE%9E%E7%8E%B0-ES6-%E7%B1%BB%E7%BB%A7%E6%89%BF%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:47:19.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/008-ES5-%E5%AE%9E%E7%8E%B0-ES6-%E7%B1%BB%E7%BB%A7%E6%89%BF%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0/">008-ES5 实现 ES6 类继承：深度解析与完整实现</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ES5-实现-ES6-类继承：深度解析与完整实现"><a href="#ES5-实现-ES6-类继承：深度解析与完整实现" class="headerlink" title="ES5 实现 ES6 类继承：深度解析与完整实现"></a>ES5 实现 ES6 类继承：深度解析与完整实现</h1><h2 id="ES6-类继承回顾"><a href="#ES6-类继承回顾" class="headerlink" title="ES6 类继承回顾"></a>ES6 类继承回顾</h2><h3 id="ES6-类继承示例"><a href="#ES6-类继承示例" class="headerlink" title="ES6 类继承示例"></a>ES6 类继承示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> makes a noise.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">info</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Animal class&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, breed</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breed</span> = breed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">speak</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> barks!`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">info</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">info</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Dog class&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rex = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Rex&#x27;</span>, <span class="string">&#x27;Labrador&#x27;</span>);</span><br><span class="line">rex.<span class="title function_">speak</span>();</span><br><span class="line"><span class="comment">// Rex makes a noise.</span></span><br><span class="line"><span class="comment">// Rex barks!</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Dog</span>.<span class="title function_">info</span>();</span><br><span class="line"><span class="comment">// Animal class</span></span><br><span class="line"><span class="comment">// Dog class</span></span><br></pre></td></tr></table></figure>

<h2 id="ES5-实现-ES6-类继承"><a href="#ES5-实现-ES6-类继承" class="headerlink" title="ES5 实现 ES6 类继承"></a>ES5 实现 ES6 类继承</h2><h3 id="完整实现方案"><a href="#完整实现方案" class="headerlink" title="完整实现方案"></a>完整实现方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 实现父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 父类原型方法</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; makes a noise.&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 父类静态方法</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property">info</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Animal class&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 实现子类继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, breed</span>) &#123;</span><br><span class="line">  <span class="comment">// 调用父类构造函数 (模拟 super(name))</span></span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">breed</span> = breed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 建立原型链 (关键步骤)</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Dog</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 子类原型方法 (重写父类方法)</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用父类方法 (模拟 super.speak())</span></span><br><span class="line">  <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27; barks!&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. 继承静态方法 (ES6 类继承的静态方法也会被继承)</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Dog</span>, <span class="title class_">Animal</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 子类静态方法 (重写父类静态方法)</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property">info</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用父类静态方法 (模拟 super.info())</span></span><br><span class="line">  <span class="title class_">Animal</span>.<span class="property">info</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Dog class&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> rex = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Rex&#x27;</span>, <span class="string">&#x27;Labrador&#x27;</span>);</span><br><span class="line">rex.<span class="title function_">speak</span>();</span><br><span class="line"><span class="comment">// Rex makes a noise.</span></span><br><span class="line"><span class="comment">// Rex barks!</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Dog</span>.<span class="title function_">info</span>();</span><br><span class="line"><span class="comment">// Animal class</span></span><br><span class="line"><span class="comment">// Dog class</span></span><br></pre></td></tr></table></figure>

<h2 id="关键继承技术详解"><a href="#关键继承技术详解" class="headerlink" title="关键继承技术详解"></a>关键继承技术详解</h2><h3 id="1-原型链继承"><a href="#1-原型链继承" class="headerlink" title="1. 原型链继承"></a>1. 原型链继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础实现</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题：父类构造函数被调用两次（创建原型时和实例化时）</span></span><br><span class="line"><span class="comment">// 解决方案：使用 Object.create</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-构造函数继承"><a href="#2-构造函数继承" class="headerlink" title="2. 构造函数继承"></a>2. 构造函数继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用父类构造函数</span></span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-组合继承（经典模式）"><a href="#3-组合继承（经典模式）" class="headerlink" title="3. 组合继承（经典模式）"></a>3. 组合继承（经典模式）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello, &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name); <span class="comment">// 第二次调用Parent</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>(); <span class="comment">// 第一次调用Parent</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题：父类构造函数被调用两次</span></span><br></pre></td></tr></table></figure>

<h3 id="4-寄生组合继承（最优方案）"><a href="#4-寄生组合继承（最优方案）" class="headerlink" title="4. 寄生组合继承（最优方案）"></a>4. 寄生组合继承（最优方案）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inherit</span>(<span class="params">Child, Parent</span>) &#123;</span><br><span class="line">  <span class="comment">// 创建原型对象</span></span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  <span class="comment">// 修正构造函数指针</span></span><br><span class="line">  prototype.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br><span class="line">  <span class="comment">// 设置子类原型</span></span><br><span class="line">  <span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">  <span class="comment">// 设置静态继承</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">inherit</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br></pre></td></tr></table></figure>

<h2 id="各种继承方式对比"><a href="#各种继承方式对比" class="headerlink" title="各种继承方式对比"></a>各种继承方式对比</h2><table>
<thead>
<tr>
<th><strong>继承方式</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
<th><strong>原型链</strong></th>
<th><strong>实例属性</strong></th>
</tr>
</thead>
<tbody><tr>
<td>原型链继承</td>
<td>简单</td>
<td>1. 引用类型共享问题<br>2. 无法传参</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>构造函数继承</td>
<td>1. 解决引用类型问题<br>2. 可传参</td>
<td>无法继承原型方法</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>组合继承</td>
<td>1. 实例属性独立<br>2. 方法复用</td>
<td>父类构造函数调用两次</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>原型式继承</td>
<td>简单对象继承</td>
<td>引用类型共享问题</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>寄生式继承</td>
<td>增强对象</td>
<td>方法不能复用</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>寄生组合继承</strong></td>
<td><strong>最优方案（ES5实现ES6类继承）</strong></td>
<td>实现稍复杂</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>ES6类继承</td>
<td>语法简洁</td>
<td>需要现代JS环境</td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody></table>
<h2 id="特殊继承场景处理"><a href="#特殊继承场景处理" class="headerlink" title="特殊继承场景处理"></a>特殊继承场景处理</h2><h3 id="1-多继承实现"><a href="#1-多继承实现" class="headerlink" title="1. 多继承实现"></a>1. 多继承实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 混入(Mixin)模式实现多继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mixin</span>(<span class="params">target, ...sources</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">assign</span>(target.<span class="property"><span class="keyword">prototype</span></span>, ...sources.<span class="title function_">map</span>(<span class="function"><span class="params">src</span> =&gt;</span> src.<span class="property"><span class="keyword">prototype</span></span>));</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义可混入的功能</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CanSwim</span> = &#123;</span><br><span class="line">  <span class="title function_">swim</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is swimming`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CanFly</span> = &#123;</span><br><span class="line">  <span class="title function_">fly</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> is flying`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建混合类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Duck</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承Animal</span></span><br><span class="line"><span class="title class_">Duck</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Duck</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Duck</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混入功能</span></span><br><span class="line"><span class="title function_">mixin</span>(<span class="title class_">Duck</span>, <span class="title class_">CanSwim</span>, <span class="title class_">CanFly</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> donald = <span class="keyword">new</span> <span class="title class_">Duck</span>(<span class="string">&#x27;Donald&#x27;</span>);</span><br><span class="line">donald.<span class="title function_">swim</span>(); <span class="comment">// Donald is swimming</span></span><br><span class="line">donald.<span class="title function_">fly</span>();  <span class="comment">// Donald is flying</span></span><br></pre></td></tr></table></figure>

<h3 id="2-静态属性和方法继承"><a href="#2-静态属性和方法继承" class="headerlink" title="2. 静态属性和方法继承"></a>2. 静态属性和方法继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property">staticProp</span> = <span class="string">&#x27;Parent Static&#x27;</span>;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property">staticMethod</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Parent static method&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Child</span>.<span class="property">staticProp</span>); <span class="comment">// &#x27;Parent Static&#x27;</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="title function_">staticMethod</span>(); <span class="comment">// &#x27;Parent static method&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-私有字段模拟"><a href="#3-私有字段模拟" class="headerlink" title="3. 私有字段模拟"></a>3. 私有字段模拟</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用WeakMap模拟私有字段</span></span><br><span class="line"><span class="keyword">const</span> privateData = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    privateData.<span class="title function_">set</span>(<span class="variable language_">this</span>, &#123; name &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> privateData.<span class="title function_">get</span>(<span class="variable language_">this</span>).<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> privateFields = &#123; name &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> privateFields.<span class="property">name</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="原型链关系图解"><a href="#原型链关系图解" class="headerlink" title="原型链关系图解"></a>原型链关系图解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[rex: Dog实例] --&gt; B[[__proto__]]</span><br><span class="line">  B --&gt; C[Dog.prototype]</span><br><span class="line">  C --&gt; D[[constructor]]</span><br><span class="line">  D --&gt; E[Dog构造函数]</span><br><span class="line">  C --&gt; F[[__proto__]]</span><br><span class="line">  F --&gt; G[Animal.prototype]</span><br><span class="line">  G --&gt; H[[constructor]]</span><br><span class="line">  H --&gt; I[Animal构造函数]</span><br><span class="line">  G --&gt; J[[__proto__]]</span><br><span class="line">  J --&gt; K[Object.prototype]</span><br><span class="line">  K --&gt; L[[__proto__]]</span><br><span class="line">  L --&gt; M[null]</span><br><span class="line">  </span><br><span class="line">  E --&gt; N[[__proto__]]</span><br><span class="line">  N --&gt; O[Animal构造函数]</span><br><span class="line">  O --&gt; P[[__proto__]]</span><br><span class="line">  P --&gt; Q[Function.prototype]</span><br><span class="line">  </span><br><span class="line">  style A fill:#f9f,stroke:#333</span><br><span class="line">  style E fill:#bbf,stroke:#333</span><br><span class="line">  style I fill:#bbf,stroke:#333</span><br></pre></td></tr></table></figure>

<h2 id="继承的现代演进"><a href="#继承的现代演进" class="headerlink" title="继承的现代演进"></a>继承的现代演进</h2><h3 id="1-ES6-类继承"><a href="#1-ES6-类继承" class="headerlink" title="1. ES6 类继承"></a>1. ES6 类继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> makes a noise.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, breed</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">breed</span> = breed;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">speak</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> barks!`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-使用-Reflect-优化"><a href="#2-使用-Reflect-优化" class="headerlink" title="2. 使用 Reflect 优化"></a>2. 使用 Reflect 优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="comment">// 使用Reflect.construct优化</span></span><br><span class="line">  <span class="keyword">const</span> instance = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Parent</span>, [name], <span class="keyword">new</span>.<span class="property">target</span>);</span><br><span class="line">  instance.<span class="property">age</span> = age;</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置原型链</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(child <span class="keyword">instanceof</span> <span class="title class_">Parent</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-使用-class-语法糖转译"><a href="#3-使用-class-语法糖转译" class="headerlink" title="3. 使用 class 语法糖转译"></a>3. 使用 class 语法糖转译</h3><p>Babel 将 ES6 类转译为 ES5 的代码结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Babel 转译后</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_inherits</span>(<span class="params">subClass, superClass</span>) &#123;</span><br><span class="line">  subClass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superClass &amp;&amp; superClass.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">    <span class="attr">constructor</span>: &#123; <span class="attr">value</span>: subClass, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (superClass) <span class="title function_">_setPrototypeOf</span>(subClass, superClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_setPrototypeOf</span>(<span class="params">o, p</span>) &#123;</span><br><span class="line">  _setPrototypeOf = <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> || </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_setPrototypeOf</span>(<span class="params">o, p</span>) &#123; o.<span class="property">__proto__</span> = p; <span class="keyword">return</span> o; &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_setPrototypeOf</span>(o, p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Child</span> = (<span class="keyword">function</span>(<span class="params">_Parent</span>) &#123;</span><br><span class="line">  <span class="title function_">_inherits</span>(<span class="title class_">Child</span>, _Parent);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Child</span>);</span><br><span class="line">    <span class="keyword">return</span> _Parent.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>) || <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Child</span>;</span><br><span class="line">&#125;)(<span class="title class_">Parent</span>);</span><br></pre></td></tr></table></figure>

<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><h3 id="1-UI-组件继承"><a href="#1-UI-组件继承" class="headerlink" title="1. UI 组件继承"></a>1. UI 组件继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基类：UI组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UIComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">element</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">UIComponent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">element</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="title class_">UIComponent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">text</span> = text;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">textContent</span> = text;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">className</span> = <span class="string">&#x27;btn&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承</span></span><br><span class="line"><span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">UIComponent</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Button</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加新方法</span></span><br><span class="line"><span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onClick</span> = <span class="keyword">function</span>(<span class="params">handler</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">element</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handler);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> myButton = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="string">&#x27;Click Me&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(myButton.<span class="title function_">render</span>());</span><br><span class="line">myButton.<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;Clicked!&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="2-数据模型继承"><a href="#2-数据模型继承" class="headerlink" title="2. 数据模型继承"></a>2. 数据模型继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基类：数据库模型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Model</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Model</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">save</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Saving <span class="subst">$&#123;<span class="variable language_">this</span>.constructor.name&#125;</span> to database`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户模型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name, email</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">email</span> = email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承</span></span><br><span class="line"><span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Model</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加用户特定方法</span></span><br><span class="line"><span class="title class_">User</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sendWelcomeEmail</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Sending welcome email to <span class="subst">$&#123;<span class="variable language_">this</span>.email&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;alice@example.com&#x27;</span>);</span><br><span class="line">user.<span class="title function_">save</span>(); <span class="comment">// Saving User to database</span></span><br><span class="line">user.<span class="title function_">sendWelcomeEmail</span>(); <span class="comment">// Sending welcome email to alice@example.com</span></span><br></pre></td></tr></table></figure>

<h2 id="面试重点问题解答"><a href="#面试重点问题解答" class="headerlink" title="面试重点问题解答"></a>面试重点问题解答</h2><h3 id="1-new-关键字执行过程"><a href="#1-new-关键字执行过程" class="headerlink" title="1. new 关键字执行过程"></a>1. <code>new</code> 关键字执行过程</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">Constructor, ...args</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 创建空对象并链接原型</span></span><br><span class="line">  <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. 绑定this并执行构造函数</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title class_">Constructor</span>.<span class="title function_">apply</span>(obj, args);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. 返回对象（如果构造函数返回对象则使用它）</span></span><br><span class="line">  <span class="keyword">return</span> result <span class="keyword">instanceof</span> <span class="title class_">Object</span> ? result : obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> rex = <span class="title function_">myNew</span>(<span class="title class_">Dog</span>, <span class="string">&#x27;Rex&#x27;</span>, <span class="string">&#x27;Labrador&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-instanceof-原理实现"><a href="#2-instanceof-原理实现" class="headerlink" title="2. instanceof 原理实现"></a>2. <code>instanceof</code> 原理实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">obj, constructor</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取对象的原型</span></span><br><span class="line">  <span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (proto) &#123;</span><br><span class="line">    <span class="comment">// 找到原型匹配</span></span><br><span class="line">    <span class="keyword">if</span> (proto === constructor.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 继续向上查找</span></span><br><span class="line">    proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(proto);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-为什么寄生组合继承是最佳方案？"><a href="#3-为什么寄生组合继承是最佳方案？" class="headerlink" title="3. 为什么寄生组合继承是最佳方案？"></a>3. 为什么寄生组合继承是最佳方案？</h3><ol>
<li><strong>效率高</strong>：只调用一次父类构造函数</li>
<li><strong>原型链纯净</strong>：子类原型不包含父类实例属性</li>
<li><strong>完整性</strong>：保留完整的原型链关系</li>
<li><strong>无冗余</strong>：实例属性不会重复创建</li>
<li><strong>支持静态继承</strong>：通过 <code>Object.setPrototypeOf</code> 实现</li>
</ol>
<h2 id="总结与最佳实践"><a href="#总结与最佳实践" class="headerlink" title="总结与最佳实践"></a>总结与最佳实践</h2><h3 id="继承选择指南"><a href="#继承选择指南" class="headerlink" title="继承选择指南"></a>继承选择指南</h3><ol>
<li><strong>现代项目</strong>：优先使用 ES6 类继承</li>
<li><strong>旧浏览器支持</strong>：使用寄生组合继承</li>
<li><strong>功能混入</strong>：使用 Mixin 模式</li>
<li><strong>私有字段</strong>：使用 WeakMap 或闭包</li>
</ol>
<h3 id="最佳实践原则"><a href="#最佳实践原则" class="headerlink" title="最佳实践原则"></a>最佳实践原则</h3><ol>
<li><strong>遵循 LSP 原则</strong>：子类应能替换父类</li>
<li><strong>避免深度继承</strong>：继承层次不超过 3 层</li>
<li><strong>多用组合少用继承</strong>：优先考虑对象组合</li>
<li><strong>封装变化</strong>：将变化点封装在子类中</li>
<li><strong>保持一致性</strong>：子类不应改变父类行为</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[继承需求] --&gt; B&#123;选择方案&#125;</span><br><span class="line">  B --&gt;|ES6环境| C[ES6类继承]</span><br><span class="line">  B --&gt;|ES5环境| D[寄生组合继承]</span><br><span class="line">  B --&gt;|多继承需求| E[Mixin模式]</span><br><span class="line">  B --&gt;|共享方法| F[原型链继承]</span><br><span class="line">  B --&gt;|实例隔离| G[构造函数继承]</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/008-ES5-%E5%AE%9E%E7%8E%B0-ES6-%E7%B1%BB%E7%BB%A7%E6%89%BF%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0/" data-id="cmbs36xv4001bywsdc2hd93lt" data-title="008-ES5 实现 ES6 类继承：深度解析与完整实现" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/009-深拷贝与浅拷贝原理-手撕" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/009-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%8E%9F%E7%90%86-%E6%89%8B%E6%92%95/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:47:41.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/009-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%8E%9F%E7%90%86-%E6%89%8B%E6%92%95/">009-深拷贝与浅拷贝原理+手撕</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="深拷贝与浅拷贝：原理、实现与最佳实践"><a href="#深拷贝与浅拷贝：原理、实现与最佳实践" class="headerlink" title="深拷贝与浅拷贝：原理、实现与最佳实践"></a>深拷贝与浅拷贝：原理、实现与最佳实践</h1><h2 id="核心概念解析"><a href="#核心概念解析" class="headerlink" title="核心概念解析"></a>核心概念解析</h2><h3 id="浅拷贝（Shallow-Copy）"><a href="#浅拷贝（Shallow-Copy）" class="headerlink" title="浅拷贝（Shallow Copy）"></a>浅拷贝（Shallow Copy）</h3><ul>
<li><strong>定义</strong>：创建一个新对象，新对象的属性值是对原对象属性值的引用</li>
<li><strong>特点</strong>：<ul>
<li>只复制第一层属性</li>
<li>嵌套对象与原对象共享内存</li>
<li>修改嵌套对象会影响原对象</li>
</ul>
</li>
<li><strong>内存示意图</strong>：<br>原始对象: { a: 1, b: { c: 2 } }<br>浅拷贝对象: { a: 1, b: [引用地址] }<br>↑<br>原始对象的b属性 ←┘</li>
</ul>
<h3 id="深拷贝（Deep-Copy）"><a href="#深拷贝（Deep-Copy）" class="headerlink" title="深拷贝（Deep Copy）"></a>深拷贝（Deep Copy）</h3><ul>
<li><strong>定义</strong>：创建一个完全独立的新对象，递归复制所有层级的属性</li>
<li><strong>特点</strong>：<ul>
<li>复制对象的所有层级</li>
<li>新对象与原对象完全隔离</li>
<li>修改新对象不会影响原对象</li>
</ul>
</li>
<li><strong>内存示意图</strong>：<br>原始对象: { a: 1, b: { c: 2 } }<br>深拷贝对象: { a: 1, b: { c: 2 } }  &#x2F;&#x2F; 全新的内存地址</li>
</ul>
<h2 id="常用方法对比"><a href="#常用方法对比" class="headerlink" title="常用方法对比"></a>常用方法对比</h2><h3 id="浅拷贝方法"><a href="#浅拷贝方法" class="headerlink" title="浅拷贝方法"></a>浅拷贝方法</h3><table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>示例</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>扩展运算符</td>
<td><code>const copy = &#123; ...obj &#125;</code></td>
<td>ES6+ 推荐方式</td>
</tr>
<tr>
<td>Object.assign()</td>
<td><code>const copy = Object.assign(&#123;&#125;, obj)</code></td>
<td>合并对象实现浅拷贝</td>
</tr>
<tr>
<td>Array.prototype.slice()</td>
<td><code>const copy = arr.slice()</code></td>
<td>数组浅拷贝</td>
</tr>
<tr>
<td>Array.from()</td>
<td><code>const copy = Array.from(arr)</code></td>
<td>类数组转数组实现浅拷贝</td>
</tr>
<tr>
<td>手动遍历</td>
<td>见下方实现</td>
<td>自定义浅拷贝逻辑</td>
</tr>
</tbody></table>
<h3 id="深拷贝方法"><a href="#深拷贝方法" class="headerlink" title="深拷贝方法"></a>深拷贝方法</h3><table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>示例</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody><tr>
<td>JSON.parse&#x2F;stringify</td>
<td><code>JSON.parse(JSON.stringify(obj))</code></td>
<td>简单快速</td>
<td>丢失函数&#x2F;Symbol&#x2F;undefined&#x2F;循环引用等</td>
</tr>
<tr>
<td>Lodash.cloneDeep</td>
<td><code>_.cloneDeep(obj)</code></td>
<td>功能完整，处理各种边界情况</td>
<td>需引入外部库</td>
</tr>
<tr>
<td>结构化克隆</td>
<td><code>structuredClone(obj)</code></td>
<td>浏览器原生API，支持循环引用</td>
<td>Node环境不支持，不支持函数&#x2F;原型链</td>
</tr>
<tr>
<td>手动递归实现</td>
<td>见下方实现</td>
<td>完全可控，支持自定义处理</td>
<td>实现复杂度高</td>
</tr>
</tbody></table>
<h2 id="手写实现"><a href="#手写实现" class="headerlink" title="手写实现"></a>手写实现</h2><h3 id="浅拷贝函数实现"><a href="#浅拷贝函数实现" class="headerlink" title="浅拷贝函数实现"></a>浅拷贝函数实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shallowCopy</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="comment">// 处理非对象类型</span></span><br><span class="line">  <span class="keyword">if</span> (source === <span class="literal">null</span> || <span class="keyword">typeof</span> source !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理数组</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(source)) &#123;</span><br><span class="line">    <span class="keyword">return</span> [...source];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理普通对象</span></span><br><span class="line">  <span class="keyword">const</span> copy = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="comment">// 只复制自身属性（非原型链属性）</span></span><br><span class="line">    <span class="keyword">if</span> (source.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      copy[key] = source[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">const</span> original = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">shallowCopy</span>(original);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span> === original.<span class="property">b</span>); <span class="comment">// true（共享嵌套对象）</span></span><br></pre></td></tr></table></figure>

<h3 id="深拷贝函数实现（基础版）"><a href="#深拷贝函数实现（基础版）" class="headerlink" title="深拷贝函数实现（基础版）"></a>深拷贝函数实现（基础版）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepCopy</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="comment">// 基本类型直接返回</span></span><br><span class="line">  <span class="keyword">if</span> (source === <span class="literal">null</span> || <span class="keyword">typeof</span> source !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理数组</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(source)) &#123;</span><br><span class="line">    <span class="keyword">return</span> source.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">deepCopy</span>(item));</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理普通对象</span></span><br><span class="line">  <span class="keyword">const</span> copy = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="keyword">if</span> (source.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">      copy[key] = <span class="title function_">deepCopy</span>(source[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">const</span> original = &#123; </span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>, </span><br><span class="line">  <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125;,</span><br><span class="line">  <span class="attr">d</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">  <span class="attr">e</span>: <span class="regexp">/regex/g</span>,</span><br><span class="line">  <span class="attr">f</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>) &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">deepCopy</span>(original);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span> === original.<span class="property">b</span>); <span class="comment">// false（独立嵌套对象）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">d</span> <span class="keyword">instanceof</span> <span class="title class_">Date</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">e</span> <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> copy.<span class="property">f</span>); <span class="comment">// &#x27;function&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="深拷贝函数实现（进阶版）"><a href="#深拷贝函数实现（进阶版）" class="headerlink" title="深拷贝函数实现（进阶版）"></a>深拷贝函数实现（进阶版）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepCopyAdvanced</span>(<span class="params">source, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="comment">// 基本类型直接返回</span></span><br><span class="line">  <span class="keyword">if</span> (source === <span class="literal">null</span> || <span class="keyword">typeof</span> source !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理循环引用</span></span><br><span class="line">  <span class="keyword">if</span> (map.<span class="title function_">has</span>(source)) &#123;</span><br><span class="line">    <span class="keyword">return</span> map.<span class="title function_">get</span>(source);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理特殊对象</span></span><br><span class="line">  <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> source <span class="keyword">instanceof</span> <span class="title class_">Date</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(source);</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">case</span> source <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(source);</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">case</span> source <span class="keyword">instanceof</span> <span class="title class_">Map</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Map</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(source, <span class="function">(<span class="params">[key, val]</span>) =&gt;</span> </span><br><span class="line">        [<span class="title function_">deepCopyAdvanced</span>(key, map), <span class="title function_">deepCopyAdvanced</span>(val, map)]</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">case</span> source <span class="keyword">instanceof</span> <span class="title class_">Set</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(source, <span class="function"><span class="params">item</span> =&gt;</span> </span><br><span class="line">        <span class="title function_">deepCopyAdvanced</span>(item, map))</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(source):</span><br><span class="line">      <span class="keyword">const</span> arrCopy = [];</span><br><span class="line">      map.<span class="title function_">set</span>(source, arrCopy);</span><br><span class="line">      source.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        arrCopy[index] = <span class="title function_">deepCopyAdvanced</span>(item, map);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> arrCopy;</span><br><span class="line">      </span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// 处理普通对象和类实例</span></span><br><span class="line">      <span class="keyword">const</span> objCopy = <span class="title class_">Object</span>.<span class="title function_">create</span>(</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(source)</span><br><span class="line">      );</span><br><span class="line">      map.<span class="title function_">set</span>(source, objCopy);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 复制Symbol属性</span></span><br><span class="line">      <span class="keyword">const</span> symbolKeys = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(source);</span><br><span class="line">      <span class="keyword">const</span> allKeys = [...<span class="title class_">Object</span>.<span class="title function_">keys</span>(source), ...symbolKeys];</span><br><span class="line">      </span><br><span class="line">      allKeys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        objCopy[key] = <span class="title function_">deepCopyAdvanced</span>(source[key], map);</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> objCopy;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试用例</span></span><br><span class="line"><span class="keyword">const</span> original = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125;,</span><br><span class="line">  <span class="attr">d</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">  <span class="attr">e</span>: <span class="regexp">/regex/g</span>,</span><br><span class="line">  <span class="attr">f</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">a</span>; &#125;,</span><br><span class="line">  <span class="attr">g</span>: <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]]),</span><br><span class="line">  <span class="attr">h</span>: <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]),</span><br><span class="line">  <span class="attr">i</span>: <span class="title class_">Symbol</span>(<span class="string">&#x27;unique&#x27;</span>),</span><br><span class="line">  <span class="attr">j</span>: [<span class="number">4</span>, <span class="number">5</span>, &#123; <span class="attr">k</span>: <span class="number">6</span> &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加循环引用</span></span><br><span class="line">original.<span class="property">self</span> = original;</span><br><span class="line">original.<span class="property">j</span>.<span class="title function_">push</span>(original.<span class="property">j</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">deepCopyAdvanced</span>(original);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy !== original); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span> !== original.<span class="property">b</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">d</span> <span class="keyword">instanceof</span> <span class="title class_">Date</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">e</span> <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="title function_">f</span>()); <span class="comment">// 1（函数正常执行）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">g</span> <span class="keyword">instanceof</span> <span class="title class_">Map</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">h</span> <span class="keyword">instanceof</span> <span class="title class_">Set</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">i</span> === original.<span class="property">i</span>); <span class="comment">// true（Symbol相同）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">self</span> === copy); <span class="comment">// true（循环引用保持）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">j</span>[<span class="number">3</span>] === copy.<span class="property">j</span>); <span class="comment">// true（循环引用保持）</span></span><br></pre></td></tr></table></figure>

<h2 id="特殊场景处理"><a href="#特殊场景处理" class="headerlink" title="特殊场景处理"></a>特殊场景处理</h2><h3 id="1-函数拷贝"><a href="#1-函数拷贝" class="headerlink" title="1. 函数拷贝"></a>1. 函数拷贝</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数拷贝策略</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// 方案1：直接引用（共享函数）</span></span><br><span class="line">  <span class="comment">// return source;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 方案2：创建新函数（保留this绑定）</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> source.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 方案3：完整克隆（复杂）</span></span><br><span class="line">  <span class="comment">// const fnStr = source.toString();</span></span><br><span class="line">  <span class="comment">// return new Function(&#x27;return &#x27; + fnStr)();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-原型链处理"><a href="#2-原型链处理" class="headerlink" title="2. 原型链处理"></a>2. 原型链处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保持原型链</span></span><br><span class="line"><span class="keyword">const</span> objCopy = <span class="title class_">Object</span>.<span class="title function_">create</span>(</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(source)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-不可枚举属性"><a href="#3-不可枚举属性" class="headerlink" title="3. 不可枚举属性"></a>3. 不可枚举属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复制不可枚举属性</span></span><br><span class="line"><span class="keyword">const</span> props = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(source);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(props)) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(</span><br><span class="line">    copy, </span><br><span class="line">    key, </span><br><span class="line">    <span class="title function_">deepCopyAdvanced</span>(props[key], map)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-循环引用检测"><a href="#4-循环引用检测" class="headerlink" title="4. 循环引用检测"></a>4. 循环引用检测</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用WeakMap检测循环引用</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (map.<span class="title function_">has</span>(source)) &#123;</span><br><span class="line">  <span class="keyword">return</span> map.<span class="title function_">get</span>(source);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(source, copy);</span><br></pre></td></tr></table></figure>

<h2 id="性能优化策略"><a href="#性能优化策略" class="headerlink" title="性能优化策略"></a>性能优化策略</h2><h3 id="1-减少递归层级"><a href="#1-减少递归层级" class="headerlink" title="1. 减少递归层级"></a>1. 减少递归层级</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扁平化数据结构处理</span></span><br><span class="line"><span class="keyword">if</span> (depth &gt; <span class="variable constant_">MAX_DEPTH</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(source) ? [...source] : &#123;...source&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-特殊对象优化"><a href="#2-特殊对象优化" class="headerlink" title="2. 特殊对象优化"></a>2. 特殊对象优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypedArray高效处理</span></span><br><span class="line"><span class="keyword">if</span> (source <span class="keyword">instanceof</span> <span class="title class_">ArrayBuffer</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> source.<span class="title function_">slice</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">ArrayBuffer</span>.<span class="title function_">isView</span>(source)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> source.<span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    source.buffer.slice(<span class="number">0</span>),</span></span><br><span class="line"><span class="params">    source.byteOffset,</span></span><br><span class="line"><span class="params">    source.byteLength / source.BYTES_PER_ELEMENT</span></span><br><span class="line"><span class="params">  </span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-缓存机制"><a href="#3-缓存机制" class="headerlink" title="3. 缓存机制"></a>3. 缓存机制</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缓存已处理对象</span></span><br><span class="line"><span class="keyword">const</span> cache = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cachedDeepCopy</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (cache.<span class="title function_">has</span>(source)) &#123;</span><br><span class="line">    <span class="keyword">return</span> cache.<span class="title function_">get</span>(source);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> copy = <span class="title function_">deepCopyAdvanced</span>(source);</span><br><span class="line">  cache.<span class="title function_">set</span>(source, copy);</span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="应用场景分析"><a href="#应用场景分析" class="headerlink" title="应用场景分析"></a>应用场景分析</h2><h3 id="适合浅拷贝的场景"><a href="#适合浅拷贝的场景" class="headerlink" title="适合浅拷贝的场景"></a>适合浅拷贝的场景</h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>原因</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>配置对象合并</td>
<td>只需顶层属性覆盖</td>
<td><code>Object.assign(config, overrides)</code></td>
</tr>
<tr>
<td>状态快照（简单状态）</td>
<td>状态对象无嵌套结构</td>
<td>Vue的data对象</td>
</tr>
<tr>
<td>函数参数传递</td>
<td>避免修改原始对象</td>
<td><code>function process(data) &#123; const local = &#123;...data&#125; &#125;</code></td>
</tr>
<tr>
<td>数组切片操作</td>
<td>只需部分数组元素</td>
<td><code>const page = items.slice(0, 10)</code></td>
</tr>
</tbody></table>
<h3 id="适合深拷贝的场景"><a href="#适合深拷贝的场景" class="headerlink" title="适合深拷贝的场景"></a>适合深拷贝的场景</h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>原因</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>状态管理（Redux）</td>
<td>需要完整不可变状态树</td>
<td>Redux reducer中的状态更新</td>
</tr>
<tr>
<td>复杂对象序列化</td>
<td>需要完整对象结构</td>
<td>保存到本地存储的复杂状态</td>
</tr>
<tr>
<td>避免污染原始数据</td>
<td>操作数据副本不影响源数据</td>
<td>表格编辑临时副本</td>
</tr>
<tr>
<td>跨线程通信（Web Worker）</td>
<td>需要序列化所有数据</td>
<td><code>worker.postMessage(structuredClone(data))</code></td>
</tr>
</tbody></table>
<h2 id="现代API：structuredClone"><a href="#现代API：structuredClone" class="headerlink" title="现代API：structuredClone"></a>现代API：structuredClone</h2><h3 id="浏览器原生深拷贝"><a href="#浏览器原生深拷贝" class="headerlink" title="浏览器原生深拷贝"></a>浏览器原生深拷贝</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> original = &#123; </span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>, </span><br><span class="line">  <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125;,</span><br><span class="line">  <span class="attr">d</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">  <span class="attr">e</span>: <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> copy = <span class="title function_">structuredClone</span>(original);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">b</span> !== original.<span class="property">b</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">d</span> <span class="keyword">instanceof</span> <span class="title class_">Date</span>); <span class="comment">// true</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;不支持structuredClone&#x27;</span>, err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支持特性"><a href="#支持特性" class="headerlink" title="支持特性"></a>支持特性</h3><table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>支持</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>基本类型</td>
<td>✅</td>
<td>number, string, boolean等</td>
</tr>
<tr>
<td>Array&#x2F;Object</td>
<td>✅</td>
<td>普通对象和数组</td>
</tr>
<tr>
<td>Date</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>RegExp</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>Map&#x2F;Set</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>ArrayBuffer</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>Blob&#x2F;File</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>ImageData</td>
<td>✅</td>
<td></td>
</tr>
<tr>
<td>函数</td>
<td>❌</td>
<td>抛出DataCloneError异常</td>
</tr>
<tr>
<td>DOM节点</td>
<td>❌</td>
<td>抛出DataCloneError异常</td>
</tr>
<tr>
<td>原型链</td>
<td>❌</td>
<td>只复制自身属性</td>
</tr>
<tr>
<td>循环引用</td>
<td>✅</td>
<td>正确处理循环引用</td>
</tr>
</tbody></table>
<h2 id="总结与最佳实践"><a href="#总结与最佳实践" class="headerlink" title="总结与最佳实践"></a>总结与最佳实践</h2><h3 id="选择策略"><a href="#选择策略" class="headerlink" title="选择策略"></a>选择策略</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[需要拷贝] --&gt; B&#123;是否有嵌套对象&#125;</span><br><span class="line">  B --&gt;|是| C&#123;需要完全独立&#125;</span><br><span class="line">  B --&gt;|否| D[使用浅拷贝]</span><br><span class="line">  C --&gt;|是| E[使用深拷贝]</span><br><span class="line">  C --&gt;|否| D</span><br><span class="line">  E --&gt; F&#123;环境支持&#125;</span><br><span class="line">  F --&gt;|现代浏览器| G[structuredClone]</span><br><span class="line">  F --&gt;|Node/复杂需求| H[Lodash.cloneDeep]</span><br><span class="line">  F --&gt;|自定义需求| I[手写深拷贝]</span><br></pre></td></tr></table></figure>

<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><p><strong>优先使用原生API</strong>：</p>
<ul>
<li>浅拷贝：扩展运算符 <code>&#123;...obj&#125;</code></li>
<li>深拷贝：<code>structuredClone</code>（浏览器环境）</li>
</ul>
</li>
<li><p><strong>复杂场景用成熟库</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; cloneDeep &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash-es&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">cloneDeep</span>(original);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>避免JSON暴力转换</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不推荐 - 丢失类型信息</span></span><br><span class="line"><span class="keyword">const</span> copy = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(original));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>循环引用要处理</strong>：</p>
<ul>
<li>手动实现时使用WeakMap跟踪</li>
<li>使用库函数自动处理</li>
</ul>
</li>
<li><p><strong>性能敏感场景注意</strong>：</p>
<ul>
<li>大对象深拷贝可能阻塞主线程</li>
<li>考虑增量复制或Web Worker</li>
</ul>
</li>
</ol>
<h3 id="终极方案推荐"><a href="#终极方案推荐" class="headerlink" title="终极方案推荐"></a>终极方案推荐</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生产环境推荐方案</span></span><br><span class="line"><span class="comment"> * 1. 浏览器环境：使用structuredClone</span></span><br><span class="line"><span class="comment"> * 2. Node环境：使用Lodash的cloneDeep</span></span><br><span class="line"><span class="comment"> * 3. 特殊需求：自定义深拷贝函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safeDeepCopy</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="comment">// 浏览器环境使用原生API</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> structuredClone === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">structuredClone</span>(obj);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Node环境使用Lodash</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">require</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; cloneDeep &#125; = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">cloneDeep</span>(obj);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// 降级处理</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 降级方案：基础深拷贝</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/009-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%8E%9F%E7%90%86-%E6%89%8B%E6%92%95/" data-id="cmbs36xv1000tywsd18os4wbx" data-title="009-深拷贝与浅拷贝原理+手撕" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/010-JavaScript设计模式-手撕" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/010-JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%89%8B%E6%92%95/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:47:58.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/010-JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%89%8B%E6%92%95/">010-JavaScript设计模式+手撕</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="JavaScript-设计模式常见类型"><a href="#JavaScript-设计模式常见类型" class="headerlink" title="JavaScript 设计模式常见类型"></a>JavaScript 设计模式常见类型</h3><p>1. 单例模式（Singleton）：确保一个类只有一个实例，并提供全局访问点。</p>
<p>2. 工厂模式（Factory）：定义一个创建对象的接口，由子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p>
<p>3. 抽象工厂模式（Abstract Factory）：提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。</p>
<p>4. 建造者模式（Builder）：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<p>5. 原型模式（Prototype）：用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
<p>6. 适配器模式（Adapter）：将一个类的接口转换成客户希望的另外一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p>7. 装饰者模式（Decorator）：动态地给一个对象添加一些额外的职责。就增加功能来说，装饰器模式相比生成子类更为灵活。</p>
<p>8. 代理模式（Proxy）：为其他对象提供一种代理以控制对这个对象的访问。</p>
<p>9. 观察者模式（Observer）：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<p>10. 发布订阅模式（Pub-Sub）：与观察者模式类似，但有一个中间的事件通道，发布者和订阅者不直接通信，而是通过这个通道来传递消息。</p>
<p>11. 策略模式（Strategy）：定义一系列的算法，把它们一个个封装起来，并且使它们可相互替换。</p>
<p>12. 命令模式（Command）：将一个请求封装成一个对象，从而使您可以用不同的请求对客户进行参数化。</p>
<p>13. 状态模式（State）：允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它的类。</p>
<p>14. 模板方法模式（Template Method）：定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p>15. 迭代器模式（Iterator）：提供一种方法顺序访问一个聚合对象中各个元素，而又不暴露该对象的内部表示。</p>
<p>16. 组合模式（Composite）：将对象组合成树形结构以表示“部分-整体”的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性。</p>
<hr>
<h4 id="1-创建型模式"><a href="#1-创建型模式" class="headerlink" title="1. 创建型模式"></a>1. <strong>创建型模式</strong></h4><ul>
<li>**单例模式 (Singleton)**<br>确保一个类只有一个实例（如全局状态管理）。</li>
<li>**工厂模式 (Factory)**<br>封装对象的创建过程（如 <code>createElement()</code>）。</li>
<li>**建造者模式 (Builder)**<br>分步骤构建复杂对象（如配置对象生成）。</li>
</ul>
<h4 id="2-结构型模式"><a href="#2-结构型模式" class="headerlink" title="2. 结构型模式"></a>2. <strong>结构型模式</strong></h4><ul>
<li>**适配器模式 (Adapter)**<br>兼容不同接口（如数据格式转换）。</li>
<li>**装饰器模式 (Decorator)**<br>动态扩展对象功能（ES7&#x2F;TypeScript 装饰器）。</li>
<li>**代理模式 (Proxy)**<br>控制对象访问（如 ES6 <code>Proxy</code> 对象）。</li>
</ul>
<h4 id="3-行为型模式"><a href="#3-行为型模式" class="headerlink" title="3. 行为型模式"></a>3. <strong>行为型模式</strong></h4><ul>
<li>**观察者模式 (Observer)**<br>直接通知依赖对象（如 <code>MutationObserver</code>）。</li>
<li>**发布订阅模式 (Pub&#x2F;Sub)**<br>通过事件中心通信（如 <code>EventEmitter</code>）。</li>
<li>**策略模式 (Strategy)**<br>封装可互换的算法（如验证规则集）。</li>
<li>**迭代器模式 (Iterator)**<br>提供遍历集合的方法（如 ES6 <code>Iterator</code>）。</li>
</ul>
<hr>
<h3 id="观察者-Observer-vs-发布订阅-Pub-Sub-的区别"><a href="#观察者-Observer-vs-发布订阅-Pub-Sub-的区别" class="headerlink" title="观察者 (Observer) vs 发布订阅 (Pub&#x2F;Sub) 的区别"></a>观察者 (Observer) vs 发布订阅 (Pub&#x2F;Sub) 的区别</h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>观察者模式</strong></th>
<th><strong>发布订阅模式</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>通信方式</strong></td>
<td>直接通信</td>
<td>通过<strong>事件中心</strong>间接通信</td>
</tr>
<tr>
<td><strong>耦合关系</strong></td>
<td>观察者与目标相互知晓（较高耦合）</td>
<td>发布&#x2F;订阅者彼此独立（完全解耦）</td>
</tr>
<tr>
<td><strong>灵活性</strong></td>
<td>依赖关系固定</td>
<td>动态订阅&#x2F;取消，支持多对多关系</td>
</tr>
<tr>
<td><strong>典型场景</strong></td>
<td>对象状态变化直接通知</td>
<td>跨模块通信、事件驱动架构</td>
</tr>
<tr>
<td><strong>实现复杂度</strong></td>
<td>较简单</td>
<td>需维护事件中心（略复杂）</td>
</tr>
</tbody></table>
<p><strong>核心区别图解</strong>：</p>
<pre><code>观察者模式：   Subject →→ 直接通知 →→ Observer
发布订阅模式： Publisher → 事件中心 → Subscriber
</code></pre>
<hr>
<h3 id="手写发布订阅模式实现"><a href="#手写发布订阅模式实现" class="headerlink" title="手写发布订阅模式实现"></a>手写发布订阅模式实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;; <span class="comment">// 存储事件回调 &#123; eventName: [callback1, callback2] &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅事件</span></span><br><span class="line">  <span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[eventName]) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">push</span>(callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布事件</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">eventName, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> callbacks = <span class="variable language_">this</span>.<span class="property">events</span>[eventName];</span><br><span class="line">    <span class="keyword">if</span> (callbacks) &#123;</span><br><span class="line">      callbacks.<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> <span class="title function_">cb</span>(...args)); <span class="comment">// 触发所有回调</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 取消订阅</span></span><br><span class="line">  <span class="title function_">off</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> callbacks = <span class="variable language_">this</span>.<span class="property">events</span>[eventName];</span><br><span class="line">    <span class="keyword">if</span> (callbacks) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = callbacks.<span class="title function_">filter</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb !== callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 单次订阅</span></span><br><span class="line">  <span class="title function_">once</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onceWrapper</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">callback</span>(...args);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">off</span>(eventName, onceWrapper); <span class="comment">// 执行后立即取消</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">on</span>(eventName, onceWrapper);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bus = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅事件</span></span><br><span class="line">bus.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`收到消息: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单次订阅</span></span><br><span class="line">bus.<span class="title function_">once</span>(<span class="string">&quot;alert&quot;</span>, <span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`一次性提示: <span class="subst">$&#123;text&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布事件</span></span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello World&quot;</span>); <span class="comment">// 输出: 收到消息: Hello World</span></span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&quot;alert&quot;</span>, <span class="string">&quot;仅出现一次&quot;</span>);    <span class="comment">// 输出: 一次性提示: 仅出现一次</span></span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&quot;alert&quot;</span>, <span class="string">&quot;再次触发&quot;</span>);      <span class="comment">// 无输出（已取消）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取消订阅</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handler</span> = (<span class="params">data</span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">bus.<span class="title function_">on</span>(<span class="string">&quot;log&quot;</span>, handler);</span><br><span class="line">bus.<span class="title function_">off</span>(<span class="string">&quot;log&quot;</span>, handler);</span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&quot;log&quot;</span>, <span class="string">&quot;测试&quot;</span>); <span class="comment">// 无输出</span></span><br></pre></td></tr></table></figure>

<h4 id="关键特性"><a href="#关键特性" class="headerlink" title="关键特性"></a>关键特性</h4><ul>
<li><strong>解耦</strong>：发布&#x2F;订阅者无需知道对方存在</li>
<li><strong>多对多</strong>：一个事件可被多次订阅，一次发布触发所有回调</li>
<li><strong>动态管理</strong>：支持运行时订阅&#x2F;取消</li>
</ul>
<blockquote>
<p>实际应用场景：跨组件通信、插件系统、异步任务调度等。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/010-JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E6%89%8B%E6%92%95/" data-id="cmbs36xv1000wywsdg7ffe34m" data-title="010-JavaScript设计模式+手撕" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/011-JavaScript异步编程详解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/011-JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:48:15.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/011-JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/">011-JavaScript异步编程详解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="JavaScript-异步编程的理解"><a href="#JavaScript-异步编程的理解" class="headerlink" title="JavaScript 异步编程的理解"></a>JavaScript 异步编程的理解</h2><h3 id="核心本质"><a href="#核心本质" class="headerlink" title="核心本质"></a>核心本质</h3><p>JavaScript 是单线程语言，但浏览器&#x2F;Node.js 提供了<strong>异步非阻塞</strong>的运行环境。异步编程的核心目的是解决单线程环境下 I&#x2F;O 操作等阻塞问题，实现高效并发处理。</p>
<h3 id="关键机制"><a href="#关键机制" class="headerlink" title="关键机制"></a>关键机制</h3><ol>
<li><p><strong>事件循环 (Event Loop)</strong></p>
<ul>
<li>调用栈 (Call Stack)：同步代码执行栈</li>
<li>任务队列 (Task Queue)：<ul>
<li>宏任务队列 (Macrotask)：<code>setTimeout</code>、<code>setInterval</code>、I&#x2F;O 操作</li>
<li>微任务队列 (Microtask)：<code>Promise.then()</code>、<code>MutationObserver</code></li>
</ul>
</li>
<li>执行顺序：同步代码 → 清空微任务队列 → 执行一个宏任务 → 重复</li>
</ul>
</li>
<li><p><strong>执行模型</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[同步代码] --&gt; B&#123;栈空?&#125;</span><br><span class="line">B --&gt;|是| C[执行微任务]</span><br><span class="line">C --&gt; D[取宏任务]</span><br><span class="line">D --&gt; E[执行宏任务]</span><br><span class="line">E --&gt; C</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="演进历程"><a href="#演进历程" class="headerlink" title="演进历程"></a>演进历程</h3><table>
<thead>
<tr>
<th>阶段</th>
<th>方案</th>
<th>特点</th>
<th>问题</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Callback</strong></td>
<td>回调函数</td>
<td>基础异步支持</td>
<td>回调地狱，错误处理困难</td>
</tr>
<tr>
<td><strong>Promise</strong></td>
<td>ES6 原生</td>
<td>链式调用，解决回调地狱</td>
<td>仍需 then&#x2F;catch</td>
</tr>
<tr>
<td><strong>Generator</strong></td>
<td>function* + yield</td>
<td>暂停&#x2F;恢复执行</td>
<td>需要执行器(co库)</td>
</tr>
<tr>
<td><strong>Async&#x2F;Await</strong></td>
<td>ES2017</td>
<td>同步写法处理异步，终极方案</td>
<td>语法糖（基于 Promise）</td>
</tr>
</tbody></table>
<h3 id="代码示例演进"><a href="#代码示例演进" class="headerlink" title="代码示例演进"></a>代码示例演进</h3><ol>
<li><strong>Callback Hell</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="string">&#x27;/api&#x27;</span>, <span class="function">(<span class="params">err, data1</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="title function_">handleError</span>(err);</span><br><span class="line">  <span class="title function_">getData</span>(<span class="string">`/api/<span class="subst">$&#123;data1.id&#125;</span>`</span>, <span class="function">(<span class="params">err, data2</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 更多嵌套...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Promise 链</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/api&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data1</span> =&gt;</span> <span class="title function_">fetch</span>(<span class="string">`/api/<span class="subst">$&#123;data1.id&#125;</span>`</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err));</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Async&#x2F;Await (推荐)</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res1 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> data1 = <span class="keyword">await</span> res1.<span class="title function_">json</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> res2 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/<span class="subst">$&#123;data1.id&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> res2.<span class="title function_">json</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载失败&#x27;</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h3><ol>
<li><strong>网络请求</strong>：<code>fetch</code>&#x2F;<code>axios</code> 数据获取</li>
<li><strong>定时操作</strong>：<code>setTimeout</code>&#x2F;<code>setInterval</code></li>
<li><strong>文件操作</strong>：Node.js 中 <code>fs.readFile</code></li>
<li><strong>用户交互</strong>：事件监听 <code>addEventListener</code></li>
<li><strong>Web Workers</strong>：CPU 密集型任务分流</li>
</ol>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li>优先使用 <code>async/await</code> 代替回调</li>
<li>用 <code>Promise.all()</code> 处理并行异步</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [user, posts] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/user&#x27;</span>),</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/posts&#x27;</span>)</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<ol>
<li>重要操作添加超时控制</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withTimeout</span>(<span class="params">promise, ms</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">    promise,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> </span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;超时&#x27;</span>)), ms)</span><br><span class="line">    )</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常见误区"><a href="#常见误区" class="headerlink" title="常见误区"></a>常见误区</h3><ol>
<li><p><strong>认为 async 函数是同步执行</strong><br>（实际只是同步写法，本质仍是异步）</p>
</li>
<li><p><strong>在循环中错误使用 await</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误：顺序执行</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> url <span class="keyword">of</span> urls) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">fetch</span>(url); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确：并行执行</span></span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(urls.<span class="title function_">map</span>(<span class="function"><span class="params">url</span> =&gt;</span> <span class="title function_">fetch</span>(url)));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>忽略错误处理</strong><br>（未使用 try&#x2F;catch 或 catch 处理 Promise）</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JavaScript 异步编程通过事件循环机制实现单线程下的高并发处理。从回调函数到 Promise 再到 Async&#x2F;Await 的演进，使异步代码可读性和可维护性大幅提升。理解事件循环、任务队列等底层机制，并合理运用现代异步语法，是编写高效 JavaScript 应用的关键。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/011-JavaScript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/" data-id="cmbs36xv40016ywsd2mym247v" data-title="011-JavaScript异步编程详解" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/012-ESModule与CommonJS模块比较" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/012-ESModule%E4%B8%8ECommonJS%E6%A8%A1%E5%9D%97%E6%AF%94%E8%BE%83/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:48:30.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/012-ESModule%E4%B8%8ECommonJS%E6%A8%A1%E5%9D%97%E6%AF%94%E8%BE%83/">012-ESModule与CommonJS模块比较</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="ES-Module-与-CommonJS-的核心差异"><a href="#ES-Module-与-CommonJS-的核心差异" class="headerlink" title="ES Module 与 CommonJS 的核心差异"></a>ES Module 与 CommonJS 的核心差异</h3><h4 id="1-语法与设计理念"><a href="#1-语法与设计理念" class="headerlink" title="1. 语法与设计理念"></a>1. <strong>语法与设计理念</strong></h4><ul>
<li><p><strong>CommonJS (CJS)</strong></p>
<ul>
<li>语法：<code>require()</code> 导入，<code>module.exports</code> 或 <code>exports</code> 导出。</li>
<li>设计目标：服务端模块化（如 Node.js），<strong>同步加载</strong>，运行时解析依赖。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">key</span>: <span class="string">&#x27;value&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">require</span>(<span class="string">&#x27;./module&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>ES Module (ESM)</strong></p>
<ul>
<li>语法：<code>import</code> 导入，<code>export</code> 导出。</li>
<li>设计目标：浏览器与跨平台，<strong>静态编译</strong>（编译时分析依赖），支持异步加载（如 <code>import()</code>）。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> key = <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; key &#125; <span class="keyword">from</span> <span class="string">&#x27;./module.mjs&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="2-加载机制与值传递"><a href="#2-加载机制与值传递" class="headerlink" title="2. 加载机制与值传递"></a>2. <strong>加载机制与值传递</strong></h4><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>CommonJS</strong></th>
<th><strong>ES Module</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>加载时机</strong></td>
<td>运行时同步加载</td>
<td>编译时解析，运行时执行</td>
</tr>
<tr>
<td><strong>值传递</strong></td>
<td>导出值的<strong>拷贝</strong></td>
<td>导出值的<strong>引用</strong>（动态绑定）</td>
</tr>
<tr>
<td><strong>循环依赖处理</strong></td>
<td>通过缓存避免死循环，可能输出未完成状态的值</td>
<td>引用未初始化变量可能为 <code>undefined</code>（静态分析报错优先）</td>
</tr>
<tr>
<td><strong>作用域</strong></td>
<td>模块级作用域（通过函数包裹）</td>
<td>原生词法作用域</td>
</tr>
</tbody></table>
<h4 id="3-异步支持与适用场景"><a href="#3-异步支持与适用场景" class="headerlink" title="3. 异步支持与适用场景"></a>3. <strong>异步支持与适用场景</strong></h4><ul>
<li><strong>CJS</strong>：仅同步加载，<strong>适用于服务端</strong>（文件读取快），浏览器端易阻塞渲染。</li>
<li><strong>ESM</strong>：支持异步加载（<code>import()</code>），<strong>适用于浏览器与现代 Node.js</strong>，支持按需加载和 Tree Shaking。</li>
</ul>
<h4 id="4-其他关键差异"><a href="#4-其他关键差异" class="headerlink" title="4. 其他关键差异"></a>4. <strong>其他关键差异</strong></h4><ul>
<li><strong>顶层 <code>this</code> 指向</strong>：CJS 指向当前模块，ESM 指向 <code>undefined</code>。</li>
<li><strong>动态表达式</strong>：CJS 的 <code>require()</code> 可动态调用（如 <code>require(path)</code>），ESM 的 <code>import</code> 路径需静态字符串（动态路径需 <code>import()</code>）。</li>
</ul>
<hr>
<h3 id="互相加载的方式"><a href="#互相加载的方式" class="headerlink" title="互相加载的方式"></a>互相加载的方式</h3><h4 id="1-ESM-加载-CommonJS"><a href="#1-ESM-加载-CommonJS" class="headerlink" title="1. ESM 加载 CommonJS"></a>1. <strong>ESM 加载 CommonJS</strong></h4><ul>
<li><strong>默认行为</strong>：ESM 的 <code>import</code> 会将 CJS 的 <code>module.exports</code> 视为 <code>default</code> 导出。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CJS 模块 (math.cjs)</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">add</span>: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ESM 导入</span></span><br><span class="line"><span class="keyword">import</span> math <span class="keyword">from</span> <span class="string">&#x27;./math.cjs&#x27;</span>; <span class="comment">// math = &#123; add: [Function] &#125;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>命名导入的限制</strong>：<br>需通过解构从 <code>default</code> 中提取，直接命名导入会报错：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误！</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.cjs&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确：解构 default</span></span><br><span class="line"><span class="keyword">import</span> cjsModule <span class="keyword">from</span> <span class="string">&#x27;./math.cjs&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; add &#125; = cjsModule;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-CommonJS-加载-ESM"><a href="#2-CommonJS-加载-ESM" class="headerlink" title="2. CommonJS 加载 ESM"></a>2. <strong>CommonJS 加载 ESM</strong></h4><ul>
<li><strong>问题</strong>：CJS 的 <code>require()</code> 是同步的，而 ESM 需异步加载。</li>
<li><strong>解决方案</strong>：使用动态 <code>import()</code>（返回 Promise）：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CJS 中加载 ESM</span></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> esmModule = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./module.mjs&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(esmModule.<span class="property">key</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-兼容方案"><a href="#3-兼容方案" class="headerlink" title="3. 兼容方案"></a>3. <strong>兼容方案</strong></h4><ul>
<li><strong>统一封装</strong>：若需同时支持两种规范，可创建适配层：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适配 CJS 模块为 ESM (wrapper.mjs)</span></span><br><span class="line"><span class="keyword">import</span> cjsModule <span class="keyword">from</span> <span class="string">&#x27;./legacy.cjs&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; propA, propB &#125; = cjsModule;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="与-AMD-的关系及差异"><a href="#与-AMD-的关系及差异" class="headerlink" title="与 AMD 的关系及差异"></a>与 AMD 的关系及差异</h3><h4 id="AMD-的角色"><a href="#AMD-的角色" class="headerlink" title="AMD 的角色"></a><strong>AMD 的角色</strong></h4><ul>
<li><strong>定位</strong>：浏览器端<strong>异步加载</strong>的早期方案（如 RequireJS），解决 CJS 同步加载阻塞问题。</li>
<li><strong>语法</strong>：<code>define</code> 定义模块，<code>require</code> 异步加载：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;dep1&#x27;</span>, <span class="string">&#x27;dep2&#x27;</span>], <span class="function">(<span class="params">dep1, dep2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">key</span>: dep1.<span class="property">value</span> + dep2.<span class="property">value</span> &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><strong>对比 ESM&#x2F;CJS</strong>：<table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th>AMD</th>
<th>ESM</th>
<th>CommonJS</th>
</tr>
</thead>
<tbody><tr>
<td><strong>加载方式</strong></td>
<td>异步</td>
<td>静态&#x2F;支持异步</td>
<td>同步</td>
</tr>
<tr>
<td><strong>适用环境</strong></td>
<td>浏览器</td>
<td>浏览器&#x2F;Node.js</td>
<td>Node.js</td>
</tr>
<tr>
<td><strong>依赖处理</strong></td>
<td>依赖前置</td>
<td>静态分析</td>
<td>运行时解析</td>
</tr>
</tbody></table>
</li>
</ul>
<h4 id="演进关系"><a href="#演进关系" class="headerlink" title="演进关系"></a><strong>演进关系</strong></h4><p>AMD 是 ESM 成熟前浏览器的过渡方案，ESM 成为标准后逐渐被取代，但动态加载思想（如 <code>import()</code>）吸收了其优点。</p>
<hr>
<h3 id="总结：如何选择？"><a href="#总结：如何选择？" class="headerlink" title="总结：如何选择？"></a>总结：如何选择？</h3><ul>
<li><strong>Node.js 环境</strong>：传统库用 <strong>CommonJS</strong>，新项目首选 <strong>ESM</strong>（设置 <code>&quot;type&quot;: &quot;module&quot;</code>）。</li>
<li><strong>浏览器环境</strong>：<strong>ES Module</strong>（原生支持 + 异步能力）。</li>
<li><strong>历史项目</strong>：AMD 仅需在维护旧浏览器代码时考虑。</li>
</ul>
<blockquote>
<p>通过 <code>import</code>&#x2F;<code>require</code> 混用和动态加载，可实现渐进迁移，但需注意值传递和加载时序的差异。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/012-ESModule%E4%B8%8ECommonJS%E6%A8%A1%E5%9D%97%E6%AF%94%E8%BE%83/" data-id="cmbs36xv2000zywsdgbw057zg" data-title="012-ESModule与CommonJS模块比较" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-javascript_doc/013-Promise-all-race-allSettled概念-手撕" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/09/javascript_doc/013-Promise-all-race-allSettled%E6%A6%82%E5%BF%B5-%E6%89%8B%E6%92%95/" class="article-date">
  <time class="dt-published" datetime="2025-06-09T05:48:48.000Z" itemprop="datePublished">2025-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/09/javascript_doc/013-Promise-all-race-allSettled%E6%A6%82%E5%BF%B5-%E6%89%8B%E6%92%95/">013-Promise.all-race-allSettled概念+手撕</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Promise-并发控制方法详解"><a href="#Promise-并发控制方法详解" class="headerlink" title="Promise 并发控制方法详解"></a>Promise 并发控制方法详解</h3><h4 id="一、核心静态方法概念"><a href="#一、核心静态方法概念" class="headerlink" title="一、核心静态方法概念"></a>一、核心静态方法概念</h4><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
<th>特性</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>Promise.all(iterable)</code></strong></td>
<td>等待所有 Promise 成功</td>
<td>短路特性（一个失败立即拒绝）</td>
<td>成功：结果数组<br>失败：第一个错误</td>
</tr>
<tr>
<td><strong><code>Promise.race(iterable)</code></strong></td>
<td>采用第一个完成的 Promise</td>
<td>竞速机制</td>
<td>第一个落定的结果（无论成功&#x2F;失败）</td>
</tr>
<tr>
<td><strong><code>Promise.allSettled(iterable)</code></strong></td>
<td>等待所有 Promise 完成</td>
<td>不短路，收集所有结果</td>
<td>状态描述对象数组</td>
</tr>
</tbody></table>
<h4 id="二、手写实现"><a href="#二、手写实现" class="headerlink" title="二、手写实现"></a>二、手写实现</h4><h5 id="1-手写-Promise-all"><a href="#1-手写-Promise-all" class="headerlink" title="1. 手写 Promise.all"></a>1. 手写 <code>Promise.all</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">myAll</span> = <span class="keyword">function</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="keyword">let</span> completed = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">          results[i] = value;</span><br><span class="line">          <span class="keyword">if</span> (++completed === promises.<span class="property">length</span>) <span class="title function_">resolve</span>(results);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(reject); <span class="comment">// 任一失败立即拒绝</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="2-手写-Promise-race"><a href="#2-手写-Promise-race" class="headerlink" title="2. 手写 Promise.race"></a>2. 手写 <code>Promise.race</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">myRace</span> = <span class="keyword">function</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise)</span><br><span class="line">        .<span class="title function_">then</span>(resolve)</span><br><span class="line">        .<span class="title function_">catch</span>(reject);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="3-手写-Promise-allSettled"><a href="#3-手写-Promise-allSettled" class="headerlink" title="3. 手写 Promise.allSettled"></a>3. 手写 <code>Promise.allSettled</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">myAllSettled</span> = <span class="keyword">function</span>(<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="keyword">let</span> completed = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">checkCompletion</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (++completed === promises.<span class="property">length</span>) <span class="title function_">resolve</span>(results);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    promises.<span class="title function_">forEach</span>(<span class="function">(<span class="params">promise, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">          results[i] = &#123; <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>, value &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">          results[i] = &#123; <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>, reason &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">finally</span>(checkCompletion);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="三、使用-Promise-实现请求并发控制"><a href="#三、使用-Promise-实现请求并发控制" class="headerlink" title="三、使用 Promise 实现请求并发控制"></a>三、使用 Promise 实现请求并发控制</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RequestPool</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">maxConcurrent</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">max</span> = maxConcurrent; <span class="comment">// 最大并发数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = [];         <span class="comment">// 等待队列</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="number">0</span>;        <span class="comment">// 当前运行数</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加请求到池中</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">requestFn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">task</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">running</span>++;</span><br><span class="line">        <span class="title function_">requestFn</span>()</span><br><span class="line">          .<span class="title function_">then</span>(resolve)</span><br><span class="line">          .<span class="title function_">catch</span>(reject)</span><br><span class="line">          .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">running</span>--;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">next</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 立即执行或加入队列</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">running</span> &lt; <span class="variable language_">this</span>.<span class="property">max</span>) &#123;</span><br><span class="line">        <span class="title function_">task</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">push</span>(task);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行下一个任务</span></span><br><span class="line">  <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">running</span> &lt; <span class="variable language_">this</span>.<span class="property">max</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> task = <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="title function_">task</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="使用示例："><a href="#使用示例：" class="headerlink" title="使用示例："></a>使用示例：</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建并发池（最大3个）</span></span><br><span class="line"><span class="keyword">const</span> pool = <span class="keyword">new</span> <span class="title class_">RequestPool</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 模拟异步请求函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createRequest</span> = (<span class="params">id, delay</span>) =&gt; <span class="function">() =&gt;</span> </span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">`请求<span class="subst">$&#123;id&#125;</span>完成`</span>), delay)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加10个请求</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  pool.<span class="title function_">add</span>(<span class="title function_">createRequest</span>(i, <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>); <span class="comment">// 按完成顺序输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输出特点：</span></span><br><span class="line"><span class="comment">1. 同时最多3个请求并行</span></span><br><span class="line"><span class="comment">2. 完成一个立即补位下一个</span></span><br><span class="line"><span class="comment">3. 最终按实际完成顺序输出结果 */</span></span><br></pre></td></tr></table></figure>

<h4 id="四、关键实现原理"><a href="#四、关键实现原理" class="headerlink" title="四、关键实现原理"></a>四、关键实现原理</h4><ol>
<li><p><strong>并发控制核心逻辑</strong>：</p>
<ul>
<li><strong>任务队列</strong>：存储等待执行的任务</li>
<li><strong>运行计数器</strong>：跟踪当前执行中的任务数</li>
<li><strong>自动补位机制</strong>：任务完成时自动触发下一个任务</li>
</ul>
</li>
<li><p><strong>Promise 方法实现要点</strong>：</p>
<ul>
<li>正确处理非 Promise 值（<code>Promise.resolve()</code>包装）</li>
<li>保持结果顺序（数组索引定位）</li>
<li>短路处理（<code>all</code>的立即拒绝）</li>
</ul>
</li>
</ol>
<h4 id="五、实际应用场景"><a href="#五、实际应用场景" class="headerlink" title="五、实际应用场景"></a>五、实际应用场景</h4><table>
<thead>
<tr>
<th>场景</th>
<th>推荐方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>批量表单提交</td>
<td><code>Promise.all</code></td>
<td>需要全部成功，任一失败终止</td>
</tr>
<tr>
<td>竞速请求</td>
<td><code>Promise.race</code></td>
<td>获取最快响应（如CDN检测）</td>
</tr>
<tr>
<td>批量数据采集</td>
<td><code>Promise.allSettled</code></td>
<td>需要完整结果（无论成败）</td>
</tr>
<tr>
<td>图片懒加载</td>
<td>并发控制</td>
<td>避免同时加载过多图片</td>
</tr>
<tr>
<td>API 分页请求</td>
<td>并发控制</td>
<td>控制分页请求并发数量</td>
</tr>
</tbody></table>
<h4 id="六、特殊处理技巧"><a href="#六、特殊处理技巧" class="headerlink" title="六、特殊处理技巧"></a>六、特殊处理技巧</h4><ol>
<li><strong>错误重试机制</strong>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool.<span class="title function_">add</span>(<span class="function">() =&gt;</span> <span class="title function_">fetch</span>(url).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> <span class="title function_">fetch</span>(url))) <span class="comment">// 失败自动重试</span></span><br></pre></td></tr></table></figure>

<ol>
<li><strong>优先级队列</strong>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高优先级任务</span></span><br><span class="line">pool.<span class="property">queue</span>.<span class="title function_">unshift</span>(highPriorityTask); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 低优先级任务</span></span><br><span class="line">pool.<span class="property">queue</span>.<span class="title function_">push</span>(lowPriorityTask);</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>超时控制</strong>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pool.<span class="title function_">add</span>(<span class="function">() =&gt;</span> </span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">    <span class="title function_">fetch</span>(url),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, r</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">r</span>(<span class="string">&#x27;超时&#x27;</span>), <span class="number">5000</span>))</span><br><span class="line">  ])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>性能提示</strong>：浏览器通常有 6-8 个 TCP 连接限制，合理设置并发数可优化性能</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/09/javascript_doc/013-Promise-all-race-allSettled%E6%A6%82%E5%BF%B5-%E6%89%8B%E6%92%95/" data-id="cmbs36xv20010ywsd4yotf11p" data-title="013-Promise.all-race-allSettled概念+手撕" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CNBC/">CNBC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Openshift/">Openshift</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Principles/">Principles</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Pytorch/">Pytorch</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNBC-Finance/" rel="tag">CNBC Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Principles/" rel="tag">Principles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CNBC-Finance/" style="font-size: 10px;">CNBC Finance</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Principles/" style="font-size: 10px;">Principles</a> <a href="/tags/Pytorch/" style="font-size: 15px;">Pytorch</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/11/data_structiure_and_algorithms_doc/algorithms_solution_doc/013-%E5%88%86%E5%89%B2%E5%9B%9E%E6%96%87%E4%B8%B2%EF%BC%88%E5%9B%9E%E6%BA%AF%E6%B3%95%EF%BC%89/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/11/data_structiure_and_algorithms_doc/algorithms_solution_doc/012-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F%E8%83%BD%E5%90%A6%E5%88%B0%E7%BB%88%E7%82%B9+%E6%9C%80%E5%B0%8F%E8%B7%B3%E8%B7%83%E6%AC%A1%E6%95%B0%EF%BC%88%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%EF%BC%89/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/11/data_structiure_and_algorithms_doc/algorithms_solution_doc/011-%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C%EF%BC%88%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%EF%BC%88DFS%EF%BC%89%EF%BC%89/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/11/data_structiure_and_algorithms_doc/algorithms_solution_doc/010-%E4%B8%A4%E4%B8%A4%E4%BA%A4%E6%8D%A2%E9%93%BE%E8%A1%A8%E4%B8%AD%E8%8A%82%E7%82%B9%EF%BC%88%E5%93%91%E8%8A%82%E7%82%B9%EF%BC%89/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/06/11/data_structiure_and_algorithms_doc/algorithms_solution_doc/009-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8%EF%BC%88%E5%8F%8C%E6%8C%87%E9%92%88%EF%BC%89/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 EvelynUU<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>