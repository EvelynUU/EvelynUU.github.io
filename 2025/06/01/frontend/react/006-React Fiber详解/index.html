<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>006-React Fiberè¯¦è§£ | âœ¨âœ¨âœ¨ WOW, recorded a lotğŸ˜¶â€ğŸŒ«ï¸ âœ¨âœ¨âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="React Fiberæ˜¯React 16ä¸­å¼•å…¥çš„æ–°çš„åè°ƒç®—æ³•ï¼Œå®ƒé‡æ–°å®ç°äº†Reactçš„æ ¸å¿ƒç®—æ³•ï¼Œæ—¨åœ¨è§£å†³ä¸€äº›é•¿æœŸå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯å¯¹åŠ¨ç”»ã€å¸ƒå±€å’Œæ‰‹åŠ¿ç­‰éœ€è¦é«˜å“åº”æ€§çš„é¢†åŸŸã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¸ºæœªæ¥çš„ç‰¹æ€§ï¼ˆå¦‚å¼‚æ­¥æ¸²æŸ“ï¼‰å¥ å®šäº†åŸºç¡€ã€‚ ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿåœ¨React 15åŠä¹‹å‰ï¼ŒReactä½¿ç”¨é€’å½’æ–¹å¼å¤„ç†ç»„ä»¶æ ‘ã€‚å½“Reactå¼€å§‹æ¸²æŸ“æ—¶ï¼Œå®ƒä¼šé€’å½’åœ°éå†æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå¹¶ä¸”ä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ã€‚å¦‚æœ">
<meta property="og:type" content="article">
<meta property="og:title" content="006-React Fiberè¯¦è§£">
<meta property="og:url" content="http://example.com/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="âœ¨âœ¨âœ¨ WOW, recorded a lotğŸ˜¶â€ğŸŒ«ï¸ âœ¨âœ¨âœ¨">
<meta property="og:description" content="React Fiberæ˜¯React 16ä¸­å¼•å…¥çš„æ–°çš„åè°ƒç®—æ³•ï¼Œå®ƒé‡æ–°å®ç°äº†Reactçš„æ ¸å¿ƒç®—æ³•ï¼Œæ—¨åœ¨è§£å†³ä¸€äº›é•¿æœŸå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯å¯¹åŠ¨ç”»ã€å¸ƒå±€å’Œæ‰‹åŠ¿ç­‰éœ€è¦é«˜å“åº”æ€§çš„é¢†åŸŸã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¸ºæœªæ¥çš„ç‰¹æ€§ï¼ˆå¦‚å¼‚æ­¥æ¸²æŸ“ï¼‰å¥ å®šäº†åŸºç¡€ã€‚ ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿåœ¨React 15åŠä¹‹å‰ï¼ŒReactä½¿ç”¨é€’å½’æ–¹å¼å¤„ç†ç»„ä»¶æ ‘ã€‚å½“Reactå¼€å§‹æ¸²æŸ“æ—¶ï¼Œå®ƒä¼šé€’å½’åœ°éå†æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå¹¶ä¸”ä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ã€‚å¦‚æœ">
<meta property="og:locale">
<meta property="article:published_time" content="2025-06-01T05:44:55.000Z">
<meta property="article:modified_time" content="2025-06-24T09:47:43.684Z">
<meta property="article:author" content="EvelynUU">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="âœ¨âœ¨âœ¨ WOW, recorded a lotğŸ˜¶â€ğŸŒ«ï¸ âœ¨âœ¨âœ¨" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">âœ¨âœ¨âœ¨ WOW, recorded a lotğŸ˜¶â€ğŸŒ«ï¸ âœ¨âœ¨âœ¨</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Repeatings, Thoughts, and Writings</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-frontend/react/006-React Fiberè¯¦è§£" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2025-06-01T05:44:55.000Z" itemprop="datePublished">2025-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Frontend/">Frontend</a>â–º<a class="article-category-link" href="/categories/Frontend/React/">React</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      006-React Fiberè¯¦è§£
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>React Fiberæ˜¯React 16ä¸­å¼•å…¥çš„æ–°çš„åè°ƒç®—æ³•ï¼Œå®ƒé‡æ–°å®ç°äº†Reactçš„æ ¸å¿ƒç®—æ³•ï¼Œæ—¨åœ¨è§£å†³ä¸€äº›é•¿æœŸå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯å¯¹åŠ¨ç”»ã€å¸ƒå±€å’Œæ‰‹åŠ¿ç­‰éœ€è¦é«˜å“åº”æ€§çš„é¢†åŸŸã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¸ºæœªæ¥çš„ç‰¹æ€§ï¼ˆå¦‚å¼‚æ­¥æ¸²æŸ“ï¼‰å¥ å®šäº†åŸºç¡€ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦Fiberï¼Ÿ</h2><p>åœ¨React 15åŠä¹‹å‰ï¼ŒReactä½¿ç”¨é€’å½’æ–¹å¼å¤„ç†ç»„ä»¶æ ‘ã€‚å½“Reactå¼€å§‹æ¸²æŸ“æ—¶ï¼Œå®ƒä¼šé€’å½’åœ°éå†æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå¹¶ä¸”ä¸€æ—¦å¼€å§‹å°±ä¸èƒ½ä¸­æ–­ã€‚å¦‚æœç»„ä»¶æ ‘å¾ˆå¤§ï¼Œä¸»çº¿ç¨‹å¯èƒ½ä¼šè¢«é•¿æ—¶é—´å ç”¨ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶å“åº”ç”¨æˆ·äº¤äº’ï¼ˆå¦‚åŠ¨ç”»ã€è¾“å…¥ç­‰ï¼‰ï¼Œé€ æˆå¡é¡¿ã€‚</p>
<p>Fiberçš„ç›®æ ‡æ˜¯ï¼š</p>
<ol>
<li><strong>å¯ä¸­æ–­ä»»åŠ¡</strong>ï¼šå°†æ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œå¯ä»¥æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚æ¸²æŸ“ï¼‰ã€‚</li>
<li><strong>å¢é‡æ¸²æŸ“</strong>ï¼šå…è®¸Reactå°†æ¸²æŸ“å·¥ä½œåˆ†æ‰¹è¿›è¡Œï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆæ•´ä¸ªç»„ä»¶æ ‘ã€‚</li>
<li><strong>æ›´å¥½çš„é”™è¯¯å¤„ç†</strong>ï¼šå¼•å…¥é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰æ¥æ•è·å’Œå¤„ç†ç»„ä»¶æ ‘ä¸­çš„é”™è¯¯ã€‚</li>
</ol>
<h2 id="Fiberçš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#Fiberçš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Fiberçš„æ ¸å¿ƒæ¦‚å¿µ"></a>Fiberçš„æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="FiberèŠ‚ç‚¹"><a href="#FiberèŠ‚ç‚¹" class="headerlink" title="FiberèŠ‚ç‚¹"></a>FiberèŠ‚ç‚¹</h3><p>åœ¨Fiberæ¶æ„ä¸­ï¼ŒReactå°†æ¯ä¸ªç»„ä»¶è¡¨ç¤ºä¸ºä¸€ä¸ªFiberèŠ‚ç‚¹ã€‚æ•´ä¸ªç»„ä»¶æ ‘è¢«è½¬æ¢æˆä¸€ä¸ªç”±FiberèŠ‚ç‚¹æ„æˆçš„é“¾è¡¨ï¼ˆFiberæ ‘ï¼‰ã€‚æ¯ä¸ªFiberèŠ‚ç‚¹åŒ…å«äº†ç»„ä»¶çš„ç±»å‹ã€çŠ¶æ€ã€propsã€å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹ç­‰ä¿¡æ¯ã€‚</p>
<h3 id="åŒç¼“å­˜æŠ€æœ¯"><a href="#åŒç¼“å­˜æŠ€æœ¯" class="headerlink" title="åŒç¼“å­˜æŠ€æœ¯"></a>åŒç¼“å­˜æŠ€æœ¯</h3><p>Reactåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µFiberæ ‘ï¼š</p>
<ul>
<li><strong>currentæ ‘</strong>ï¼šå½“å‰å±å¹•ä¸Šæ˜¾ç¤ºå†…å®¹å¯¹åº”çš„Fiberæ ‘ã€‚</li>
<li><strong>workInProgressæ ‘</strong>ï¼šæ­£åœ¨æ„å»ºçš„æ–°çš„Fiberæ ‘ï¼ˆåœ¨å†…å­˜ä¸­æ„å»ºï¼‰ã€‚</li>
</ul>
<p>å½“workInProgressæ ‘æ„å»ºå®Œæˆå¹¶æ¸²æŸ“åˆ°å±å¹•ä¸Šåï¼ŒcurrentæŒ‡é’ˆå°±ä¼šæŒ‡å‘workInProgressæ ‘ï¼Œè€ŒworkInProgressæ ‘åˆ™å˜ä¸ºcurrentæ ‘ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸ºåŒç¼“å­˜ï¼Œå®ƒèƒ½å¤Ÿä¿è¯åœ¨æ›´æ–°è¿‡ç¨‹ä¸­å±å¹•å†…å®¹ä¸ä¼šå‡ºç°æ–­è£‚ï¼ˆå³ä¸ä¼šæ˜¾ç¤ºä¸å®Œæ•´çš„æ¸²æŸ“ç»“æœï¼‰ã€‚</p>
<h3 id="ä»»åŠ¡æ‹†åˆ†ä¸è°ƒåº¦"><a href="#ä»»åŠ¡æ‹†åˆ†ä¸è°ƒåº¦" class="headerlink" title="ä»»åŠ¡æ‹†åˆ†ä¸è°ƒåº¦"></a>ä»»åŠ¡æ‹†åˆ†ä¸è°ƒåº¦</h3><p>Fiberå°†æ¸²æŸ“è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>Reconciliationï¼ˆåè°ƒ&#x2F;æ¸²æŸ“é˜¶æ®µï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>è¿™ä¸ªé˜¶æ®µå¯ä»¥è¢«æ‰“æ–­ã€‚Reactä¼šç”Ÿæˆæ–°çš„Fiberæ ‘ï¼ˆworkInProgressæ ‘ï¼‰ï¼Œå¹¶é€šè¿‡diffç®—æ³•è®¡ç®—å‡ºéœ€è¦è¿›è¡Œçš„æ›´æ–°ï¼ˆå³å‰¯ä½œç”¨ï¼Œå¦‚å¢åˆ æ”¹èŠ‚ç‚¹ï¼‰ã€‚</li>
<li>è¿™ä¸ªé˜¶æ®µä¼šæ‰§è¡Œç»„ä»¶çš„<code>render</code>æ–¹æ³•ï¼Œå¹¶æ ‡è®°éœ€è¦æ›´æ–°çš„DOMèŠ‚ç‚¹ã€‚</li>
</ul>
<ol>
<li><strong>Commitï¼ˆæäº¤é˜¶æ®µï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>è¿™ä¸ªé˜¶æ®µæ˜¯åŒæ­¥çš„ï¼Œä¸èƒ½è¢«æ‰“æ–­ã€‚Reactå°†ä¸Šé˜¶æ®µè®¡ç®—å‡ºçš„å‰¯ä½œç”¨ä¸€æ¬¡æ€§æäº¤åˆ°DOMä¸Šï¼Œæ›´æ–°UIã€‚</li>
<li>è¿™ä¸ªé˜¶æ®µä¼šæ‰§è¡Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚<code>componentDidMount</code>ã€<code>componentDidUpdate</code>ï¼‰ä»¥åŠhooksä¸­çš„<code>useLayoutEffect</code>ã€‚</li>
</ul>
<h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p>Reactä¸ºä¸åŒçš„æ›´æ–°ä»»åŠ¡åˆ†é…äº†ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li><strong>Immediate</strong>ï¼šéœ€è¦ç«‹å³æ‰§è¡Œï¼Œä¾‹å¦‚ç”¨æˆ·è¾“å…¥ã€‚</li>
<li><strong>UserBlocking</strong>ï¼šç”¨æˆ·äº¤äº’çš„ç»“æœï¼Œä¾‹å¦‚ç‚¹å‡»äº‹ä»¶ã€‚</li>
<li><strong>Normal</strong>ï¼šé»˜è®¤ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚æ™®é€šçš„æ›´æ–°ã€‚</li>
<li><strong>Low</strong>ï¼šä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œä¾‹å¦‚æ•°æ®æ‹‰å–ã€‚</li>
<li><strong>Idle</strong>ï¼šç©ºé—²æ—¶æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li>
</ul>
<p>Reactä½¿ç”¨æµè§ˆå™¨çš„<code>requestIdleCallback</code>å’Œ<code>requestAnimationFrame</code>æ¥è°ƒåº¦ä»»åŠ¡ï¼Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œã€‚</p>
<h2 id="Fiberçš„å·¥ä½œæµç¨‹"><a href="#Fiberçš„å·¥ä½œæµç¨‹" class="headerlink" title="Fiberçš„å·¥ä½œæµç¨‹"></a>Fiberçš„å·¥ä½œæµç¨‹</h2><h3 id="åè°ƒé˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰"><a href="#åè°ƒé˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰" class="headerlink" title="åè°ƒé˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰"></a>åè°ƒé˜¶æ®µï¼ˆå¯ä¸­æ–­ï¼‰</h3><ol>
<li><strong>å¼€å§‹</strong>ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼ŒReactä¼šéå†æ¯ä¸ªFiberèŠ‚ç‚¹ã€‚</li>
<li><strong>æ„å»ºworkInProgressæ ‘</strong>ï¼š</li>
</ol>
<ul>
<li>å¯¹äºæ¯ä¸ªFiberèŠ‚ç‚¹ï¼ŒReactä¼šå¤åˆ¶å½“å‰èŠ‚ç‚¹ï¼ˆcurrentï¼‰æ¥åˆ›å»ºworkInProgressèŠ‚ç‚¹ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™æ–°å»ºï¼‰ã€‚</li>
<li>ç„¶åè°ƒç”¨ç»„ä»¶çš„<code>render</code>æ–¹æ³•ï¼ˆå‡½æ•°ç»„ä»¶åˆ™è°ƒç”¨å‡½æ•°æœ¬èº«ï¼‰è·å–å­å…ƒç´ ï¼Œå¹¶ä¸æ—§çš„å­å…ƒç´ è¿›è¡Œå¯¹æ¯”ï¼ˆdiffç®—æ³•ï¼‰ï¼Œç”Ÿæˆå­èŠ‚ç‚¹çš„FiberèŠ‚ç‚¹ã€‚</li>
<li>ä¸ºæ¯ä¸ªå­å…ƒç´ åˆ›å»ºæˆ–æ›´æ–°å¯¹åº”çš„FiberèŠ‚ç‚¹ï¼Œå¹¶å»ºç«‹çˆ¶å­ã€å…„å¼Ÿå…³ç³»ã€‚</li>
</ul>
<ol>
<li><strong>æ”¶é›†å‰¯ä½œç”¨</strong>ï¼šåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œæ ‡è®°éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ï¼ˆå¦‚éœ€è¦æ’å…¥ã€æ›´æ–°ã€åˆ é™¤çš„èŠ‚ç‚¹ï¼‰ï¼Œè¿™äº›å‰¯ä½œç”¨ä¼šè¢«è®°å½•åœ¨FiberèŠ‚ç‚¹ä¸Šï¼ˆeffectTagï¼‰ï¼Œå¹¶å½¢æˆä¸€ä¸ªå‰¯ä½œç”¨é“¾è¡¨ï¼ˆeffect listï¼‰ã€‚</li>
</ol>
<h3 id="æäº¤é˜¶æ®µï¼ˆä¸å¯ä¸­æ–­ï¼‰"><a href="#æäº¤é˜¶æ®µï¼ˆä¸å¯ä¸­æ–­ï¼‰" class="headerlink" title="æäº¤é˜¶æ®µï¼ˆä¸å¯ä¸­æ–­ï¼‰"></a>æäº¤é˜¶æ®µï¼ˆä¸å¯ä¸­æ–­ï¼‰</h3><ol>
<li><strong>å¤„ç†å‰¯ä½œç”¨</strong>ï¼šéå†å‰¯ä½œç”¨é“¾è¡¨ï¼Œæ‰§è¡ŒDOMæ›´æ–°ï¼ˆå¢åˆ æ”¹èŠ‚ç‚¹ï¼‰ã€‚</li>
<li><strong>è°ƒç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong>ï¼šåœ¨DOMæ›´æ–°åï¼Œè°ƒç”¨ç»„ä»¶çš„<code>componentDidMount</code>ã€<code>componentDidUpdate</code>ç­‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä»¥åŠhooksä¸­çš„<code>useLayoutEffect</code>ã€‚</li>
<li><strong>åˆ‡æ¢currentæ ‘</strong>ï¼šå°†workInProgressæ ‘è®¾ç½®ä¸ºcurrentæ ‘ã€‚</li>
</ol>
<h2 id="å¼‚æ­¥æ¸²æŸ“"><a href="#å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="å¼‚æ­¥æ¸²æŸ“"></a>å¼‚æ­¥æ¸²æŸ“</h2><p>Fiberæ¶æ„ä½¿å¾—Reactèƒ½å¤Ÿå®ç°å¼‚æ­¥æ¸²æŸ“ï¼ˆConcurrent Modeï¼‰ã€‚åœ¨å¼‚æ­¥æ¸²æŸ“æ¨¡å¼ä¸‹ï¼ŒReactå¯ä»¥åœ¨å¤šä¸ªå¸§ä¹‹é—´åˆ†æ®µæ‰§è¡Œæ¸²æŸ“ä»»åŠ¡ï¼Œå¹¶åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œä»è€Œé¿å…ä¸»çº¿ç¨‹é•¿æ—¶é—´è¢«å ç”¨ã€‚</p>
<h2 id="é”™è¯¯è¾¹ç•Œ"><a href="#é”™è¯¯è¾¹ç•Œ" class="headerlink" title="é”™è¯¯è¾¹ç•Œ"></a>é”™è¯¯è¾¹ç•Œ</h2><p>Fiberæ¶æ„å¼•å…¥äº†é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰çš„æ¦‚å¿µã€‚é”™è¯¯è¾¹ç•Œæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¯ä»¥æ•è·å­ç»„ä»¶æ ‘ä¸­ä»»ä½•ä½ç½®çš„JavaScripté”™è¯¯ï¼Œå¹¶è®°å½•è¿™äº›é”™è¯¯ï¼ŒåŒæ—¶æ˜¾ç¤ºé™çº§UIã€‚è¿™é€šè¿‡ç»„ä»¶çš„<code>static getDerivedStateFromError()</code>å’Œ<code>componentDidCatch()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å®ç°ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>React Fiberæ˜¯Reactæ ¸å¿ƒç®—æ³•çš„é‡æ„ï¼Œå®ƒè§£å†³äº†ä¹‹å‰ç‰ˆæœ¬ä¸­ç”±äºé€’å½’æ¸²æŸ“å¯¼è‡´çš„æ— æ³•ä¸­æ–­çš„é—®é¢˜ã€‚Fiberå°†æ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œå¹¶èµ‹äºˆä¼˜å…ˆçº§ï¼Œä½¿å¾—é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿä¸ºå¼‚æ­¥æ¸²æŸ“å’Œé”™è¯¯è¾¹ç•Œç­‰ç‰¹æ€§æä¾›äº†åŸºç¡€ã€‚</p>
<p>Fiberæ¶æ„ä¸»è¦åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼šå¯ä¸­æ–­çš„åè°ƒé˜¶æ®µå’Œä¸å¯ä¸­æ–­çš„æäº¤é˜¶æ®µã€‚åœ¨åè°ƒé˜¶æ®µï¼ŒReactæ„å»ºworkInProgressæ ‘å¹¶æ”¶é›†å‰¯ä½œç”¨ï¼›åœ¨æäº¤é˜¶æ®µï¼ŒReactå°†å‰¯ä½œç”¨åº”ç”¨åˆ°DOMä¸Šå¹¶æ‰§è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p>
<h1 id="React-Fiber-æ¶æ„æ·±åº¦è§£æï¼šåŸç†ã€æœºåˆ¶ä¸å®æˆ˜ä¼˜åŒ–"><a href="#React-Fiber-æ¶æ„æ·±åº¦è§£æï¼šåŸç†ã€æœºåˆ¶ä¸å®æˆ˜ä¼˜åŒ–" class="headerlink" title="React Fiber æ¶æ„æ·±åº¦è§£æï¼šåŸç†ã€æœºåˆ¶ä¸å®æˆ˜ä¼˜åŒ–"></a>React Fiber æ¶æ„æ·±åº¦è§£æï¼šåŸç†ã€æœºåˆ¶ä¸å®æˆ˜ä¼˜åŒ–</h1><p>React Fiber æ˜¯ React 16 å¼•å…¥çš„<strong>æ ¸å¿ƒé‡å†™æ¶æ„</strong>ï¼Œå½»åº•æ”¹å˜äº† React çš„æ¸²æŸ“æœºåˆ¶ã€‚å®ƒè§£å†³äº†å¤§å‹åº”ç”¨ä¸­çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼Œå¹¶ä¸ºå¼‚æ­¥æ¸²æŸ“ã€ä¼˜å…ˆçº§è°ƒåº¦ç­‰é«˜çº§ç‰¹æ€§å¥ å®šäº†åŸºç¡€ã€‚</p>
<h2 id="ä¸€ã€Fiber-è¯ç”Ÿçš„èƒŒæ™¯ä¸æŒ‘æˆ˜"><a href="#ä¸€ã€Fiber-è¯ç”Ÿçš„èƒŒæ™¯ä¸æŒ‘æˆ˜" class="headerlink" title="ä¸€ã€Fiber è¯ç”Ÿçš„èƒŒæ™¯ä¸æŒ‘æˆ˜"></a>ä¸€ã€Fiber è¯ç”Ÿçš„èƒŒæ™¯ä¸æŒ‘æˆ˜</h2><h3 id="ä¼ ç»Ÿ-Stack-Reconciler-çš„é—®é¢˜"><a href="#ä¼ ç»Ÿ-Stack-Reconciler-çš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿ Stack Reconciler çš„é—®é¢˜"></a>ä¼ ç»Ÿ Stack Reconciler çš„é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[setState] --&gt; B[å¼€å§‹æ¸²æŸ“]</span><br><span class="line">    B --&gt; C[é€’å½’å¤„ç†ç»„ä»¶æ ‘]</span><br><span class="line">    C --&gt; D[æ·±åº¦ä¼˜å…ˆéå†]</span><br><span class="line">    D --&gt; E[ä¸å¯ä¸­æ–­]</span><br><span class="line">    E --&gt; F[ä¸»çº¿ç¨‹é˜»å¡]</span><br><span class="line">    F --&gt; G[åŠ¨ç”»å¡é¡¿/è¾“å…¥å»¶è¿Ÿ]</span><br></pre></td></tr></table></figure>

<p>åœ¨ React 15 åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼š</p>
<ul>
<li><strong>é€’å½’æ¸²æŸ“</strong>ï¼šæ·±åº¦ä¼˜å…ˆéå†æ•´ä¸ªç»„ä»¶æ ‘</li>
<li><strong>åŒæ­¥é˜»å¡</strong>ï¼šæ— æ³•ä¸­æ–­æ¸²æŸ“è¿‡ç¨‹</li>
<li><strong>æ— ä¼˜å…ˆçº§</strong>ï¼šæ‰€æœ‰æ›´æ–°ä»»åŠ¡å¹³ç­‰å¤„ç†</li>
<li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå¤§å‹åº”ç”¨æ¸²æŸ“æ—¶é—´è¶…è¿‡ 16msï¼ˆ60fps æ ‡å‡†ï¼‰</li>
</ul>
<h3 id="æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶é™åˆ¶"><a href="#æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶é™åˆ¶" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶é™åˆ¶"></a>æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶é™åˆ¶</h3><pre><code>[  16ms å¸§æ—¶é—´  ]
â”œâ”€â”€ JavaScript æ‰§è¡Œ
â”œâ”€â”€ æ ·å¼è®¡ç®—
â”œâ”€â”€ å¸ƒå±€
â”œâ”€â”€ ç»˜åˆ¶
â””â”€â”€ ç©ºé—²æ—¶é—´ â† Fiber åˆ©ç”¨è¿™é‡Œ
</code></pre>
<h2 id="äºŒã€Fiber-æ¶æ„æ ¸å¿ƒåŸç†"><a href="#äºŒã€Fiber-æ¶æ„æ ¸å¿ƒåŸç†" class="headerlink" title="äºŒã€Fiber æ¶æ„æ ¸å¿ƒåŸç†"></a>äºŒã€Fiber æ¶æ„æ ¸å¿ƒåŸç†</h2><h3 id="1-Fiber-èŠ‚ç‚¹æ•°æ®ç»“æ„"><a href="#1-Fiber-èŠ‚ç‚¹æ•°æ®ç»“æ„" class="headerlink" title="1. Fiber èŠ‚ç‚¹æ•°æ®ç»“æ„"></a>1. Fiber èŠ‚ç‚¹æ•°æ®ç»“æ„</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FiberNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  tag: WorkTag,</span></span><br><span class="line"><span class="params">  pendingProps: mixed,</span></span><br><span class="line"><span class="params">  key: <span class="literal">null</span> | string,</span></span><br><span class="line"><span class="params">  mode: TypeOfMode,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹æ ‡è¯†</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">tag</span> = tag;          <span class="comment">// ç»„ä»¶ç±»å‹ï¼ˆå‡½æ•°/ç±»/Hostç­‰ï¼‰</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">key</span> = key;          <span class="comment">// å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">elementType</span> = <span class="literal">null</span>; <span class="comment">// å…ƒç´ ç±»å‹</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="literal">null</span>;        <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">stateNode</span> = <span class="literal">null</span>;   <span class="comment">// ç»„ä»¶å®ä¾‹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ ‘ç»“æ„å…³ç³»</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">return</span> = <span class="literal">null</span>;     <span class="comment">// çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">child</span> = <span class="literal">null</span>;      <span class="comment">// é¦–å­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sibling</span> = <span class="literal">null</span>;    <span class="comment">// å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// çŠ¶æ€ä¸å±æ€§</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingProps</span> = pendingProps; <span class="comment">// æ–° props</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedProps</span> = <span class="literal">null</span>;        <span class="comment">// å½“å‰ props</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedState</span> = <span class="literal">null</span>;        <span class="comment">// å½“å‰ state</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">updateQueue</span> = <span class="literal">null</span>;          <span class="comment">// æ›´æ–°é˜Ÿåˆ—</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å‰¯ä½œç”¨æ ‡è®°</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">flags</span> = <span class="title class_">NoFlags</span>;            <span class="comment">// æ“ä½œç±»å‹ï¼ˆå¢/åˆ /æ”¹ï¼‰</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subtreeFlags</span> = <span class="title class_">NoFlags</span>;     <span class="comment">// å­æ ‘å‰¯ä½œç”¨</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">deletions</span> = <span class="literal">null</span>;           <span class="comment">// å¾…åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è°ƒåº¦ä¼˜å…ˆçº§</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">lanes</span> = <span class="title class_">NoLanes</span>;            <span class="comment">// ä»»åŠ¡ä¼˜å…ˆçº§</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">childLanes</span> = <span class="title class_">NoLanes</span>;       <span class="comment">// å­æ ‘ä¼˜å…ˆçº§</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åŒç¼“å­˜æŒ‡é’ˆ</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">alternate</span> = <span class="literal">null</span>;           <span class="comment">// æŒ‡å‘å¦ä¸€æ£µæ ‘èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Fiber-æ ‘ä¸åŒç¼“å­˜æœºåˆ¶"><a href="#2-Fiber-æ ‘ä¸åŒç¼“å­˜æœºåˆ¶" class="headerlink" title="2. Fiber æ ‘ä¸åŒç¼“å­˜æœºåˆ¶"></a>2. Fiber æ ‘ä¸åŒç¼“å­˜æœºåˆ¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Current Tree] --&gt;|æ˜¾ç¤ºåœ¨å±å¹•| B[ç”¨æˆ·ç•Œé¢]</span><br><span class="line">    C[WorkInProgress Tree] --&gt;|æ„å»ºä¸­| D[å†…å­˜]</span><br><span class="line">    </span><br><span class="line">    A --&gt;|alternate| C</span><br><span class="line">    C --&gt;|alternate| A</span><br><span class="line">    </span><br><span class="line">    E[æäº¤é˜¶æ®µ] --&gt;|åˆ‡æ¢æŒ‡é’ˆ| F[WorkInProgress æˆä¸º Current]</span><br></pre></td></tr></table></figure>

<h3 id="3-æ¸²æŸ“æµç¨‹ï¼šå¯ä¸­æ–­çš„å¼‚æ­¥æ¸²æŸ“"><a href="#3-æ¸²æŸ“æµç¨‹ï¼šå¯ä¸­æ–­çš„å¼‚æ­¥æ¸²æŸ“" class="headerlink" title="3. æ¸²æŸ“æµç¨‹ï¼šå¯ä¸­æ–­çš„å¼‚æ­¥æ¸²æŸ“"></a>3. æ¸²æŸ“æµç¨‹ï¼šå¯ä¸­æ–­çš„å¼‚æ­¥æ¸²æŸ“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    A[è§¦å‘æ›´æ–°] --&gt; B&#123;è°ƒåº¦å¼€å§‹&#125;</span><br><span class="line">    B --&gt; C[åˆ›å»ºWorkInProgressæ ‘]</span><br><span class="line">    C --&gt; D[éå†FiberèŠ‚ç‚¹]</span><br><span class="line">    D --&gt; E&#123;æ—¶é—´ç‰‡ç”¨å®Œï¼Ÿ&#125;</span><br><span class="line">    E --&gt;|æ˜¯| F[æš‚åœå¹¶è¿”å›æ§åˆ¶æƒ]</span><br><span class="line">    E --&gt;|å¦| G[å¤„ç†å½“å‰èŠ‚ç‚¹]</span><br><span class="line">    G --&gt; H[å®Œæˆæ‰€æœ‰èŠ‚ç‚¹ï¼Ÿ]</span><br><span class="line">    H --&gt;|å¦| D</span><br><span class="line">    H --&gt;|æ˜¯| I[æäº¤æ›´æ–°]</span><br><span class="line">    I --&gt; J[åˆ‡æ¢CurrentæŒ‡é’ˆ]</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€Fiber-æ ¸å¿ƒæœºåˆ¶è¯¦è§£"><a href="#ä¸‰ã€Fiber-æ ¸å¿ƒæœºåˆ¶è¯¦è§£" class="headerlink" title="ä¸‰ã€Fiber æ ¸å¿ƒæœºåˆ¶è¯¦è§£"></a>ä¸‰ã€Fiber æ ¸å¿ƒæœºåˆ¶è¯¦è§£</h2><h3 id="1-ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆLane-æ¨¡å‹ï¼‰"><a href="#1-ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆLane-æ¨¡å‹ï¼‰" class="headerlink" title="1. ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆLane æ¨¡å‹ï¼‰"></a>1. ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆLane æ¨¡å‹ï¼‰</h3><p>React 18 å¼•å…¥çš„ Lane ä¼˜å…ˆçº§ç³»ç»Ÿï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">NoLanes</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000000</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SyncLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000001</span>; <span class="comment">// æœ€é«˜ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">InputContinuousLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000100</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">DefaultLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000010000</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TransitionLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000010000000000</span>; <span class="comment">// 18æ–°å¢</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">IdleLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0100000000000000000000000000000</span>; <span class="comment">// æœ€ä½</span></span><br></pre></td></tr></table></figure>

<p><strong>è°ƒåº¦ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·è¾“å…¥ &gt; åŠ¨ç”» &gt; æ™®é€šæ›´æ–° &gt; åå°ä»»åŠ¡</li>
<li>é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯ä¸­æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡</li>
</ul>
<h3 id="2-æ¸²æŸ“é˜¶æ®µåˆ†è§£"><a href="#2-æ¸²æŸ“é˜¶æ®µåˆ†è§£" class="headerlink" title="2. æ¸²æŸ“é˜¶æ®µåˆ†è§£"></a>2. æ¸²æŸ“é˜¶æ®µåˆ†è§£</h3><h4 id="é˜¶æ®µ1-Render-Phaseï¼ˆå¯ä¸­æ–­ï¼‰"><a href="#é˜¶æ®µ1-Render-Phaseï¼ˆå¯ä¸­æ–­ï¼‰" class="headerlink" title="é˜¶æ®µ1: Render Phaseï¼ˆå¯ä¸­æ–­ï¼‰"></a>é˜¶æ®µ1: Render Phaseï¼ˆå¯ä¸­æ–­ï¼‰</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">performUnitOfWork</span>(<span class="params">fiber</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. å¼€å§‹å·¥ä½œï¼ˆbeginWorkï¼‰</span></span><br><span class="line">  <span class="keyword">const</span> next = <span class="title function_">beginWork</span>(fiber);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (next) &#123;</span><br><span class="line">    <span class="comment">// å­˜åœ¨å­èŠ‚ç‚¹ï¼Œç»§ç»­å¤„ç†</span></span><br><span class="line">    <span class="keyword">return</span> next; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. å®Œæˆå·¥ä½œï¼ˆcompleteWorkï¼‰</span></span><br><span class="line">  <span class="keyword">let</span> sibling = <span class="title function_">completeWork</span>(fiber);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (sibling) &#123;</span><br><span class="line">    <span class="comment">// å­˜åœ¨å…„å¼ŸèŠ‚ç‚¹ï¼Œå¤„ç†å…„å¼Ÿ</span></span><br><span class="line">    <span class="keyword">return</span> sibling;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. å›æº¯çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">completeWork</span>(fiber.<span class="property">return</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é˜¶æ®µ2-Commit-Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰"><a href="#é˜¶æ®µ2-Commit-Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰" class="headerlink" title="é˜¶æ®µ2: Commit Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰"></a>é˜¶æ®µ2: Commit Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">commitRoot</span>(<span class="params">root</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. å‰¯ä½œç”¨æäº¤å‰</span></span><br><span class="line">  <span class="title function_">commitBeforeMutationEffects</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. DOM å˜æ›´</span></span><br><span class="line">  <span class="title function_">commitMutationEffects</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. åˆ‡æ¢å½“å‰æ ‘</span></span><br><span class="line">  root.<span class="property">current</span> = finishedWork;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 4. å‰¯ä½œç”¨æäº¤å</span></span><br><span class="line">  <span class="title function_">commitLayoutEffects</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-å‰¯ä½œç”¨ï¼ˆEffectsï¼‰å¤„ç†"><a href="#3-å‰¯ä½œç”¨ï¼ˆEffectsï¼‰å¤„ç†" class="headerlink" title="3. å‰¯ä½œç”¨ï¼ˆEffectsï¼‰å¤„ç†"></a>3. å‰¯ä½œç”¨ï¼ˆEffectsï¼‰å¤„ç†</h3><p>React å°† DOM æ“ä½œæŠ½è±¡ä¸ºå‰¯ä½œç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰¯ä½œç”¨é“¾è¡¨ç»“æ„</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">commitMutationEffects</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> effect = firstEffect;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (effect !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = effect.<span class="property">nextEffect</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (effect.<span class="property">flags</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Placement</span>:</span><br><span class="line">        <span class="title function_">commitPlacement</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Update</span>:</span><br><span class="line">        <span class="title function_">commitUpdate</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Deletion</span>:</span><br><span class="line">        <span class="title function_">commitDeletion</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ...å…¶ä»–å‰¯ä½œç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    effect = next;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€Fiber-å¸¦æ¥çš„é©å‘½æ€§ç‰¹æ€§"><a href="#å››ã€Fiber-å¸¦æ¥çš„é©å‘½æ€§ç‰¹æ€§" class="headerlink" title="å››ã€Fiber å¸¦æ¥çš„é©å‘½æ€§ç‰¹æ€§"></a>å››ã€Fiber å¸¦æ¥çš„é©å‘½æ€§ç‰¹æ€§</h2><h3 id="1-å¹¶å‘æ¨¡å¼ï¼ˆConcurrent-Modeï¼‰"><a href="#1-å¹¶å‘æ¨¡å¼ï¼ˆConcurrent-Modeï¼‰" class="headerlink" title="1. å¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰"></a>1. å¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ç”¨å¹¶å‘æ¨¡å¼</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p><strong>å¹¶å‘ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li><code>useTransition()</code>ï¼šéé˜»å¡UIæ›´æ–°</li>
<li><code>useDeferredValue()</code>ï¼šå»¶è¿Ÿæ›´æ–°</li>
<li><code>&lt;Suspense&gt;</code>ï¼šæ•°æ®åŠ è½½å¤„ç†</li>
</ul>
<h3 id="2-å¯ä¸­æ–­æ¸²æŸ“"><a href="#2-å¯ä¸­æ–­æ¸²æŸ“" class="headerlink" title="2. å¯ä¸­æ–­æ¸²æŸ“"></a>2. å¯ä¸­æ–­æ¸²æŸ“</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿé«˜å¼€é”€æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">HeavyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼ ç»ŸReactä¼šé˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">    items.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span>Item &#123;i&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fiberä¸‹å¯è¢«ä¸­æ–­ï¼Œä¿æŒUIå“åº”</span></span><br></pre></td></tr></table></figure>

<h3 id="3-é”™è¯¯è¾¹ç•Œï¼ˆError-Boundariesï¼‰"><a href="#3-é”™è¯¯è¾¹ç•Œï¼ˆError-Boundariesï¼‰" class="headerlink" title="3. é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰"></a>3. é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, info</span>) &#123;</span><br><span class="line">    <span class="title function_">logError</span>(error, info);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span></span><br><span class="line">      ? <span class="language-xml"><span class="tag">&lt;<span class="name">FallbackUI</span> /&gt;</span></span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€Fiber-æ€§èƒ½ä¼˜åŒ–å®æˆ˜"><a href="#äº”ã€Fiber-æ€§èƒ½ä¼˜åŒ–å®æˆ˜" class="headerlink" title="äº”ã€Fiber æ€§èƒ½ä¼˜åŒ–å®æˆ˜"></a>äº”ã€Fiber æ€§èƒ½ä¼˜åŒ–å®æˆ˜</h2><h3 id="1-æ¸²æŸ“æ€§èƒ½åˆ†æ"><a href="#1-æ¸²æŸ“æ€§èƒ½åˆ†æ" class="headerlink" title="1. æ¸²æŸ“æ€§èƒ½åˆ†æ"></a>1. æ¸²æŸ“æ€§èƒ½åˆ†æ</h3><p>ä½¿ç”¨ React DevTools åˆ†æç»„ä»¶æ¸²æŸ“ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æµ‹ä¸å¿…è¦çš„æ¸²æŸ“</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨React.memoä¼˜åŒ–</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ExpensiveChild</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">MyComponent</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¼˜å…ˆçº§æ§åˆ¶ç¤ºä¾‹"><a href="#2-ä¼˜å…ˆçº§æ§åˆ¶ç¤ºä¾‹" class="headerlink" title="2. ä¼˜å…ˆçº§æ§åˆ¶ç¤ºä¾‹"></a>2. ä¼˜å…ˆçº§æ§åˆ¶ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; startTransition, useDeferredValue &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> value = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">setQuery</span>(value);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ‡è®°ä¸ºéç´§æ€¥æ›´æ–°</span></span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setResults</span>(<span class="title function_">fetchResults</span>(value));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;query&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Results</span> <span class="attr">query</span>=<span class="string">&#123;deferredQuery&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-è™šæ‹ŸåŒ–é•¿åˆ—è¡¨"><a href="#3-è™šæ‹ŸåŒ–é•¿åˆ—è¡¨" class="headerlink" title="3. è™šæ‹ŸåŒ–é•¿åˆ—è¡¨"></a>3. è™šæ‹ŸåŒ–é•¿åˆ—è¡¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FixedSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; index, style &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span>Row &#123;index&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">FixedSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">height</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">width</span>=<span class="string">&#123;300&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">itemSize</span>=<span class="string">&#123;50&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">itemCount</span>=<span class="string">&#123;1000&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">FixedSizeList</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€Fiber-ä¸ä¼ ç»Ÿæ¶æ„å¯¹æ¯”"><a href="#å…­ã€Fiber-ä¸ä¼ ç»Ÿæ¶æ„å¯¹æ¯”" class="headerlink" title="å…­ã€Fiber ä¸ä¼ ç»Ÿæ¶æ„å¯¹æ¯”"></a>å…­ã€Fiber ä¸ä¼ ç»Ÿæ¶æ„å¯¹æ¯”</h2><table>
<thead>
<tr>
<th><strong>ç‰¹æ€§</strong></th>
<th>Stack Reconciler (React 15)</th>
<th>Fiber (React 16+)</th>
</tr>
</thead>
<tbody><tr>
<td>æ¸²æŸ“æœºåˆ¶</td>
<td>é€’å½’ï¼ˆä¸å¯ä¸­æ–­ï¼‰</td>
<td>é“¾è¡¨éå†ï¼ˆå¯æš‚åœ&#x2F;æ¢å¤ï¼‰</td>
</tr>
<tr>
<td>ä»»åŠ¡è°ƒåº¦</td>
<td>åŒæ­¥</td>
<td>ä¼˜å…ˆçº§å¼‚æ­¥è°ƒåº¦</td>
</tr>
<tr>
<td>æ¸²æŸ“é˜¶æ®µ</td>
<td>å•é˜¶æ®µï¼ˆcommitï¼‰</td>
<td>åŒé˜¶æ®µï¼ˆrender&#x2F;commitï¼‰</td>
</tr>
<tr>
<td>æœ€å¤§ä¼˜åŠ¿</td>
<td>å®ç°ç®€å•</td>
<td>é«˜æ€§èƒ½ã€é«˜å“åº”æ€§</td>
</tr>
<tr>
<td>æ”¯æŒç‰¹æ€§</td>
<td>åŸºç¡€æ›´æ–°</td>
<td>å¹¶å‘æ¸²æŸ“ã€Suspense</td>
</tr>
<tr>
<td>é”™è¯¯å¤„ç†</td>
<td>æ•´ä¸ªåº”ç”¨å´©æºƒ</td>
<td>é”™è¯¯è¾¹ç•Œå±€éƒ¨æ•è·</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ç®€å•åº”ç”¨</td>
<td>å¤æ‚ä¼ä¸šçº§åº”ç”¨</td>
</tr>
</tbody></table>
<h2 id="ä¸ƒã€Fiber-æœ€ä½³å®è·µæŒ‡å—"><a href="#ä¸ƒã€Fiber-æœ€ä½³å®è·µæŒ‡å—" class="headerlink" title="ä¸ƒã€Fiber æœ€ä½³å®è·µæŒ‡å—"></a>ä¸ƒã€Fiber æœ€ä½³å®è·µæŒ‡å—</h2><ol>
<li><p><strong>ç»„ä»¶è®¾è®¡åŸåˆ™</strong>ï¼š</p>
<ul>
<li>æ‹†åˆ†å¤§å‹ç»„ä»¶</li>
<li>ä½¿ç”¨ <code>React.memo</code> ä¼˜åŒ–</li>
<li>é¿å…å†…è”å‡½æ•°&#x2F;å¯¹è±¡</li>
</ul>
</li>
<li><p><strong>çŠ¶æ€ç®¡ç†ä¼˜åŒ–</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨useStateæƒ°æ€§åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computeExpensiveValue</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¹¶å‘æ¨¡å¼è¿ç§»</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¸è¿›å¼è¿ç§»ç­–ç•¥</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBlockingRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é”®è·¯å¾„ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼</span></span><br><span class="line"><span class="keyword">const</span> criticalRoot = <span class="title function_">createBlockingRoot</span>(container);</span><br><span class="line">criticalRoot.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">CriticalApp</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå…³é”®è·¯å¾„ä½¿ç”¨å¹¶å‘æ¨¡å¼</span></span><br><span class="line"><span class="keyword">const</span> concurrentRoot = <span class="title function_">createRoot</span>(nonCriticalContainer);</span><br><span class="line">concurrentRoot.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">NonCriticalApp</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Suspense æ•°æ®è·å–</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºèµ„æºåŒ…è£…å™¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> status = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">let</span> suspender = <span class="title function_">fetch</span>(<span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      status = <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">      result = data;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">throw</span> suspender;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="string">&#x27;error&#x27;</span>) <span class="keyword">throw</span> result;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = userResource.<span class="title function_">read</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="å…«ã€Fiber-æœªæ¥æ¼”è¿›æ–¹å‘"><a href="#å…«ã€Fiber-æœªæ¥æ¼”è¿›æ–¹å‘" class="headerlink" title="å…«ã€Fiber æœªæ¥æ¼”è¿›æ–¹å‘"></a>å…«ã€Fiber æœªæ¥æ¼”è¿›æ–¹å‘</h2><ol>
<li><p><strong>ç¦»å±æ¸²æŸ“ï¼ˆOffscreen Renderingï¼‰</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Offscreen</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MainContent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Offscreen</span> <span class="attr">mode</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ExpensiveSidebar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Offscreen</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æœåŠ¡å™¨ç»„ä»¶ï¼ˆServer Componentsï¼‰</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯ç»„ä»¶ï¼ˆä¸å‘é€åˆ°å®¢æˆ·ç«¯ï¼‰</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Note</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> note = <span class="keyword">await</span> db.<span class="property">notes</span>.<span class="title function_">get</span>(id);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">NoteView</span> <span class="attr">note</span>=<span class="string">&#123;note&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å“åº”å¼ Hooks</strong>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; use &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Weather</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">use</span>(<span class="title function_">fetchWeather</span>());</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.temperature&#125;Â°C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/" data-id="cmcae1sk6007lsssd5xnjfr7w" data-title="006-React Fiberè¯¦è§£" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/06/07/devops/001-Docker%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          001-DockeråŸºç¡€å¤ä¹ 
        
      </div>
    </a>
  
  
    <a href="/2025/06/01/frontend/react/005-React%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ã„lter</strong>
      <div class="article-nav-title">005-Reactæ€§èƒ½ä¼˜åŒ–</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CNBC/">CNBC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Openshift/">Openshift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/kubernetes/">kubernetes</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/">Foundation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/OS/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/ProtocolAndBrowser/">ProtocolAndBrowser</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/Sass/">Sass</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/">ML_LLM_AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/Pytorch/">Pytorch</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Principles/">Principles</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/">algorithms</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/leetcode/">leetcode</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNBC-Finance/" rel="tag">CNBC Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Principles/" rel="tag">Principles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProtocolAndBrowser/" rel="tag">ProtocolAndBrowser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sass/" rel="tag">Sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CNBC-Finance/" style="font-size: 10px;">CNBC Finance</a> <a href="/tags/CSS/" style="font-size: 18.89px;">CSS</a> <a href="/tags/DB/" style="font-size: 11.11px;">DB</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Javascript/" style="font-size: 17.78px;">Javascript</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/OS/" style="font-size: 11.11px;">OS</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Principles/" style="font-size: 10px;">Principles</a> <a href="/tags/ProtocolAndBrowser/" style="font-size: 16.67px;">ProtocolAndBrowser</a> <a href="/tags/Pytorch/" style="font-size: 13.33px;">Pytorch</a> <a href="/tags/React/" style="font-size: 14.44px;">React</a> <a href="/tags/Sass/" style="font-size: 12.22px;">Sass</a> <a href="/tags/algorithms/" style="font-size: 20px;">algorithms</a> <a href="/tags/k8s/" style="font-size: 15.56px;">k8s</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.9%20Kube%20Pods/">1.9 Kube Pods</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.8%20Kube%20Proxy/">1.8 Kube Proxy</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.7%20Kubelet/">1.7 Kubelet</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.6%20Kube%20Scheduler/">1.6 Kube Scheduler</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.5%20Kube%20Controller%20Manager/">1.5 Kube Controller Manager</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 EvelynUU<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>