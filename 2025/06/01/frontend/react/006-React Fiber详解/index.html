<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>006-React Fiber详解 | ✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="React Fiber是React 16中引入的新的协调算法，它重新实现了React的核心算法，旨在解决一些长期存在的问题，并提供了更好的性能，尤其是对动画、布局和手势等需要高响应性的领域。同时，它也为未来的特性（如异步渲染）奠定了基础。 为什么需要Fiber？在React 15及之前，React使用递归方式处理组件树。当React开始渲染时，它会递归地遍历整个组件树，并且一旦开始就不能中断。如果">
<meta property="og:type" content="article">
<meta property="og:title" content="006-React Fiber详解">
<meta property="og:url" content="http://example.com/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨">
<meta property="og:description" content="React Fiber是React 16中引入的新的协调算法，它重新实现了React的核心算法，旨在解决一些长期存在的问题，并提供了更好的性能，尤其是对动画、布局和手势等需要高响应性的领域。同时，它也为未来的特性（如异步渲染）奠定了基础。 为什么需要Fiber？在React 15及之前，React使用递归方式处理组件树。当React开始渲染时，它会递归地遍历整个组件树，并且一旦开始就不能中断。如果">
<meta property="og:locale">
<meta property="article:published_time" content="2025-06-01T05:44:55.000Z">
<meta property="article:modified_time" content="2025-06-24T09:47:43.684Z">
<meta property="article:author" content="EvelynUU">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Repeatings, Thoughts, and Writings</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-frontend/react/006-React Fiber详解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2025-06-01T05:44:55.000Z" itemprop="datePublished">2025-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Frontend/">Frontend</a>►<a class="article-category-link" href="/categories/Frontend/React/">React</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      006-React Fiber详解
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>React Fiber是React 16中引入的新的协调算法，它重新实现了React的核心算法，旨在解决一些长期存在的问题，并提供了更好的性能，尤其是对动画、布局和手势等需要高响应性的领域。同时，它也为未来的特性（如异步渲染）奠定了基础。</p>
<h2 id="为什么需要Fiber？"><a href="#为什么需要Fiber？" class="headerlink" title="为什么需要Fiber？"></a>为什么需要Fiber？</h2><p>在React 15及之前，React使用递归方式处理组件树。当React开始渲染时，它会递归地遍历整个组件树，并且一旦开始就不能中断。如果组件树很大，主线程可能会被长时间占用，导致无法及时响应用户交互（如动画、输入等），造成卡顿。</p>
<p>Fiber的目标是：</p>
<ol>
<li><strong>可中断任务</strong>：将渲染任务拆分成多个小任务，可以按优先级执行，高优先级任务（如用户输入）可以打断低优先级任务（如渲染）。</li>
<li><strong>增量渲染</strong>：允许React将渲染工作分批进行，而不是一次性完成整个组件树。</li>
<li><strong>更好的错误处理</strong>：引入错误边界（Error Boundaries）来捕获和处理组件树中的错误。</li>
</ol>
<h2 id="Fiber的核心概念"><a href="#Fiber的核心概念" class="headerlink" title="Fiber的核心概念"></a>Fiber的核心概念</h2><h3 id="Fiber节点"><a href="#Fiber节点" class="headerlink" title="Fiber节点"></a>Fiber节点</h3><p>在Fiber架构中，React将每个组件表示为一个Fiber节点。整个组件树被转换成一个由Fiber节点构成的链表（Fiber树）。每个Fiber节点包含了组件的类型、状态、props、子节点、兄弟节点、父节点等信息。</p>
<h3 id="双缓存技术"><a href="#双缓存技术" class="headerlink" title="双缓存技术"></a>双缓存技术</h3><p>React在更新过程中会同时存在两棵Fiber树：</p>
<ul>
<li><strong>current树</strong>：当前屏幕上显示内容对应的Fiber树。</li>
<li><strong>workInProgress树</strong>：正在构建的新的Fiber树（在内存中构建）。</li>
</ul>
<p>当workInProgress树构建完成并渲染到屏幕上后，current指针就会指向workInProgress树，而workInProgress树则变为current树。这种技术称为双缓存，它能够保证在更新过程中屏幕内容不会出现断裂（即不会显示不完整的渲染结果）。</p>
<h3 id="任务拆分与调度"><a href="#任务拆分与调度" class="headerlink" title="任务拆分与调度"></a>任务拆分与调度</h3><p>Fiber将渲染过程拆分为两个阶段：</p>
<ol>
<li><strong>Reconciliation（协调&#x2F;渲染阶段）</strong>：</li>
</ol>
<ul>
<li>这个阶段可以被打断。React会生成新的Fiber树（workInProgress树），并通过diff算法计算出需要进行的更新（即副作用，如增删改节点）。</li>
<li>这个阶段会执行组件的<code>render</code>方法，并标记需要更新的DOM节点。</li>
</ul>
<ol>
<li><strong>Commit（提交阶段）</strong>：</li>
</ol>
<ul>
<li>这个阶段是同步的，不能被打断。React将上阶段计算出的副作用一次性提交到DOM上，更新UI。</li>
<li>这个阶段会执行生命周期方法（如<code>componentDidMount</code>、<code>componentDidUpdate</code>）以及hooks中的<code>useLayoutEffect</code>。</li>
</ul>
<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>React为不同的更新任务分配了优先级：</p>
<ul>
<li><strong>Immediate</strong>：需要立即执行，例如用户输入。</li>
<li><strong>UserBlocking</strong>：用户交互的结果，例如点击事件。</li>
<li><strong>Normal</strong>：默认优先级，例如普通的更新。</li>
<li><strong>Low</strong>：低优先级任务，例如数据拉取。</li>
<li><strong>Idle</strong>：空闲时执行的任务。</li>
</ul>
<p>React使用浏览器的<code>requestIdleCallback</code>和<code>requestAnimationFrame</code>来调度任务，确保高优先级任务优先执行。</p>
<h2 id="Fiber的工作流程"><a href="#Fiber的工作流程" class="headerlink" title="Fiber的工作流程"></a>Fiber的工作流程</h2><h3 id="协调阶段（可中断）"><a href="#协调阶段（可中断）" class="headerlink" title="协调阶段（可中断）"></a>协调阶段（可中断）</h3><ol>
<li><strong>开始</strong>：从根节点开始，React会遍历每个Fiber节点。</li>
<li><strong>构建workInProgress树</strong>：</li>
</ol>
<ul>
<li>对于每个Fiber节点，React会复制当前节点（current）来创建workInProgress节点（如果不存在则新建）。</li>
<li>然后调用组件的<code>render</code>方法（函数组件则调用函数本身）获取子元素，并与旧的子元素进行对比（diff算法），生成子节点的Fiber节点。</li>
<li>为每个子元素创建或更新对应的Fiber节点，并建立父子、兄弟关系。</li>
</ul>
<ol>
<li><strong>收集副作用</strong>：在遍历过程中，标记需要更新的节点（如需要插入、更新、删除的节点），这些副作用会被记录在Fiber节点上（effectTag），并形成一个副作用链表（effect list）。</li>
</ol>
<h3 id="提交阶段（不可中断）"><a href="#提交阶段（不可中断）" class="headerlink" title="提交阶段（不可中断）"></a>提交阶段（不可中断）</h3><ol>
<li><strong>处理副作用</strong>：遍历副作用链表，执行DOM更新（增删改节点）。</li>
<li><strong>调用生命周期方法</strong>：在DOM更新后，调用组件的<code>componentDidMount</code>、<code>componentDidUpdate</code>等生命周期方法，以及hooks中的<code>useLayoutEffect</code>。</li>
<li><strong>切换current树</strong>：将workInProgress树设置为current树。</li>
</ol>
<h2 id="异步渲染"><a href="#异步渲染" class="headerlink" title="异步渲染"></a>异步渲染</h2><p>Fiber架构使得React能够实现异步渲染（Concurrent Mode）。在异步渲染模式下，React可以在多个帧之间分段执行渲染任务，并在浏览器空闲时执行低优先级任务，从而避免主线程长时间被占用。</p>
<h2 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h2><p>Fiber架构引入了错误边界（Error Boundaries）的概念。错误边界是一个组件，它可以捕获子组件树中任何位置的JavaScript错误，并记录这些错误，同时显示降级UI。这通过组件的<code>static getDerivedStateFromError()</code>和<code>componentDidCatch()</code>生命周期方法实现。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>React Fiber是React核心算法的重构，它解决了之前版本中由于递归渲染导致的无法中断的问题。Fiber将渲染任务拆分成多个小任务，并赋予优先级，使得高优先级任务可以打断低优先级任务，从而提升用户体验。同时，它也为异步渲染和错误边界等特性提供了基础。</p>
<p>Fiber架构主要包含两个阶段：可中断的协调阶段和不可中断的提交阶段。在协调阶段，React构建workInProgress树并收集副作用；在提交阶段，React将副作用应用到DOM上并执行相应的生命周期方法。</p>
<h1 id="React-Fiber-架构深度解析：原理、机制与实战优化"><a href="#React-Fiber-架构深度解析：原理、机制与实战优化" class="headerlink" title="React Fiber 架构深度解析：原理、机制与实战优化"></a>React Fiber 架构深度解析：原理、机制与实战优化</h1><p>React Fiber 是 React 16 引入的<strong>核心重写架构</strong>，彻底改变了 React 的渲染机制。它解决了大型应用中的性能瓶颈问题，并为异步渲染、优先级调度等高级特性奠定了基础。</p>
<h2 id="一、Fiber-诞生的背景与挑战"><a href="#一、Fiber-诞生的背景与挑战" class="headerlink" title="一、Fiber 诞生的背景与挑战"></a>一、Fiber 诞生的背景与挑战</h2><h3 id="传统-Stack-Reconciler-的问题"><a href="#传统-Stack-Reconciler-的问题" class="headerlink" title="传统 Stack Reconciler 的问题"></a>传统 Stack Reconciler 的问题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[setState] --&gt; B[开始渲染]</span><br><span class="line">    B --&gt; C[递归处理组件树]</span><br><span class="line">    C --&gt; D[深度优先遍历]</span><br><span class="line">    D --&gt; E[不可中断]</span><br><span class="line">    E --&gt; F[主线程阻塞]</span><br><span class="line">    F --&gt; G[动画卡顿/输入延迟]</span><br></pre></td></tr></table></figure>

<p>在 React 15 及之前版本中：</p>
<ul>
<li><strong>递归渲染</strong>：深度优先遍历整个组件树</li>
<li><strong>同步阻塞</strong>：无法中断渲染过程</li>
<li><strong>无优先级</strong>：所有更新任务平等处理</li>
<li><strong>性能瓶颈</strong>：大型应用渲染时间超过 16ms（60fps 标准）</li>
</ul>
<h3 id="浏览器渲染机制限制"><a href="#浏览器渲染机制限制" class="headerlink" title="浏览器渲染机制限制"></a>浏览器渲染机制限制</h3><pre><code>[  16ms 帧时间  ]
├── JavaScript 执行
├── 样式计算
├── 布局
├── 绘制
└── 空闲时间 ← Fiber 利用这里
</code></pre>
<h2 id="二、Fiber-架构核心原理"><a href="#二、Fiber-架构核心原理" class="headerlink" title="二、Fiber 架构核心原理"></a>二、Fiber 架构核心原理</h2><h3 id="1-Fiber-节点数据结构"><a href="#1-Fiber-节点数据结构" class="headerlink" title="1. Fiber 节点数据结构"></a>1. Fiber 节点数据结构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FiberNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  tag: WorkTag,</span></span><br><span class="line"><span class="params">  pendingProps: mixed,</span></span><br><span class="line"><span class="params">  key: <span class="literal">null</span> | string,</span></span><br><span class="line"><span class="params">  mode: TypeOfMode,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 实例标识</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">tag</span> = tag;          <span class="comment">// 组件类型（函数/类/Host等）</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">key</span> = key;          <span class="comment">// 唯一标识</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">elementType</span> = <span class="literal">null</span>; <span class="comment">// 元素类型</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="literal">null</span>;        <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">stateNode</span> = <span class="literal">null</span>;   <span class="comment">// 组件实例</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 树结构关系</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">return</span> = <span class="literal">null</span>;     <span class="comment">// 父节点</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">child</span> = <span class="literal">null</span>;      <span class="comment">// 首子节点</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sibling</span> = <span class="literal">null</span>;    <span class="comment">// 兄弟节点</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 状态与属性</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingProps</span> = pendingProps; <span class="comment">// 新 props</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedProps</span> = <span class="literal">null</span>;        <span class="comment">// 当前 props</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedState</span> = <span class="literal">null</span>;        <span class="comment">// 当前 state</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">updateQueue</span> = <span class="literal">null</span>;          <span class="comment">// 更新队列</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 副作用标记</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">flags</span> = <span class="title class_">NoFlags</span>;            <span class="comment">// 操作类型（增/删/改）</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subtreeFlags</span> = <span class="title class_">NoFlags</span>;     <span class="comment">// 子树副作用</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">deletions</span> = <span class="literal">null</span>;           <span class="comment">// 待删除节点</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调度优先级</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">lanes</span> = <span class="title class_">NoLanes</span>;            <span class="comment">// 任务优先级</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">childLanes</span> = <span class="title class_">NoLanes</span>;       <span class="comment">// 子树优先级</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 双缓存指针</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">alternate</span> = <span class="literal">null</span>;           <span class="comment">// 指向另一棵树节点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Fiber-树与双缓存机制"><a href="#2-Fiber-树与双缓存机制" class="headerlink" title="2. Fiber 树与双缓存机制"></a>2. Fiber 树与双缓存机制</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Current Tree] --&gt;|显示在屏幕| B[用户界面]</span><br><span class="line">    C[WorkInProgress Tree] --&gt;|构建中| D[内存]</span><br><span class="line">    </span><br><span class="line">    A --&gt;|alternate| C</span><br><span class="line">    C --&gt;|alternate| A</span><br><span class="line">    </span><br><span class="line">    E[提交阶段] --&gt;|切换指针| F[WorkInProgress 成为 Current]</span><br></pre></td></tr></table></figure>

<h3 id="3-渲染流程：可中断的异步渲染"><a href="#3-渲染流程：可中断的异步渲染" class="headerlink" title="3. 渲染流程：可中断的异步渲染"></a>3. 渲染流程：可中断的异步渲染</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    A[触发更新] --&gt; B&#123;调度开始&#125;</span><br><span class="line">    B --&gt; C[创建WorkInProgress树]</span><br><span class="line">    C --&gt; D[遍历Fiber节点]</span><br><span class="line">    D --&gt; E&#123;时间片用完？&#125;</span><br><span class="line">    E --&gt;|是| F[暂停并返回控制权]</span><br><span class="line">    E --&gt;|否| G[处理当前节点]</span><br><span class="line">    G --&gt; H[完成所有节点？]</span><br><span class="line">    H --&gt;|否| D</span><br><span class="line">    H --&gt;|是| I[提交更新]</span><br><span class="line">    I --&gt; J[切换Current指针]</span><br></pre></td></tr></table></figure>

<h2 id="三、Fiber-核心机制详解"><a href="#三、Fiber-核心机制详解" class="headerlink" title="三、Fiber 核心机制详解"></a>三、Fiber 核心机制详解</h2><h3 id="1-优先级调度（Lane-模型）"><a href="#1-优先级调度（Lane-模型）" class="headerlink" title="1. 优先级调度（Lane 模型）"></a>1. 优先级调度（Lane 模型）</h3><p>React 18 引入的 Lane 优先级系统：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">NoLanes</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000000</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SyncLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000001</span>; <span class="comment">// 最高优先级</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">InputContinuousLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000000100</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">DefaultLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000000000010000</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">TransitionLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0000000000000000000010000000000</span>; <span class="comment">// 18新增</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">IdleLane</span>: <span class="title class_">Lanes</span> = <span class="number">0b0100000000000000000000000000000</span>; <span class="comment">// 最低</span></span><br></pre></td></tr></table></figure>

<p><strong>调度策略</strong>：</p>
<ul>
<li>用户输入 &gt; 动画 &gt; 普通更新 &gt; 后台任务</li>
<li>高优先级任务可中断低优先级任务</li>
</ul>
<h3 id="2-渲染阶段分解"><a href="#2-渲染阶段分解" class="headerlink" title="2. 渲染阶段分解"></a>2. 渲染阶段分解</h3><h4 id="阶段1-Render-Phase（可中断）"><a href="#阶段1-Render-Phase（可中断）" class="headerlink" title="阶段1: Render Phase（可中断）"></a>阶段1: Render Phase（可中断）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">performUnitOfWork</span>(<span class="params">fiber</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 开始工作（beginWork）</span></span><br><span class="line">  <span class="keyword">const</span> next = <span class="title function_">beginWork</span>(fiber);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (next) &#123;</span><br><span class="line">    <span class="comment">// 存在子节点，继续处理</span></span><br><span class="line">    <span class="keyword">return</span> next; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. 完成工作（completeWork）</span></span><br><span class="line">  <span class="keyword">let</span> sibling = <span class="title function_">completeWork</span>(fiber);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (sibling) &#123;</span><br><span class="line">    <span class="comment">// 存在兄弟节点，处理兄弟</span></span><br><span class="line">    <span class="keyword">return</span> sibling;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. 回溯父节点</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">completeWork</span>(fiber.<span class="property">return</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="阶段2-Commit-Phase（不可中断）"><a href="#阶段2-Commit-Phase（不可中断）" class="headerlink" title="阶段2: Commit Phase（不可中断）"></a>阶段2: Commit Phase（不可中断）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">commitRoot</span>(<span class="params">root</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 副作用提交前</span></span><br><span class="line">  <span class="title function_">commitBeforeMutationEffects</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. DOM 变更</span></span><br><span class="line">  <span class="title function_">commitMutationEffects</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 3. 切换当前树</span></span><br><span class="line">  root.<span class="property">current</span> = finishedWork;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 4. 副作用提交后</span></span><br><span class="line">  <span class="title function_">commitLayoutEffects</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-副作用（Effects）处理"><a href="#3-副作用（Effects）处理" class="headerlink" title="3. 副作用（Effects）处理"></a>3. 副作用（Effects）处理</h3><p>React 将 DOM 操作抽象为副作用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 副作用链表结构</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">commitMutationEffects</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> effect = firstEffect;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> (effect !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = effect.<span class="property">nextEffect</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (effect.<span class="property">flags</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Placement</span>:</span><br><span class="line">        <span class="title function_">commitPlacement</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Update</span>:</span><br><span class="line">        <span class="title function_">commitUpdate</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">Deletion</span>:</span><br><span class="line">        <span class="title function_">commitDeletion</span>(effect);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ...其他副作用</span></span><br><span class="line">    &#125;</span><br><span class="line">    effect = next;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、Fiber-带来的革命性特性"><a href="#四、Fiber-带来的革命性特性" class="headerlink" title="四、Fiber 带来的革命性特性"></a>四、Fiber 带来的革命性特性</h2><h3 id="1-并发模式（Concurrent-Mode）"><a href="#1-并发模式（Concurrent-Mode）" class="headerlink" title="1. 并发模式（Concurrent Mode）"></a>1. 并发模式（Concurrent Mode）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用并发模式</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p><strong>并发特性</strong>：</p>
<ul>
<li><code>useTransition()</code>：非阻塞UI更新</li>
<li><code>useDeferredValue()</code>：延迟更新</li>
<li><code>&lt;Suspense&gt;</code>：数据加载处理</li>
</ul>
<h3 id="2-可中断渲染"><a href="#2-可中断渲染" class="headerlink" title="2. 可中断渲染"></a>2. 可中断渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟高开销渲染</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">HeavyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> items = [];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 传统React会阻塞主线程</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">    items.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span>Item &#123;i&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fiber下可被中断，保持UI响应</span></span><br></pre></td></tr></table></figure>

<h3 id="3-错误边界（Error-Boundaries）"><a href="#3-错误边界（Error-Boundaries）" class="headerlink" title="3. 错误边界（Error Boundaries）"></a>3. 错误边界（Error Boundaries）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, info</span>) &#123;</span><br><span class="line">    <span class="title function_">logError</span>(error, info);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span></span><br><span class="line">      ? <span class="language-xml"><span class="tag">&lt;<span class="name">FallbackUI</span> /&gt;</span></span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、Fiber-性能优化实战"><a href="#五、Fiber-性能优化实战" class="headerlink" title="五、Fiber 性能优化实战"></a>五、Fiber 性能优化实战</h2><h3 id="1-渲染性能分析"><a href="#1-渲染性能分析" class="headerlink" title="1. 渲染性能分析"></a>1. 渲染性能分析</h3><p>使用 React DevTools 分析组件渲染：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检测不必要的渲染</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="comment">// 使用React.memo优化</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ExpensiveChild</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">MyComponent</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-优先级控制示例"><a href="#2-优先级控制示例" class="headerlink" title="2. 优先级控制示例"></a>2. 优先级控制示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; startTransition, useDeferredValue &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> value = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="title function_">setQuery</span>(value);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 标记为非紧急更新</span></span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setResults</span>(<span class="title function_">fetchResults</span>(value));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;query&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Results</span> <span class="attr">query</span>=<span class="string">&#123;deferredQuery&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-虚拟化长列表"><a href="#3-虚拟化长列表" class="headerlink" title="3. 虚拟化长列表"></a>3. 虚拟化长列表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FixedSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; index, style &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span>Row &#123;index&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">FixedSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">height</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">width</span>=<span class="string">&#123;300&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">itemSize</span>=<span class="string">&#123;50&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">itemCount</span>=<span class="string">&#123;1000&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">FixedSizeList</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="六、Fiber-与传统架构对比"><a href="#六、Fiber-与传统架构对比" class="headerlink" title="六、Fiber 与传统架构对比"></a>六、Fiber 与传统架构对比</h2><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th>Stack Reconciler (React 15)</th>
<th>Fiber (React 16+)</th>
</tr>
</thead>
<tbody><tr>
<td>渲染机制</td>
<td>递归（不可中断）</td>
<td>链表遍历（可暂停&#x2F;恢复）</td>
</tr>
<tr>
<td>任务调度</td>
<td>同步</td>
<td>优先级异步调度</td>
</tr>
<tr>
<td>渲染阶段</td>
<td>单阶段（commit）</td>
<td>双阶段（render&#x2F;commit）</td>
</tr>
<tr>
<td>最大优势</td>
<td>实现简单</td>
<td>高性能、高响应性</td>
</tr>
<tr>
<td>支持特性</td>
<td>基础更新</td>
<td>并发渲染、Suspense</td>
</tr>
<tr>
<td>错误处理</td>
<td>整个应用崩溃</td>
<td>错误边界局部捕获</td>
</tr>
<tr>
<td>适用场景</td>
<td>简单应用</td>
<td>复杂企业级应用</td>
</tr>
</tbody></table>
<h2 id="七、Fiber-最佳实践指南"><a href="#七、Fiber-最佳实践指南" class="headerlink" title="七、Fiber 最佳实践指南"></a>七、Fiber 最佳实践指南</h2><ol>
<li><p><strong>组件设计原则</strong>：</p>
<ul>
<li>拆分大型组件</li>
<li>使用 <code>React.memo</code> 优化</li>
<li>避免内联函数&#x2F;对象</li>
</ul>
</li>
<li><p><strong>状态管理优化</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用useState惰性初始化</span></span><br><span class="line"><span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">computeExpensiveValue</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>并发模式迁移</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渐进式迁移策略</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBlockingRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键路径使用传统模式</span></span><br><span class="line"><span class="keyword">const</span> criticalRoot = <span class="title function_">createBlockingRoot</span>(container);</span><br><span class="line">criticalRoot.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">CriticalApp</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非关键路径使用并发模式</span></span><br><span class="line"><span class="keyword">const</span> concurrentRoot = <span class="title function_">createRoot</span>(nonCriticalContainer);</span><br><span class="line">concurrentRoot.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">NonCriticalApp</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Suspense 数据获取</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建资源包装器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> status = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">let</span> suspender = <span class="title function_">fetch</span>(<span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      status = <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">      result = data;</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="string">&#x27;pending&#x27;</span>) <span class="keyword">throw</span> suspender;</span><br><span class="line">      <span class="keyword">if</span> (status === <span class="string">&#x27;error&#x27;</span>) <span class="keyword">throw</span> result;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在组件中使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserProfile</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> user = userResource.<span class="title function_">read</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;user.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="八、Fiber-未来演进方向"><a href="#八、Fiber-未来演进方向" class="headerlink" title="八、Fiber 未来演进方向"></a>八、Fiber 未来演进方向</h2><ol>
<li><p><strong>离屏渲染（Offscreen Rendering）</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Offscreen</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MainContent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Offscreen</span> <span class="attr">mode</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ExpensiveSidebar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Offscreen</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>服务器组件（Server Components）</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端组件（不发送到客户端）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Note</span>(<span class="params">&#123; id &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> note = <span class="keyword">await</span> db.<span class="property">notes</span>.<span class="title function_">get</span>(id);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">NoteView</span> <span class="attr">note</span>=<span class="string">&#123;note&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>响应式 Hooks</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; use &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Weather</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">use</span>(<span class="title function_">fetchWeather</span>());</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.temperature&#125;°C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/06/01/frontend/react/006-React%20Fiber%E8%AF%A6%E8%A7%A3/" data-id="cmcae1sk6007lsssd5xnjfr7w" data-title="006-React Fiber详解" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/06/07/devops/001-Docker%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          001-Docker基础复习
        
      </div>
    </a>
  
  
    <a href="/2025/06/01/frontend/react/005-React%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">005-React性能优化</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CNBC/">CNBC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Openshift/">Openshift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/kubernetes/">kubernetes</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/">Foundation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/OS/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/ProtocolAndBrowser/">ProtocolAndBrowser</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/Sass/">Sass</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/">ML_LLM_AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/Pytorch/">Pytorch</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Principles/">Principles</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/">algorithms</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/leetcode/">leetcode</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNBC-Finance/" rel="tag">CNBC Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Principles/" rel="tag">Principles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProtocolAndBrowser/" rel="tag">ProtocolAndBrowser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sass/" rel="tag">Sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CNBC-Finance/" style="font-size: 10px;">CNBC Finance</a> <a href="/tags/CSS/" style="font-size: 18.89px;">CSS</a> <a href="/tags/DB/" style="font-size: 11.11px;">DB</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Javascript/" style="font-size: 17.78px;">Javascript</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/OS/" style="font-size: 11.11px;">OS</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Principles/" style="font-size: 10px;">Principles</a> <a href="/tags/ProtocolAndBrowser/" style="font-size: 16.67px;">ProtocolAndBrowser</a> <a href="/tags/Pytorch/" style="font-size: 13.33px;">Pytorch</a> <a href="/tags/React/" style="font-size: 14.44px;">React</a> <a href="/tags/Sass/" style="font-size: 12.22px;">Sass</a> <a href="/tags/algorithms/" style="font-size: 20px;">algorithms</a> <a href="/tags/k8s/" style="font-size: 15.56px;">k8s</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.9%20Kube%20Pods/">1.9 Kube Pods</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.8%20Kube%20Proxy/">1.8 Kube Proxy</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.7%20Kubelet/">1.7 Kubelet</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.6%20Kube%20Scheduler/">1.6 Kube Scheduler</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.5%20Kube%20Controller%20Manager/">1.5 Kube Controller Manager</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 EvelynUU<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>