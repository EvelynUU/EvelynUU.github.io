<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>005-输入URL到页面加载完成流程 | ✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="从输入URL到页面加载完成的超详细解析整体流程概览 URL解析 DNS查询 TCP连接建立（三次握手） HTTPS协商（TLS握手） HTTP请求与响应 浏览器解析渲染 TCP连接关闭（四次挥手）  一、URL解析与处理（深度扩展）1.1 URL结构分解一个完整的URL包含以下部分： https:&#x2F;&#x2F;www.example.com:443&#x2F;path&#x2F;to&#x2F;page?query&#x3D;string#fra">
<meta property="og:type" content="article">
<meta property="og:title" content="005-输入URL到页面加载完成流程">
<meta property="og:url" content="http://example.com/2025/05/20/foundation/protocol_browser/005-%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E7%9A%84%E8%B6%85%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨">
<meta property="og:description" content="从输入URL到页面加载完成的超详细解析整体流程概览 URL解析 DNS查询 TCP连接建立（三次握手） HTTPS协商（TLS握手） HTTP请求与响应 浏览器解析渲染 TCP连接关闭（四次挥手）  一、URL解析与处理（深度扩展）1.1 URL结构分解一个完整的URL包含以下部分： https:&#x2F;&#x2F;www.example.com:443&#x2F;path&#x2F;to&#x2F;page?query&#x3D;string#fra">
<meta property="og:locale">
<meta property="article:published_time" content="2025-05-20T05:51:30.000Z">
<meta property="article:modified_time" content="2025-06-24T10:48:30.875Z">
<meta property="article:author" content="EvelynUU">
<meta property="article:tag" content="ProtocolAndBrowser">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Repeatings, Thoughts, and Writings</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-foundation/protocol_browser/005-输入URL到页面加载完成的超详细解析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/foundation/protocol_browser/005-%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E7%9A%84%E8%B6%85%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T05:51:30.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Foundation/">Foundation</a>►<a class="article-category-link" href="/categories/Foundation/ProtocolAndBrowser/">ProtocolAndBrowser</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      005-输入URL到页面加载完成流程
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="从输入URL到页面加载完成的超详细解析"><a href="#从输入URL到页面加载完成的超详细解析" class="headerlink" title="从输入URL到页面加载完成的超详细解析"></a>从输入URL到页面加载完成的超详细解析</h1><h2 id="整体流程概览"><a href="#整体流程概览" class="headerlink" title="整体流程概览"></a>整体流程概览</h2><ul>
<li>URL解析</li>
<li>DNS查询</li>
<li>TCP连接建立（三次握手）</li>
<li>HTTPS协商（TLS握手）</li>
<li>HTTP请求与响应</li>
<li>浏览器解析渲染</li>
<li>TCP连接关闭（四次挥手）</li>
</ul>
<h2 id="一、URL解析与处理（深度扩展）"><a href="#一、URL解析与处理（深度扩展）" class="headerlink" title="一、URL解析与处理（深度扩展）"></a>一、URL解析与处理（深度扩展）</h2><h3 id="1-1-URL结构分解"><a href="#1-1-URL结构分解" class="headerlink" title="1.1 URL结构分解"></a>1.1 URL结构分解</h3><p>一个完整的URL包含以下部分：</p>
<pre><code>https://www.example.com:443/path/to/page?query=string#fragment
</code></pre>
<ul>
<li><strong>协议方案</strong>：<code>https</code>（还有http、ftp、ws等）</li>
<li><strong>主机名</strong>：<code>www.example.com</code>（可能包含子域名）</li>
<li><strong>端口号</strong>：<code>:443</code>（HTTPS默认端口，HTTP默认80）</li>
<li><strong>路径</strong>：<code>/path/to/page</code>（服务器资源路径）</li>
<li><strong>查询字符串</strong>：<code>?query=string</code>（键值对参数）</li>
<li><strong>片段标识符</strong>：<code>#fragment</code>（页面内锚点）</li>
</ul>
<h3 id="1-2-URL编码机制"><a href="#1-2-URL编码机制" class="headerlink" title="1.2 URL编码机制"></a>1.2 URL编码机制</h3><p><strong>为什么需要编码</strong>：</p>
<ul>
<li>保留字符：<code>! * &#39; ( ) ; : @ &amp; = + $ , / ? % # [ ]</code></li>
<li>非ASCII字符：中文等Unicode字符</li>
<li>空格：需要转为<code>+</code>或<code>%20</code></li>
</ul>
<p><strong>编码过程示例</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">encodeURIComponent</span>(<span class="string">&quot;搜索 前端&quot;</span>) <span class="comment">// &quot;搜索%20前端&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-HSTS深入"><a href="#1-3-HSTS深入" class="headerlink" title="1.3 HSTS深入"></a>1.3 HSTS深入</h3><p><strong>工作原理</strong>：</p>
<ol>
<li>首次访问时通过HTTP头<code>Strict-Transport-Security: max-age=31536000</code>告知浏览器</li>
<li>浏览器将该域名加入HSTS列表</li>
<li>后续访问自动转为HTTPS（即使输入http:&#x2F;&#x2F;）</li>
</ol>
<p><strong>安全意义</strong>：</p>
<ul>
<li>防止SSL剥离攻击（中间人强制降级为HTTP）</li>
<li>避免301重定向的首次攻击窗口</li>
</ul>
<h2 id="二、DNS解析全流程（深度扩展）"><a href="#二、DNS解析全流程（深度扩展）" class="headerlink" title="二、DNS解析全流程（深度扩展）"></a>二、DNS解析全流程（深度扩展）</h2><h3 id="2-1-完整查询顺序"><a href="#2-1-完整查询顺序" class="headerlink" title="2.1 完整查询顺序"></a>2.1 完整查询顺序</h3><ol>
<li><strong>浏览器缓存</strong>：检查最近访问记录</li>
<li><strong>系统缓存</strong>：<ul>
<li>Windows：<code>ipconfig /displaydns</code></li>
<li>macOS&#x2F;Linux：<code>sudo killall -HUP mDNSResponder</code></li>
</ul>
</li>
<li><strong>hosts文件</strong>：<ul>
<li>Windows：<code>C:\Windows\System32\drivers\etc\hosts</code></li>
<li>Unix：<code>/etc/hosts</code></li>
</ul>
</li>
<li><strong>路由器缓存</strong>：家庭路由器的DNS缓存</li>
<li><strong>ISP DNS缓存</strong>：互联网服务提供商的递归DNS服务器</li>
<li><strong>递归查询</strong>：<ul>
<li>根域名服务器（全球13组）</li>
<li>顶级域服务器（.com&#x2F;.org等）</li>
<li>权威域名服务器（域名注册商提供）</li>
</ul>
</li>
</ol>
<h3 id="2-2-DNS记录类型详解"><a href="#2-2-DNS记录类型详解" class="headerlink" title="2.2 DNS记录类型详解"></a>2.2 DNS记录类型详解</h3><table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>IPv4地址</td>
<td>example.com → 192.0.2.1</td>
</tr>
<tr>
<td>AAAA</td>
<td>IPv6地址</td>
<td>example.com → 2001:db8::1</td>
</tr>
<tr>
<td>CNAME</td>
<td>别名</td>
<td><a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> → example.com</td>
</tr>
<tr>
<td>MX</td>
<td>邮件交换</td>
<td>example.com → mail.example.com</td>
</tr>
<tr>
<td>TXT</td>
<td>文本记录</td>
<td>用于验证、SPF等</td>
</tr>
<tr>
<td>NS</td>
<td>域名服务器</td>
<td>example.com → ns1.example.com</td>
</tr>
<tr>
<td>SOA</td>
<td>起始授权</td>
<td>域管理信息</td>
</tr>
</tbody></table>
<h3 id="2-3-DNS安全问题"><a href="#2-3-DNS安全问题" class="headerlink" title="2.3 DNS安全问题"></a>2.3 DNS安全问题</h3><p><strong>常见攻击</strong>：</p>
<ul>
<li><strong>DNS劫持</strong>：篡改解析结果</li>
<li><strong>DNS污染</strong>：伪造响应包</li>
<li><strong>DNS放大攻击</strong>：利用递归查询进行DDoS</li>
</ul>
<p><strong>防御方案</strong>：</p>
<ul>
<li><strong>DNSSEC</strong>：通过数字签名验证响应真实性</li>
<li><strong>DNS-over-HTTPS</strong>：加密DNS查询（如Cloudflare 1.1.1.1）</li>
<li><strong>EDNS Client Subnet</strong>：精准CDN调度同时保护隐私</li>
</ul>
<h2 id="三、TCP连接建立（三次握手深度解析）"><a href="#三、TCP连接建立（三次握手深度解析）" class="headerlink" title="三、TCP连接建立（三次握手深度解析）"></a>三、TCP连接建立（三次握手深度解析）</h2><h3 id="3-1-握手报文细节"><a href="#3-1-握手报文细节" class="headerlink" title="3.1 握手报文细节"></a>3.1 握手报文细节</h3><p><strong>第一次握手（SYN）</strong>：</p>
<pre><code>Flags: SYN=1, ACK=0
Sequence Number: 随机初始序列号(ISN)
Window Size: 接收窗口大小
MSS: 最大报文段长度（通常1460字节）
</code></pre>
<p><strong>第二次握手（SYN-ACK）</strong>：</p>
<pre><code>Flags: SYN=1, ACK=1
Sequence Number: 服务器ISN
Acknowledgment Number: 客户端ISN+1
Window Size: 服务器接收窗口
MSS: 服务器MSS
</code></pre>
<p><strong>第三次握手（ACK）</strong>：</p>
<pre><code>Flags: ACK=1
Sequence Number: 客户端ISN+1
Acknowledgment Number: 服务器ISN+1
</code></pre>
<h3 id="3-2-为什么不能是两次握手？"><a href="#3-2-为什么不能是两次握手？" class="headerlink" title="3.2 为什么不能是两次握手？"></a>3.2 为什么不能是两次握手？</h3><p><strong>根本原因</strong>：信道不可靠与历史连接问题</p>
<p><strong>具体场景分析</strong>：</p>
<ol>
<li><p><strong>重复SYN包</strong>：</p>
<ul>
<li>客户端发送SYN1（网络延迟）</li>
<li>超时重发SYN2（成功建立连接后关闭）</li>
<li>SYN1到达服务器，如果是两次握手会直接建立无效连接</li>
</ul>
</li>
<li><p><strong>双向信道验证</strong>：</p>
<ul>
<li>第三次握手确保客户端能收到服务端的响应</li>
<li>避免服务端单方面建立连接浪费资源</li>
</ul>
</li>
</ol>
<h3 id="3-3-SYN-Flood攻击与防御"><a href="#3-3-SYN-Flood攻击与防御" class="headerlink" title="3.3 SYN Flood攻击与防御"></a>3.3 SYN Flood攻击与防御</h3><p><strong>攻击原理</strong>：</p>
<ul>
<li>伪造大量SYN包但不完成握手</li>
<li>占满服务器的半连接队列（backlog）</li>
</ul>
<p><strong>防御方案</strong>：</p>
<ol>
<li><p><strong>SYN Cookie</strong>：</p>
<ul>
<li>不存储连接状态</li>
<li>通过加密算法生成序列号</li>
<li>收到ACK时验证合法性</li>
</ul>
</li>
<li><p><strong>其他措施</strong>：</p>
<ul>
<li>增加backlog队列大小</li>
<li>减少SYN-RECEIVED状态超时时间</li>
<li>防火墙限速</li>
</ul>
</li>
</ol>
<h2 id="四、TLS握手过程（HTTPS安全基础）"><a href="#四、TLS握手过程（HTTPS安全基础）" class="headerlink" title="四、TLS握手过程（HTTPS安全基础）"></a>四、TLS握手过程（HTTPS安全基础）</h2><h3 id="4-1-TLS-1-2完整握手"><a href="#4-1-TLS-1-2完整握手" class="headerlink" title="4.1 TLS 1.2完整握手"></a>4.1 TLS 1.2完整握手</h3><p><strong>步骤详解</strong>：</p>
<ol>
<li><p><strong>Client Hello</strong>：</p>
<ul>
<li>随机数（Client Random）</li>
<li>支持的加密套件（如TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256）</li>
<li>支持的TLS版本</li>
<li>SNI（Server Name Indication）</li>
</ul>
</li>
<li><p><strong>Server Hello</strong>：</p>
<ul>
<li>选择加密套件</li>
<li>服务器随机数（Server Random）</li>
<li>数字证书（包含公钥）</li>
</ul>
</li>
<li><p><strong>证书验证</strong>：</p>
<ul>
<li>验证证书链有效性</li>
<li>检查吊销状态（OCSP&#x2F;CRL）</li>
<li>验证域名匹配</li>
</ul>
</li>
<li><p><strong>密钥交换</strong>：</p>
<ul>
<li>客户端生成预主密钥（Premaster Secret）</li>
<li>用服务器公钥加密传输</li>
</ul>
</li>
<li><p><strong>会话密钥生成</strong>：<br>master_secret &#x3D; PRF(pre_master_secret, “master secret”, ClientHello.random + ServerHello.random)</p>
</li>
</ol>
<h3 id="4-2-TLS-1-3重大改进"><a href="#4-2-TLS-1-3重大改进" class="headerlink" title="4.2 TLS 1.3重大改进"></a>4.2 TLS 1.3重大改进</h3><p><strong>优化点</strong>：</p>
<ol>
<li><p><strong>1-RTT握手</strong>：</p>
<ul>
<li>客户端在第一个消息中就猜测密钥交换算法</li>
<li>服务端直接返回共享密钥</li>
</ul>
</li>
<li><p><strong>0-RTT模式</strong>：</p>
<ul>
<li>对近期连接过的服务器可立即发送加密数据</li>
<li>存在重放攻击风险（需业务层防护）</li>
</ul>
</li>
<li><p><strong>算法精简</strong>：</p>
<ul>
<li>移除RSA密钥交换</li>
<li>禁止静态DH</li>
<li>仅保留AEAD加密模式（如AES-GCM）</li>
</ul>
</li>
</ol>
<h3 id="4-3-证书体系详解"><a href="#4-3-证书体系详解" class="headerlink" title="4.3 证书体系详解"></a>4.3 证书体系详解</h3><p><strong>证书链验证</strong>：</p>
<pre><code>用户证书 → 中间CA证书 → 根CA证书
</code></pre>
<ul>
<li>根CA证书内置在操作系统&#x2F;浏览器</li>
<li>验证时需检查签名和时间有效性</li>
</ul>
<p><strong>证书类型</strong>：</p>
<ul>
<li>DV（域名验证）：基本验证</li>
<li>OV（组织验证）：验证企业真实性</li>
<li>EV（扩展验证）：绿色地址栏（逐渐淘汰）</li>
</ul>
<h2 id="五、HTTP-2核心特性（对比HTTP-1-1）"><a href="#五、HTTP-2核心特性（对比HTTP-1-1）" class="headerlink" title="五、HTTP&#x2F;2核心特性（对比HTTP&#x2F;1.1）"></a>五、HTTP&#x2F;2核心特性（对比HTTP&#x2F;1.1）</h2><h3 id="5-1-二进制分帧层"><a href="#5-1-二进制分帧层" class="headerlink" title="5.1 二进制分帧层"></a>5.1 二进制分帧层</h3><p><strong>帧结构</strong>：</p>
<pre><code>+-----------------------------------------------+
| Length (24) | Type (8) | Flags (8) | R (1) | Stream ID (31) |
+-----------------------------------------------+
|                   Frame Payload                           |
+----------------------------------------------------------+
</code></pre>
<p><strong>帧类型</strong>：</p>
<ul>
<li>HEADERS：包含HTTP头部</li>
<li>DATA：包含请求&#x2F;响应体</li>
<li>PRIORITY：设置流优先级</li>
<li>RST_STREAM：终止流</li>
<li>SETTINGS：连接参数配置</li>
</ul>
<h3 id="5-2-多路复用实现原理"><a href="#5-2-多路复用实现原理" class="headerlink" title="5.2 多路复用实现原理"></a>5.2 多路复用实现原理</h3><p><strong>流(Stream)特性</strong>：</p>
<ul>
<li>每个流有唯一ID</li>
<li>流可以设置优先级</li>
<li>流之间完全独立</li>
</ul>
<p><strong>对比HTTP&#x2F;1.1</strong>：</p>
<ul>
<li>HTTP&#x2F;1.1的管道化(pipelining)问题：<ul>
<li>响应必须按请求顺序返回</li>
<li>一个阻塞会影响后续所有请求</li>
</ul>
</li>
<li>HTTP&#x2F;2彻底解决队头阻塞（应用层）</li>
</ul>
<h3 id="5-3-服务器推送争议"><a href="#5-3-服务器推送争议" class="headerlink" title="5.3 服务器推送争议"></a>5.3 服务器推送争议</h3><p><strong>合理使用场景</strong>：</p>
<ul>
<li>关键CSS&#x2F;JS文件</li>
<li>首屏必需的静态资源</li>
</ul>
<p><strong>潜在问题</strong>：</p>
<ol>
<li>推送过多资源浪费带宽</li>
<li>浏览器缓存可能导致重复推送</li>
<li>需要精细控制（通过<code>&lt;link rel=&quot;preload&quot;&gt;</code>提示）</li>
</ol>
<h2 id="六、浏览器渲染引擎工作原理"><a href="#六、浏览器渲染引擎工作原理" class="headerlink" title="六、浏览器渲染引擎工作原理"></a>六、浏览器渲染引擎工作原理</h2><h3 id="6-1-关键线程协作模型"><a href="#6-1-关键线程协作模型" class="headerlink" title="6.1 关键线程协作模型"></a>6.1 关键线程协作模型</h3><pre><code>+---------------------------------------------------+
|                   Browser Process                 |
+---------------------------------------------------+
|  Network Thread  |   UI Thread   |  Storage Thread |
+---------------------------------------------------+
            ↑
            | IPC
            ↓
+---------------------------------------------------+
|                  Renderer Process                 |
+---------------------------------------------------+
|  Main Thread  |  Compositor Thread | Raster Thread |
|  (JS/DOM/CSS) |                    |               |
+---------------------------------------------------+
</code></pre>
<p><strong>线程职责</strong>：</p>
<ol>
<li><p><strong>主线程</strong>：</p>
<ul>
<li>解析HTML构建DOM</li>
<li>计算样式和布局</li>
<li>执行JavaScript（V8引擎）</li>
</ul>
</li>
<li><p><strong>合成线程</strong>：</p>
<ul>
<li>分层(Layer)管理</li>
<li>滚动等动画优化</li>
<li>调用GPU加速</li>
</ul>
</li>
<li><p><strong>光栅线程</strong>：</p>
<ul>
<li>将图层分块(Tile)</li>
<li>使用GPU加速光栅化</li>
</ul>
</li>
</ol>
<h3 id="6-2-渲染流水线详细阶段"><a href="#6-2-渲染流水线详细阶段" class="headerlink" title="6.2 渲染流水线详细阶段"></a>6.2 渲染流水线详细阶段</h3><ol>
<li><p><strong>解析HTML</strong>：</p>
<ul>
<li>字节 → 字符 → 令牌 → 节点 → DOM树</li>
<li>遇到<code>&lt;script&gt;</code>会阻塞（除非async&#x2F;defer）</li>
</ul>
</li>
<li><p><strong>样式计算</strong>：</p>
<ul>
<li>解析CSS生成CSSOM</li>
<li>继承：<code>font-size</code>等可继承属性</li>
<li>层叠：处理选择器优先级</li>
</ul>
</li>
<li><p><strong>布局阶段</strong>：</p>
<ul>
<li>生成布局树（排除<code>display:none</code>节点）</li>
<li>计算精确几何位置（重排阶段）</li>
</ul>
</li>
<li><p><strong>分层与绘制</strong>：</p>
<ul>
<li>根据will-change、z-index等创建图层</li>
<li>生成绘制指令列表（类似Canvas绘图命令）</li>
</ul>
</li>
<li><p><strong>合成与显示</strong>：</p>
<ul>
<li>合成线程处理视觉滚动等</li>
<li>GPU加速的纹理合成</li>
<li>最终提交给显示系统</li>
</ul>
</li>
</ol>
<h3 id="6-3-性能优化关键点"><a href="#6-3-性能优化关键点" class="headerlink" title="6.3 性能优化关键点"></a>6.3 性能优化关键点</h3><p><strong>避免强制同步布局</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示例（读取offsetWidth导致强制布局）</span></span><br><span class="line"><span class="keyword">const</span> width = element.<span class="property">offsetWidth</span>;</span><br><span class="line">element.<span class="property">style</span>.<span class="property">width</span> = width + <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确做法（使用requestAnimationFrame）</span></span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> width = element.<span class="property">offsetWidth</span>;</span><br><span class="line">  element.<span class="property">style</span>.<span class="property">width</span> = width + <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>优化建议</strong>：</p>
<ol>
<li>使用CSS动画替代JS动画</li>
<li>避免频繁操作DOM（使用文档片段）</li>
<li>使用<code>content-visibility: auto</code>跳过屏外渲染</li>
<li>合理使用will-change提示浏览器</li>
</ol>
<h2 id="七、TCP连接关闭（四次挥手深度解析）"><a href="#七、TCP连接关闭（四次挥手深度解析）" class="headerlink" title="七、TCP连接关闭（四次挥手深度解析）"></a>七、TCP连接关闭（四次挥手深度解析）</h2><h3 id="7-1-挥手状态机"><a href="#7-1-挥手状态机" class="headerlink" title="7.1 挥手状态机"></a>7.1 挥手状态机</h3><pre><code>+---------+       FIN         +----------+
| CLOSED  | &lt;--------------- | FIN_WAIT1|
+---------+                  +----------+
                              |   ^
                              ACK |
                              v   |
+---------+       FIN         +----------+
| CLOSING | &lt;--------------- | FIN_WAIT2|
+---------+                  +----------+
  |   ^                       |   ^
  |   |                       |   |
  |   +-------- FIN ----------+   |
  |                               |
  +------------ ACK -------------+
</code></pre>
<h3 id="7-2-TIME-WAIT关键问题"><a href="#7-2-TIME-WAIT关键问题" class="headerlink" title="7.2 TIME_WAIT关键问题"></a>7.2 TIME_WAIT关键问题</h3><p><strong>为什么需要2MSL（最大报文生存时间）</strong>：</p>
<ol>
<li><p>确保最后一个ACK到达对端</p>
<ul>
<li>如果丢失，服务端会重发FIN</li>
<li>客户端需要保持在可响应状态</li>
</ul>
</li>
<li><p>让网络中残留报文失效</p>
<ul>
<li>避免相同四元组的新连接收到旧报文</li>
</ul>
</li>
</ol>
<p><strong>MSL典型值</strong>：</p>
<ul>
<li>Linux：60秒</li>
<li>Windows：2分钟</li>
<li>因此TIME_WAIT通常为2-4分钟</li>
</ul>
<h3 id="7-3-连接重置场景"><a href="#7-3-连接重置场景" class="headerlink" title="7.3 连接重置场景"></a>7.3 连接重置场景</h3><p><strong>RST包触发条件</strong>：</p>
<ol>
<li>访问未监听的端口</li>
<li>异常终止连接</li>
<li>半开连接检测（对方已崩溃）</li>
</ol>
<p><strong>与FIN的区别</strong>：</p>
<ul>
<li>FIN是优雅关闭，会等待数据发送完毕</li>
<li>RST是强制终止，立即释放资源</li>
</ul>
<h2 id="八、深入问答准备"><a href="#八、深入问答准备" class="headerlink" title="八、深入问答准备"></a>八、深入问答准备</h2><h3 id="8-1-为什么JavaScript是单线程？"><a href="#8-1-为什么JavaScript是单线程？" class="headerlink" title="8.1 为什么JavaScript是单线程？"></a>8.1 为什么JavaScript是单线程？</h3><p><strong>历史原因</strong>：</p>
<ul>
<li>最初设计用于简单的表单验证</li>
<li>避免多线程操作DOM的同步问题</li>
</ul>
<p><strong>实现优势</strong>：</p>
<ol>
<li><strong>简化内存模型</strong>：无锁机制、无竞态条件</li>
<li><strong>确定性执行顺序</strong>：事件循环保证执行顺序可预测</li>
<li><strong>与渲染引擎协作</strong>：避免JS执行与页面渲染冲突</li>
</ol>
<p><strong>现代补充方案</strong>：</p>
<ul>
<li>Web Worker：后台计算线程</li>
<li>SharedArrayBuffer：共享内存</li>
<li>Atomics API：原子操作</li>
</ul>
<h3 id="8-2-浏览器多进程架构优势"><a href="#8-2-浏览器多进程架构优势" class="headerlink" title="8.2 浏览器多进程架构优势"></a>8.2 浏览器多进程架构优势</h3><p><strong>安全隔离</strong>：</p>
<ul>
<li>沙箱化渲染进程（无法直接访问系统资源）</li>
<li>插件进程隔离（Flash等容易崩溃的组件）</li>
</ul>
<p><strong>性能提升</strong>：</p>
<ul>
<li>利用多核CPU并行处理</li>
<li>单个标签页崩溃不影响整体</li>
</ul>
<p><strong>资源控制</strong>：</p>
<ul>
<li>每个进程独立内存空间</li>
<li>可以单独限制资源用量（如GPU内存）</li>
</ul>
<h3 id="8-3-进程-vs-线程对比表"><a href="#8-3-进程-vs-线程对比表" class="headerlink" title="8.3 进程 vs 线程对比表"></a>8.3 进程 vs 线程对比表</h3><table>
<thead>
<tr>
<th>特性</th>
<th>进程</th>
<th>线程</th>
</tr>
</thead>
<tbody><tr>
<td>创建开销</td>
<td>大（需要分配独立资源）</td>
<td>小（共享进程资源）</td>
</tr>
<tr>
<td>通信方式</td>
<td>IPC（管道、共享内存等）</td>
<td>直接读写共享内存</td>
</tr>
<tr>
<td>上下文切换成本</td>
<td>高（需切换地址空间）</td>
<td>低（仅切换执行上下文）</td>
</tr>
<tr>
<td>容错性</td>
<td>一个崩溃不影响其他进程</td>
<td>一个崩溃导致进程终止</td>
</tr>
<tr>
<td>资源共享</td>
<td>需要通过显式机制共享</td>
<td>自动共享所有进程资源</td>
</tr>
<tr>
<td>多核利用</td>
<td>天然支持</td>
<td>需要显式并行编程</td>
</tr>
</tbody></table>
<h3 id="8-4-现代浏览器进程模型示例"><a href="#8-4-现代浏览器进程模型示例" class="headerlink" title="8.4 现代浏览器进程模型示例"></a>8.4 现代浏览器进程模型示例</h3><p><strong>Chrome多进程架构</strong>：</p>
<pre><code>Browser Process (1个)
   ├── GPU Process (1个)
   ├── Network Service (1个)
   ├── Storage Service (1个)
   └── Renderer Processes (多个，每个标签页/iframe)
       ├── Main Thread
       ├── Worker Threads
       └── Compositor Thread
</code></pre>
<p><strong>内存节省技术</strong>：</p>
<ul>
<li>Site Isolation：同站点标签页共享进程</li>
<li>Process Pooling：进程复用池</li>
</ul>
<h2 id="九、前沿技术演进"><a href="#九、前沿技术演进" class="headerlink" title="九、前沿技术演进"></a>九、前沿技术演进</h2><h3 id="9-1-HTTP-3与QUIC协议"><a href="#9-1-HTTP-3与QUIC协议" class="headerlink" title="9.1 HTTP&#x2F;3与QUIC协议"></a>9.1 HTTP&#x2F;3与QUIC协议</h3><p><strong>核心改进</strong>：</p>
<ol>
<li><strong>基于UDP</strong>：避免TCP队头阻塞</li>
<li><strong>0-RTT连接</strong>：快速恢复会话</li>
<li><strong>连接迁移</strong>：网络切换无感知</li>
</ol>
<p><strong>企业采用现状</strong>：</p>
<ul>
<li>Google：YouTube等主要服务已部署</li>
<li>Cloudflare：全球边缘网络支持</li>
<li>苹果：iOS 15+支持QUIC</li>
</ul>
<h3 id="9-2-WebAssembly高性能场景"><a href="#9-2-WebAssembly高性能场景" class="headerlink" title="9.2 WebAssembly高性能场景"></a>9.2 WebAssembly高性能场景</h3><p><strong>适用领域</strong>：</p>
<ol>
<li>视频&#x2F;图像处理（FFmpeg.wasm）</li>
<li>3D游戏&#x2F;图形计算（Unity WebGL）</li>
<li>密码学运算（区块链应用）</li>
<li>科学计算（TensorFlow.js后端）</li>
</ol>
<p><strong>性能对比</strong>：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>JavaScript</th>
<th>WebAssembly</th>
</tr>
</thead>
<tbody><tr>
<td>矩阵运算(1M)</td>
<td>120ms</td>
<td>15ms</td>
</tr>
<tr>
<td>SHA-256哈希</td>
<td>80ms</td>
<td>6ms</td>
</tr>
</tbody></table>
<h3 id="9-3-新的性能指标体系"><a href="#9-3-新的性能指标体系" class="headerlink" title="9.3 新的性能指标体系"></a>9.3 新的性能指标体系</h3><p><strong>Web Vitals</strong>：</p>
<ol>
<li><strong>LCP</strong> (Largest Contentful Paint)：最大内容渲染时间（&lt;2.5s）</li>
<li><strong>FID</strong> (First Input Delay)：首次输入延迟（&lt;100ms）</li>
<li><strong>CLS</strong> (Cumulative Layout Shift)：累计布局偏移（&lt;0.1）</li>
</ol>
<p><strong>测量工具</strong>：</p>
<ul>
<li>Chrome DevTools的Lighthouse</li>
<li>web-vitals.js库</li>
<li>Search Console报告</li>
</ul>
<h2 id="十、实战调试技巧"><a href="#十、实战调试技巧" class="headerlink" title="十、实战调试技巧"></a>十、实战调试技巧</h2><h3 id="10-1-网络分析工具链"><a href="#10-1-网络分析工具链" class="headerlink" title="10.1 网络分析工具链"></a>10.1 网络分析工具链</h3><ol>
<li><strong>Wireshark</strong>：抓取TCP&#x2F;UDP原始包<ul>
<li>过滤器：<code>tcp.port == 443 &amp;&amp; http2</code></li>
</ul>
</li>
<li><strong>Chrome DevTools</strong>：<ul>
<li>Network面板查看HTTP&#x2F;2流</li>
<li>Performance面板分析渲染流水线</li>
</ul>
</li>
<li><strong>curl命令</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v --http2 https://example.com</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="10-2-关键性能优化检查点"><a href="#10-2-关键性能优化检查点" class="headerlink" title="10.2 关键性能优化检查点"></a>10.2 关键性能优化检查点</h3><ol>
<li><strong>资源加载</strong>：<ul>
<li>关键路径CSS内联</li>
<li>非关键JS异步加载</li>
</ul>
</li>
<li><strong>渲染优化</strong>：<ul>
<li>避免布局抖动</li>
<li>使用<code>content-visibility</code></li>
</ul>
</li>
<li><strong>内存管理</strong>：<ul>
<li>检测DOM节点泄漏</li>
<li>Worker中处理大数据集</li>
</ul>
</li>
</ol>
<h3 id="10-3-真实案例分析"><a href="#10-3-真实案例分析" class="headerlink" title="10.3 真实案例分析"></a>10.3 真实案例分析</h3><p><strong>案例：电商网站首屏优化</strong></p>
<ol>
<li><strong>问题</strong>：LCP时间&gt;4s</li>
<li><strong>诊断</strong>：<ul>
<li>关键图片未预加载</li>
<li>同步第三方脚本阻塞渲染</li>
</ul>
</li>
<li><strong>解决方案</strong>：<ul>
<li>使用<code>&lt;link rel=preload&gt;</code>提前加载英雄图</li>
<li>将分析脚本改为<code>async</code></li>
<li>实施服务端渲染(SSR)</li>
</ul>
</li>
<li><strong>结果</strong>：LCP降至1.8s</li>
</ol>
<p>通过这种深度技术解析和实际案例结合的方式，不仅能应对技术面试，更能建立完整的Web性能优化知识体系。建议在理解原理的基础上，多使用开发者工具进行实践验证。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/foundation/protocol_browser/005-%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%88%90%E7%9A%84%E8%B6%85%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90/" data-id="cmcaettlx004ew8sdceig3x9w" data-title="005-输入URL到页面加载完成流程" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ProtocolAndBrowser/" rel="tag">ProtocolAndBrowser</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/05/20/foundation/protocol_browser/007-HTTPS%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E5%8F%8A%E5%90%84%E7%B1%BB%E6%94%BB%E5%87%BB%E5%8F%8A%E9%98%B2%E8%8C%83/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          007-HTTPS加密原理及各类攻击及防范
        
      </div>
    </a>
  
  
    <a href="/2025/05/20/foundation/protocol_browser/004-HTTP2%E4%B8%8EHTTP3%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">004-HTTP2与HTTP3</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CNBC/">CNBC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Openshift/">Openshift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/kubernetes/">kubernetes</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/">Foundation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/OS/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/ProtocolAndBrowser/">ProtocolAndBrowser</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/Sass/">Sass</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/">ML_LLM_AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/Pytorch/">Pytorch</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Principles/">Principles</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/">algorithms</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/leetcode/">leetcode</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNBC-Finance/" rel="tag">CNBC Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Principles/" rel="tag">Principles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProtocolAndBrowser/" rel="tag">ProtocolAndBrowser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sass/" rel="tag">Sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CNBC-Finance/" style="font-size: 10px;">CNBC Finance</a> <a href="/tags/CSS/" style="font-size: 18.89px;">CSS</a> <a href="/tags/DB/" style="font-size: 11.11px;">DB</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Javascript/" style="font-size: 17.78px;">Javascript</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/OS/" style="font-size: 11.11px;">OS</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Principles/" style="font-size: 10px;">Principles</a> <a href="/tags/ProtocolAndBrowser/" style="font-size: 16.67px;">ProtocolAndBrowser</a> <a href="/tags/Pytorch/" style="font-size: 13.33px;">Pytorch</a> <a href="/tags/React/" style="font-size: 14.44px;">React</a> <a href="/tags/Sass/" style="font-size: 12.22px;">Sass</a> <a href="/tags/algorithms/" style="font-size: 20px;">algorithms</a> <a href="/tags/k8s/" style="font-size: 15.56px;">k8s</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.9%20Kube%20Pods/">1.9 Kube Pods</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.8%20Kube%20Proxy/">1.8 Kube Proxy</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.7%20Kubelet/">1.7 Kubelet</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.6%20Kube%20Scheduler/">1.6 Kube Scheduler</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.5%20Kube%20Controller%20Manager/">1.5 Kube Controller Manager</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 EvelynUU<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>