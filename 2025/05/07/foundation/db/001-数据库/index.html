<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>001-数据库基础复习 | ✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="数据库核心技术详解：锁机制、索引优化与SQL语法精要本文全面解析数据库三大核心技术：锁机制的原理与应用、索引的底层实现与优化策略、SQL语法的系统化分类与实战技巧。 一、数据库锁机制深度解析1. 锁的分类体系1234567891011121314151617graph TD    A[数据库锁] --&gt; B[按锁模式]    A --&gt; C[按锁粒度]    A --&gt; D[按持">
<meta property="og:type" content="article">
<meta property="og:title" content="001-数据库基础复习">
<meta property="og:url" content="http://example.com/2025/05/07/foundation/db/001-%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨">
<meta property="og:description" content="数据库核心技术详解：锁机制、索引优化与SQL语法精要本文全面解析数据库三大核心技术：锁机制的原理与应用、索引的底层实现与优化策略、SQL语法的系统化分类与实战技巧。 一、数据库锁机制深度解析1. 锁的分类体系1234567891011121314151617graph TD    A[数据库锁] --&gt; B[按锁模式]    A --&gt; C[按锁粒度]    A --&gt; D[按持">
<meta property="og:locale">
<meta property="article:published_time" content="2025-05-07T05:51:18.000Z">
<meta property="article:modified_time" content="2025-06-24T09:49:53.706Z">
<meta property="article:author" content="EvelynUU">
<meta property="article:tag" content="DB">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">✨✨✨ WOW, recorded a lot😶‍🌫️ ✨✨✨</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Repeatings, Thoughts, and Writings</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-foundation/db/001-数据库" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/07/foundation/db/001-%E6%95%B0%E6%8D%AE%E5%BA%93/" class="article-date">
  <time class="dt-published" datetime="2025-05-07T05:51:18.000Z" itemprop="datePublished">2025-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Foundation/">Foundation</a>►<a class="article-category-link" href="/categories/Foundation/DB/">DB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      001-数据库基础复习
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据库核心技术详解：锁机制、索引优化与SQL语法精要"><a href="#数据库核心技术详解：锁机制、索引优化与SQL语法精要" class="headerlink" title="数据库核心技术详解：锁机制、索引优化与SQL语法精要"></a>数据库核心技术详解：锁机制、索引优化与SQL语法精要</h1><p>本文全面解析数据库三大核心技术：锁机制的原理与应用、索引的底层实现与优化策略、SQL语法的系统化分类与实战技巧。</p>
<h2 id="一、数据库锁机制深度解析"><a href="#一、数据库锁机制深度解析" class="headerlink" title="一、数据库锁机制深度解析"></a>一、数据库锁机制深度解析</h2><h3 id="1-锁的分类体系"><a href="#1-锁的分类体系" class="headerlink" title="1. 锁的分类体系"></a>1. 锁的分类体系</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[数据库锁] --&gt; B[按锁模式]</span><br><span class="line">    A --&gt; C[按锁粒度]</span><br><span class="line">    A --&gt; D[按持有时间]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[共享锁 S]</span><br><span class="line">    B --&gt; B2[排他锁 X]</span><br><span class="line">    B --&gt; B3[更新锁 U]</span><br><span class="line">    B --&gt; B4[意向锁 IS/IX]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[行级锁]</span><br><span class="line">    C --&gt; C2[页级锁]</span><br><span class="line">    C --&gt; C3[表级锁]</span><br><span class="line">    C --&gt; C4[数据库锁]</span><br><span class="line">    </span><br><span class="line">    D --&gt; D1[立即释放]</span><br><span class="line">    D --&gt; D2[事务结束释放]</span><br></pre></td></tr></table></figure>

<h3 id="2-锁模式详解"><a href="#2-锁模式详解" class="headerlink" title="2. 锁模式详解"></a>2. 锁模式详解</h3><h4 id="1-共享锁（S锁）"><a href="#1-共享锁（S锁）" class="headerlink" title="(1) 共享锁（S锁）"></a>(1) 共享锁（S锁）</h4><ul>
<li><strong>特征</strong>：允许多个事务并发读取</li>
<li><strong>兼容性</strong>：与S锁兼容，与X锁冲突</li>
<li><strong>SQL示例</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WITH</span> (HOLDLOCK) <span class="keyword">WHERE</span> category<span class="operator">=</span><span class="string">&#x27;Electronics&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-排他锁（X锁）"><a href="#2-排他锁（X锁）" class="headerlink" title="(2) 排他锁（X锁）"></a>(2) 排他锁（X锁）</h4><ul>
<li><strong>特征</strong>：独占资源，禁止其他任何锁</li>
<li><strong>获取场景</strong>：INSERT&#x2F;UPDATE&#x2F;DELETE</li>
<li><strong>死锁风险</strong>：高并发下易导致死锁</li>
</ul>
<h4 id="3-更新锁（U锁）"><a href="#3-更新锁（U锁）" class="headerlink" title="(3) 更新锁（U锁）"></a>(3) 更新锁（U锁）</h4><ul>
<li><strong>作用</strong>：防止更新操作的死锁</li>
<li><strong>升级机制</strong>：读取时U锁，更新时升级为X锁</li>
<li><strong>兼容性</strong>：与S锁兼容，与其他U&#x2F;X锁冲突</li>
</ul>
<h4 id="4-意向锁（IS-IX）"><a href="#4-意向锁（IS-IX）" class="headerlink" title="(4) 意向锁（IS&#x2F;IX）"></a>(4) 意向锁（IS&#x2F;IX）</h4><ul>
<li><strong>目的</strong>：快速检测表级锁冲突</li>
<li><strong>工作流程</strong>：<ol>
<li>加行锁前先加表级意向锁</li>
<li>其他事务通过意向锁判断冲突</li>
<li>避免逐行检查锁状态</li>
</ol>
</li>
</ul>
<h3 id="3-锁粒度对比"><a href="#3-锁粒度对比" class="headerlink" title="3. 锁粒度对比"></a>3. 锁粒度对比</h3><table>
<thead>
<tr>
<th><strong>粒度</strong></th>
<th>并发性</th>
<th>系统开销</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>行级锁</td>
<td>高</td>
<td>高</td>
<td>OLTP系统</td>
</tr>
<tr>
<td>页级锁</td>
<td>中</td>
<td>中</td>
<td>混合负载</td>
</tr>
<tr>
<td>表级锁</td>
<td>低</td>
<td>低</td>
<td>批量操作</td>
</tr>
<tr>
<td>数据库锁</td>
<td>最低</td>
<td>最低</td>
<td>备份恢复</td>
</tr>
</tbody></table>
<h3 id="4-死锁处理机制"><a href="#4-死锁处理机制" class="headerlink" title="4. 死锁处理机制"></a>4. 死锁处理机制</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant T1 as 事务1</span><br><span class="line">    participant T2 as 事务2</span><br><span class="line">    participant DB as 数据库引擎</span><br><span class="line">    </span><br><span class="line">    T1-&gt;&gt;DB: 锁定资源A (X锁)</span><br><span class="line">    T2-&gt;&gt;DB: 锁定资源B (X锁)</span><br><span class="line">    T1-&gt;&gt;DB: 请求资源B (等待)</span><br><span class="line">    T2-&gt;&gt;DB: 请求资源A (等待)</span><br><span class="line">    DB-&gt;&gt;DB: 死锁检测(每5秒)</span><br><span class="line">    DB-&gt;&gt;T2: 终止事务(牺牲者)</span><br><span class="line">    T2--&gt;&gt;DB: 回滚并释放锁</span><br><span class="line">    T1-&gt;&gt;DB: 获取资源B</span><br></pre></td></tr></table></figure>

<p><strong>死锁避免策略</strong>：</p>
<ul>
<li>按固定顺序访问资源</li>
<li>使用<code>SET LOCK_TIMEOUT 1000</code>（超时释放）</li>
<li>降低事务隔离级别（如READ COMMITTED）</li>
</ul>
<h2 id="二、索引核心技术详解"><a href="#二、索引核心技术详解" class="headerlink" title="二、索引核心技术详解"></a>二、索引核心技术详解</h2><h3 id="1-索引结构演进"><a href="#1-索引结构演进" class="headerlink" title="1. 索引结构演进"></a>1. 索引结构演进</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[线性索引] --&gt; B[树形索引]</span><br><span class="line">    B --&gt; C[B树]</span><br><span class="line">    C --&gt; D[B+树]</span><br><span class="line">    D --&gt; E[LSM树]</span><br><span class="line">    E --&gt; F[自适应索引]</span><br></pre></td></tr></table></figure>

<h3 id="2-B-树核心优势"><a href="#2-B-树核心优势" class="headerlink" title="2. B+树核心优势"></a>2. B+树核心优势</h3><pre><code>                          [根节点]
                         /       \
                [内部节点]       [内部节点]
               /    |     \           \
          [叶节点] [叶节点] [叶节点]  [叶节点]
          / | \   / | \   / | \    / | \
        → 数据指针链 ←
</code></pre>
<ul>
<li><strong>特征</strong>：<ul>
<li>所有数据存储在叶节点</li>
<li>叶节点通过指针顺序链接</li>
<li>非叶节点仅存储索引键</li>
</ul>
</li>
</ul>
<h3 id="3-索引类型全景"><a href="#3-索引类型全景" class="headerlink" title="3. 索引类型全景"></a>3. 索引类型全景</h3><table>
<thead>
<tr>
<th><strong>索引类型</strong></th>
<th>适用场景</th>
<th>创建语法示例</th>
</tr>
</thead>
<tbody><tr>
<td>聚集索引</td>
<td>主键查询, 范围扫描</td>
<td><code>CREATE CLUSTERED INDEX idx_name</code></td>
</tr>
<tr>
<td>非聚集索引</td>
<td>覆盖查询, 点查询</td>
<td><code>CREATE INDEX idx_name</code></td>
</tr>
<tr>
<td>唯一索引</td>
<td>强制唯一约束</td>
<td><code>CREATE UNIQUE INDEX idx_name</code></td>
</tr>
<tr>
<td>覆盖索引</td>
<td>避免回表操作</td>
<td><code>INCLUDE (col1, col2)</code></td>
</tr>
<tr>
<td>全文索引</td>
<td>文本搜索</td>
<td><code>CREATE FULLTEXT INDEX</code></td>
</tr>
<tr>
<td>空间索引</td>
<td>GIS数据</td>
<td><code>SPATIAL INDEX</code></td>
</tr>
<tr>
<td>哈希索引</td>
<td>内存表精确匹配</td>
<td><code>MEMORY引擎默认</code></td>
</tr>
</tbody></table>
<h3 id="4-索引优化实战策略"><a href="#4-索引优化实战策略" class="headerlink" title="4. 索引优化实战策略"></a>4. 索引优化实战策略</h3><h4 id="1-索引设计原则"><a href="#1-索引设计原则" class="headerlink" title="(1) 索引设计原则"></a>(1) 索引设计原则</h4><ul>
<li><strong>三星索引标准</strong>：<ol>
<li>WHERE条件列（一星）</li>
<li>ORDER BY&#x2F;GROUP BY列（二星）</li>
<li>SELECT包含列（三星）</li>
</ol>
</li>
</ul>
<h4 id="2-执行计划解析"><a href="#2-执行计划解析" class="headerlink" title="(2) 执行计划解析"></a>(2) 执行计划解析</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> p.name, o.order_date </span><br><span class="line"><span class="keyword">FROM</span> products p</span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">ON</span> p.id <span class="operator">=</span> o.product_id</span><br><span class="line"><span class="keyword">WHERE</span> p.category <span class="operator">=</span> <span class="string">&#x27;Books&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.order_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><strong>输出关键指标</strong>：</p>
<ul>
<li><strong>type</strong>：ALL（全表扫描）、index（索引扫描）、range（范围扫描）</li>
<li><strong>key</strong>：实际使用的索引</li>
<li><strong>rows</strong>：扫描行数估算</li>
<li><strong>Extra</strong>：Using where（回表）、Using index（覆盖索引）</li>
</ul>
<h4 id="3-索引失效场景"><a href="#3-索引失效场景" class="headerlink" title="(3) 索引失效场景"></a>(3) 索引失效场景</h4><ol>
<li>对索引列进行计算：<code>WHERE price*1.1 &gt; 100</code></li>
<li>使用前导通配符：<code>LIKE &#39;%keyword&#39;</code></li>
<li>隐式类型转换：<code>WHERE id = &#39;123&#39;</code>（id为整数）</li>
<li>OR条件未全覆盖：<code>WHERE a=1 OR b=2</code>（无联合索引）</li>
</ol>
<h2 id="三、SQL语法系统精解"><a href="#三、SQL语法系统精解" class="headerlink" title="三、SQL语法系统精解"></a>三、SQL语法系统精解</h2><h3 id="1-SQL语言分类体系"><a href="#1-SQL语言分类体系" class="headerlink" title="1. SQL语言分类体系"></a>1. SQL语言分类体系</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    SQL --&gt; DDL[数据定义]</span><br><span class="line">    SQL --&gt; DML[数据操作]</span><br><span class="line">    SQL --&gt; DQL[数据查询]</span><br><span class="line">    SQL --&gt; DCL[数据控制]</span><br><span class="line">    SQL --&gt; TCL[事务控制]</span><br><span class="line">    </span><br><span class="line">    DDL --&gt; CREATE</span><br><span class="line">    DDL --&gt; ALTER</span><br><span class="line">    DDL --&gt; DROP</span><br><span class="line">    DDL --&gt; TRUNCATE</span><br><span class="line">    </span><br><span class="line">    DML --&gt; INSERT</span><br><span class="line">    DML --&gt; UPDATE</span><br><span class="line">    DML --&gt; DELETE</span><br><span class="line">    DML --&gt; MERGE</span><br><span class="line">    </span><br><span class="line">    DQL --&gt; SELECT</span><br><span class="line">    </span><br><span class="line">    DCL --&gt; GRANT</span><br><span class="line">    DCL --&gt; REVOKE</span><br><span class="line">    </span><br><span class="line">    TCL --&gt; BEGIN</span><br><span class="line">    TCL --&gt; COMMIT</span><br><span class="line">    TCL --&gt; ROLLBACK</span><br><span class="line">    TCL --&gt; SAVEPOINT</span><br></pre></td></tr></table></figure>

<h3 id="2-高级查询技巧"><a href="#2-高级查询技巧" class="headerlink" title="2. 高级查询技巧"></a>2. 高级查询技巧</h3><h4 id="1-窗口函数应用"><a href="#1-窗口函数应用" class="headerlink" title="(1) 窗口函数应用"></a>(1) 窗口函数应用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  employee_id,</span><br><span class="line">  department,</span><br><span class="line">  salary,</span><br><span class="line">  <span class="built_in">AVG</span>(salary) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department) <span class="keyword">AS</span> dept_avg,</span><br><span class="line">  <span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> department <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">AS</span> salary_rank</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="2-递归查询（CTE）"><a href="#2-递归查询（CTE）" class="headerlink" title="(2) 递归查询（CTE）"></a>(2) 递归查询（CTE）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> OrgTree <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> id, name, manager_id</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">101</span>  <span class="comment">-- CEO</span></span><br><span class="line">  <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">  <span class="keyword">SELECT</span> e.id, e.name, e.manager_id</span><br><span class="line">  <span class="keyword">FROM</span> employees e</span><br><span class="line">  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> OrgTree o <span class="keyword">ON</span> o.id <span class="operator">=</span> e.manager_id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> OrgTree;</span><br></pre></td></tr></table></figure>

<h3 id="3-事务控制精要"><a href="#3-事务控制精要" class="headerlink" title="3. 事务控制精要"></a>3. 事务控制精要</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 模拟错误</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@error</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">IF @<span class="variable">@ERROR</span> <span class="operator">&lt;&gt;</span> <span class="number">0</span> <span class="keyword">SET</span> <span class="variable">@error</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">IF <span class="variable">@error</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">COMMIT</span> TRANSACTION;</span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">  <span class="keyword">ROLLBACK</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<p><strong>ACID特性保障</strong>：</p>
<ul>
<li><strong>原子性</strong>：事务内操作全部成功或全部失败</li>
<li><strong>一致性</strong>：事务前后数据库状态一致</li>
<li><strong>隔离性</strong>：多事务并发互不干扰</li>
<li><strong>持久性</strong>：提交后数据永久保存</li>
</ul>
<h3 id="4-性能优化SQL技巧"><a href="#4-性能优化SQL技巧" class="headerlink" title="4. 性能优化SQL技巧"></a>4. 性能优化SQL技巧</h3><h4 id="1-分页优化"><a href="#1-分页优化" class="headerlink" title="(1) 分页优化"></a>(1) 分页优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 低效方案</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">DESC</span> <span class="keyword">OFFSET</span> <span class="number">10000</span> LIMIT <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 高效方案（Keyset分页）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders </span><br><span class="line"><span class="keyword">WHERE</span> order_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-06-01&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2-批量操作"><a href="#2-批量操作" class="headerlink" title="(2) 批量操作"></a>(2) 批量操作</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 单条插入（低效）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;Alice&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 批量插入（高效）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;Alice&#x27;</span>), (<span class="string">&#x27;Bob&#x27;</span>), (<span class="string">&#x27;Charlie&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="四、数据库系统对比"><a href="#四、数据库系统对比" class="headerlink" title="四、数据库系统对比"></a>四、数据库系统对比</h2><h3 id="主流数据库特性对比"><a href="#主流数据库特性对比" class="headerlink" title="主流数据库特性对比"></a>主流数据库特性对比</h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th>MySQL</th>
<th>PostgreSQL</th>
<th>SQL Server</th>
<th>Oracle</th>
</tr>
</thead>
<tbody><tr>
<td>存储引擎</td>
<td>InnoDB, MyISAM</td>
<td>单一存储引擎</td>
<td>单一引擎</td>
<td>单一引擎</td>
</tr>
<tr>
<td>索引类型</td>
<td>B+树, 全文</td>
<td>B+树, GIN, GiST</td>
<td>B+树, 列存储</td>
<td>B+树, 位图</td>
</tr>
<tr>
<td>并发控制</td>
<td>MVCC</td>
<td>MVCC</td>
<td>行版本控制</td>
<td>MVCC</td>
</tr>
<tr>
<td>JSON支持</td>
<td>5.7+</td>
<td>优秀</td>
<td>2016+</td>
<td>12c+</td>
</tr>
<tr>
<td>地理空间</td>
<td>基础</td>
<td>PostGIS扩展</td>
<td>基础</td>
<td>Spatial扩展</td>
</tr>
<tr>
<td>开源协议</td>
<td>GPL</td>
<td>PostgreSQL许可</td>
<td>商业</td>
<td>商业</td>
</tr>
</tbody></table>
<h2 id="五、实战优化案例"><a href="#五、实战优化案例" class="headerlink" title="五、实战优化案例"></a>五、实战优化案例</h2><h3 id="电商系统查询优化"><a href="#电商系统查询优化" class="headerlink" title="电商系统查询优化"></a>电商系统查询优化</h3><p><strong>原始查询</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c <span class="keyword">ON</span> o.customer_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">WHERE</span> o.status <span class="operator">=</span> <span class="string">&#x27;SHIPPED&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> o.order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-06-30&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.order_date <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>优化步骤</strong>：</p>
<ol>
<li><p>创建覆盖索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_orders_status_date </span><br><span class="line"><span class="keyword">ON</span> orders(status, order_date <span class="keyword">DESC</span>) </span><br><span class="line">INCLUDE (customer_id, total_amount);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改写查询避免SELECT *：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> o.id, o.order_date, o.total_amount, c.name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c <span class="keyword">ON</span> o.customer_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">WHERE</span> o.status <span class="operator">=</span> <span class="string">&#x27;SHIPPED&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> o.order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-06-30&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.order_date <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行计划验证：<br>+—-+————-+——-+————+——-+————————-+<br>| id | select_type | table | partitions | type  | key                     |<br>+—-+————-+——-+————+——-+————————-+<br>| 1  | SIMPLE      | o     | NULL       | range | idx_orders_status_date |<br>| 1  | SIMPLE      | c     | NULL       | eq_ref| PRIMARY                 |<br>+—-+————-+——-+————+——-+————————-+</p>
</li>
</ol>
<h2 id="六、未来发展趋势"><a href="#六、未来发展趋势" class="headerlink" title="六、未来发展趋势"></a>六、未来发展趋势</h2><ol>
<li><strong>HTAP数据库</strong>：TiDB、Oracle Exadata等融合OLTP与OLAP</li>
<li><strong>AI优化器</strong>：基于机器学习的查询优化</li>
<li><strong>多模型数据库</strong>：支持文档、图、时序等多元数据</li>
<li><strong>Serverless数据库</strong>：自动扩缩容的云原生架构</li>
<li><strong>区块链数据库</strong>：不可篡改的分布式记账</li>
</ol>
<blockquote>
<p><strong>最佳实践总结</strong>：</p>
<ol>
<li>锁机制：根据场景选择合适隔离级别，避免长事务</li>
<li>索引设计：遵循三星原则，定期分析索引效率</li>
<li>SQL优化：EXPLAIN分析执行计划，避免全表扫描</li>
<li>事务控制：保持事务短小精悍，合理设置超时</li>
<li>架构选型：结合业务需求选择数据库系统</li>
</ol>
</blockquote>
<p>掌握数据库核心技术需要理论结合实践，建议通过<code>EXPLAIN</code>分析执行计划、使用<code>SHOW ENGINE INNODB STATUS</code>查看锁状态、定期进行<code>ANALYZE TABLE</code>更新统计信息，持续优化数据库性能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/07/foundation/db/001-%E6%95%B0%E6%8D%AE%E5%BA%93/" data-id="cmcae1sjn003gsssdfq6h4x7y" data-title="001-数据库基础复习" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/05/07/foundation/db/002-postgreSQL/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          002-postgreSQL
        
      </div>
    </a>
  
  
    <a href="/2025/04/09/foundation/os/003-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">003-内存管理</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CNBC/">CNBC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/Openshift/">Openshift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/kubernetes/">kubernetes</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/">Foundation</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/DB/">DB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/OS/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Foundation/ProtocolAndBrowser/">ProtocolAndBrowser</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/Sass/">Sass</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/">ML_LLM_AI</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ML-LLM-AI/Pytorch/">Pytorch</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Principles/">Principles</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/">algorithms</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithms/leetcode/">leetcode</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNBC-Finance/" rel="tag">CNBC Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/" rel="tag">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Principles/" rel="tag">Principles</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProtocolAndBrowser/" rel="tag">ProtocolAndBrowser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sass/" rel="tag">Sass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CNBC-Finance/" style="font-size: 10px;">CNBC Finance</a> <a href="/tags/CSS/" style="font-size: 18.89px;">CSS</a> <a href="/tags/DB/" style="font-size: 11.11px;">DB</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Javascript/" style="font-size: 17.78px;">Javascript</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/OS/" style="font-size: 11.11px;">OS</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Principles/" style="font-size: 10px;">Principles</a> <a href="/tags/ProtocolAndBrowser/" style="font-size: 16.67px;">ProtocolAndBrowser</a> <a href="/tags/Pytorch/" style="font-size: 13.33px;">Pytorch</a> <a href="/tags/React/" style="font-size: 14.44px;">React</a> <a href="/tags/Sass/" style="font-size: 12.22px;">Sass</a> <a href="/tags/algorithms/" style="font-size: 20px;">algorithms</a> <a href="/tags/k8s/" style="font-size: 15.56px;">k8s</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.9%20Kube%20Pods/">1.9 Kube Pods</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.8%20Kube%20Proxy/">1.8 Kube Proxy</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.7%20Kubelet/">1.7 Kubelet</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.6%20Kube%20Scheduler/">1.6 Kube Scheduler</a>
          </li>
        
          <li>
            <a href="/2025/06/20/devops/kubernetes/1%20core%20concepts/1.5%20Kube%20Controller%20Manager/">1.5 Kube Controller Manager</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 EvelynUU<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>